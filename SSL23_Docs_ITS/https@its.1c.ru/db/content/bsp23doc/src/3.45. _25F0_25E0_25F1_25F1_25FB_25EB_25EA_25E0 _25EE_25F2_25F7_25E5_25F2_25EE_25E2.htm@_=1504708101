<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>3.45. &#1056;&#1072;&#1089;&#1089;&#1099;&#1083;&#1082;&#1072; &#1086;&#1090;&#1095;&#1077;&#1090;&#1086;&#1074;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js@_=1504708101" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="3.45. _25F0_25E0_25F1_25F1_25FB_25EB_25EA_25E0 _25EE_25F2_25F7_25E5_25F2_25EE_25E2.htm" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<a name="_рассылка_отчетов"></a><h1>3.45. Рассылка отчетов</h1>

<p class="Paragraph0c">Подсистема «Рассылка отчетов» позволяет настраивать
рассылки вариантов отчетов и отчетов подсистемы «Дополнительные отчеты и
обработки». Рассылки могут выполняться как по расписанию, так и по требованию.</p>

<a name="issogl1_настройка"><h2>Настройка</h2></a>

<p class="Paragraph0c">После завершения переноса объектов подсистемы необходимо
выполнить ее настройку:</p>

<p class="MsoListBullet">&#9679; 
Настроить типы получателей рассылки.</p>

<p class="MsoListBullet">&#9679; 
Расширить состав поддерживаемых форматов файлов.</p>

<p class="MsoListBullet">&#9679; 
Разместить в командном интерфейсе.</p>

<a name="issogl2_настроить_типы_получателей_рассылки"><h3>Настроить типы получателей рассылки</h3></a>

<p class="Paragraph0c">В качестве получателей рассылки могут выступать различные
объекты базы данных с одним общим правилом – для этих объектов должна вестись
контактная информация в разрезе еmail-адресов. В процессе настройки рассылки
пользователь выбирает тип получателей и вид контактной информации.</p>

<p class="Paragraph0c">Использование справочников <span class="Interface">Пользователи</span>
и <span class="Interface">Группы пользователей</span> в качестве получателей <span class="Interface">Пользователи</span> предопределено для подсистемы.</p>

<p class="Paragraph0c">Для подключения дополнительных типов получателей
необходимо в справочнике <span class="Interface">РассылкиОтчетов</span>:</p>

<p class="Number81">1. 
Перечислить типы получателей в свойстве <span class="Interface">Тип</span> определяемого типа <span class="Interface">ПолучательРассылки</span>.</p>

<p class="Number81">2. 
В модуле <span class="Interface">РассылкаОтчетовПереопределяемый</span>:</p>

<p class="MsoListBullet2">&#9679;  (Опционально)
Задать настройки каждого типа через процедуру <span class="Interface">ПереопределитьТаблицуТиповПолучателей</span>:
представление, основной вид контактной информации типа E-mail, путь к форме
выбора и дополнительный тип, дополняющий элементы основного типа. Если не
задать настройки, то будут использованы настройки типа по умолчанию.</p>

<p class="MsoListBullet2">&#9679;  (Опционально)
Написать код (или изменить запрос) формирования списка получателей в процедуре <span class="Interface">ПередФормированиемСпискаПолучателейРассылки</span>. Эта
процедура вызывается непосредственно перед выполнением запроса по получателям.
Может потребоваться только в случае использования нестандартной иерархии
(например, как в связке справочников <span class="Interface">Пользователи</span>
и <span class="Interface">ГруппыПользователей</span>).</p>

<a name="issogl2_расширить_состав_поддерживаемых_форматов_файлов"><h3>Расширить состав поддерживаемых форматов файлов</h3></a>

<p class="Paragraph0c">Если требуется расширить состав форматов, поддерживаемых
подсистемой <span class="Interface">РассылкаОтчетов</span>, то необходимо:</p>

<p class="Number81">1. 
Добавить новые форматы в перечисление <span class="Interface">ФорматыСохраненияОтчетов</span>.</p>

<p class="Number81">2. 
В модуле <span class="Interface">РассылкаОтчетовПереопределяемый</span>:</p>

<p class="MsoListBullet2">&#9679;  Определить
параметры формата в процедуре <span class="Interface">ПереопределитьПараметрыФорматов</span>.</p>

<p class="MsoListBullet2">&#9679;  Указать
обработчик сохранения в новые форматы в процедуре <span class="Interface">ПередСохранениемТабличногоДокументаВФормат</span>.</p>

<a name="issogl2_разместить_в_командном_интерфейсе"><h3>Разместить в командном интерфейсе</h3></a>

<p class="Paragraph0c">Для использования подсистемы необходимо разместить
командном интерфейсе ответственных за рассылки объект метаданных:</p>

<p class="MsoListBullet">&#9679; 
Справочник <span class="Interface">РассылкиОтчетов</span>
– для настройки и интерактивного выполнения рассылок.</p>

<p class="Paragraph0c">В случае если в конфигурации не используется подсистема
«Настройки программы», команду открытия списка справочника <span class="Interface">РассылкиОтчетов</span> следует разместить еще и в рабочем месте
администратора программы.</p>

<a name="issogl2_подключить_нестандартные_отчеты"><h3>Подключить нестандартные отчеты</h3></a>

<p class="Paragraph0c">Для участия в рассылках отчеты должны использовать типовой
формат хранения и вывода настроек (только средствами СКД) и формирование при
помощи метода <span class="Interface">СкомпоноватьРезультат</span> (см. также
описание события <span class="Interface">ПриКомпоновкеРезультата</span> в
синтакс-помощнике).</p>

<p class="Paragraph0c">Следует найти все отчеты с собственной основной формой и
проанализировать, как они формируются и как задаются их настройки. </p>

<p class="Paragraph0c">Если отчет не использует типовой формат хранения и вывода
настроек, то следует провести анализ возможности перевода на штатные средства:</p>

<p class="MsoListBullet">&#9679; 
формирование в событии <span class="Interface">ПриКомпоновкеРезультата</span>
методом <span class="Interface">СкомпоноватьРезультат</span>, </p>

<p class="MsoListBullet">&#9679; 
настройка при помощи СКД (см. также «<A href="3.8. _25E2_25E0_25F0_25E8_25E0_25ED_25F2_25FB _25EE_25F2_25F7_25E5_25F2_25EE_25E2.htm@_=1504708101#_подключить_форму_отчета">Подключить
форму отчета</a>»).</p>

<p class="Paragraph0c">Дополнительно рассылка отчетов позволяет переопределять
поведение при выборе отдельных параметров СКД. Для этого в модуле <span class="Interface">РассылкаОтчетовКлиентПереопределяемый</span> определены
следующие процедуры:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПриАктивизацииСтрокиНастройки</span>
– позволяет запретить непосредственное редактирование значения настройки, например,
если в настройке хранится только представление, а фактически, значение хранится
в дополнительных свойствах пользовательских настроек СКД.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПриНачалеВыбораНастройки</span>
– позволяет открыть собственную форму для редактирования значения настройки.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПриОчисткеНастройки</span>
– позволяет определить поведение в том случае, если для настройки доступна кнопка
очистки.</p>

<p class="Paragraph0c">Если перевод на штатные средства невозможен, то отчет
следует добавить в процедуру <span class="Interface">ОпределитьИсключаемыеОтчеты</span>
общего модуля <span class="Interface">РассылкаОтчетовПереопределяемый</span>.</p>

<a name="issogl2_настройка_прав_доступа_пользователей"><h3>Настройка прав доступа пользователей</h3></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей к данным
подсистемы «Рассылка отчетов» следует использовать роли, указанные ниже.</p>

<p class="Objectname">Таблица 3.97.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ДобавлениеИзменениеРассылокОтчетов</span></p>
  <p class="TextinTable81">Настройка и выполнение рассылок отчетов.</p>
  <p class="TextinTable81">Включает в себя право «Вывод».</p>
  <p class="TextinTable81">Используется совместно с ролью <span class="Interface">ЧтениеУчетныхЗаписейЭлектроннойПочты
  </span>(из подсистемы «Работа с почтовыми сообщениями»)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ПолныеПрава</span> (из
  подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Смена автора рассылки.</p>
  <p class="TextinTable81">Настройка и выполнение рассылок отчетов</p>
  </td>
 </tr>
</table>

<p class="Paragraph0c">Примеры настройки прав доступа пользователей приведены
ниже.</p>

<p class="Objectname">Таблица 3.98.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Группа пользователей и ее
   функции</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Состав ролей</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Администратор</p>
  <p class="BulletTab">&#9679; 
  Настройка и выполнение рассылок отчетов</p>
  <p class="BulletTab">&#9679; 
  Смена ответственных за рассылки отчетов</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ПолныеПрава</span> (из
  подсистемы «Базовая функциональность»)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Ответственный за рассылки отчетов</p>
  <p class="BulletTab">&#9679; 
  Настройка и выполнение рассылок отчетов</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">БазовыеПрава</span> (из
  подсистемы «Базовая функциональность»),</p>
  <p class="TextinTable81"><span class="Interface">ЧтениеУчетныхЗаписейЭлектроннойПочты
  </span>(из подсистемы «Работа с почтовыми сообщениями»),</p>
  <p class="TextinTable81"><span class="Interface">ДобавлениеИзменениеРассылокОтчетов</span></p>
  </td>
 </tr>
</table>

<a name="issogl1_использование_при_разработке_конфигурации"><h2>Использование при разработке конфигурации</h2></a>

<a name="issogl2_переопределение_флажка_отчетпустой"><h3>Переопределение флажка «ОтчетПустой»</h3></a>

<p class="Paragraph0c">Если для формирования используется собственная логика (в <span class="Interface">ПриКомпоновкеРезультата</span> свойство <span class="Interface">СтандартнаяОбработка</span>
устанавливается в <span class="Interface">Ложь</span>), то в обработчике <span class="Interface">ПриКомпоновкеРезультата</span> через дополнительные свойства
пользовательских настроек следует установить признак <span class="Interface">ОтчетПустой</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    КомпоновщикНастроек<span class="operator">.</span>ПользовательскиеНастройки<span class="operator">.</span>ДополнительныеСвойства<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;ОтчетПустой&quot;</span><span class="operator">,</span> <span class="operator">&lt;</span><span class="keyword">Истина</span><span class="operator">,</span> <span class="keyword">если</span> отчет <span class="keyword">не</span> содержит данных<span class="operator">&gt;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Это нужно чтобы у пользователей работал флажок <span class="Interface">Отправлять пустой</span>, который позволяет отключить отправку
пустых отчетов. Для определения, что отчет не пустой, рассылка отчетов
использует стандартные средства СКД, которые в некоторых случаях могут не
работать или работать недостоверно.</p>

<p class="Paragraph0c">Также этот признак можно использовать и в других случаях, когда
требуется переопределить типовую логику или когда рассылка не может достоверно
определить что отчет пустой. Например, если в отчете есть диаграммы, то всегда
считается что отчет не пустой.</p>

<a name="issogl1_настройка_обмена_данными"><h2>Настройка обмена данными</h2></a>

<p class="Paragraph0c">Объекты метаданных подсистемы, содержащие данные, не
рекомендуется включать в планы обмена распределенной ИБ. Рекомендуемая модель –
независимая настройка рассылок для каждого узла РИБ.</p>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>