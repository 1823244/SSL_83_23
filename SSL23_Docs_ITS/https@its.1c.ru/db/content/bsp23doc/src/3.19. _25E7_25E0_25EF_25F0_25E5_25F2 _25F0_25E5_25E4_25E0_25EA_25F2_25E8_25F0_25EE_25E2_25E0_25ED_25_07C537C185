<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>3.19. &#1047;&#1072;&#1087;&#1088;&#1077;&#1090; &#1088;&#1077;&#1076;&#1072;&#1082;&#1090;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1103; &#1088;&#1077;&#1082;&#1074;&#1080;&#1079;&#1080;&#1090;&#1086;&#1074; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js@_=1504708101" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="3.19. _25E7_25E0_25EF_25F0_25E5_25F2 _25F0_25E5_25E4_25E0_25EA_25F2_25E8_25F0_25EE_25E2_25E0_25ED_25_0AA76CADAE" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<h1>3.19. Запрет редактирования реквизитов объектов</h1>

<p class="Paragraph0c">Подсистема «Запрет редактирования реквизитов объектов»
предназначена для запрета редактирования некоторых реквизитов объектов, которые
определяют характер данного объекта и которые условно можно назвать ключевыми
реквизитами данного объекта. Как правило, ключевыми реквизитами являются
реквизиты объекта, влияющие на поведение других объектов, например на
проведение документов. Необдуманное изменение таких реквизитов может привести к
рассогласованию данных учета. </p>

<p class="Paragraph0c">Примером может служить реквизит <span class="Interface">Валюта</span>
справочника <span class="Interface">Кассы</span>, который определяет валюту
остатков по данной кассе, или признак <span class="Interface">Является услугой</span>
справочника <span class="Interface">Номенклатура</span>, который влияет на
проведение документов с такой номенклатурой. Такие реквизиты нельзя изменять
после появления остатков по данной кассе или после появления документов с
данной номенклатурой соответственно.</p>

<p class="Paragraph0c">При этом подсистема допускает программное изменение
ключевых реквизитов объектов. В этом случае необходимые проверки должен выполнять
вызывающий код.</p>

<a name="issogl1_настройка"><h2>Настройка</h2></a>

<p class="Paragraph0c">Для использования подсистемы необходимо выполнить
следующие шаги:</p>

<p class="Number81">1. 
Определить список объектов, для которых
применяется подсистема, и состав их ключевых реквизитов (как минимум один реквизит
для каждого объекта). Перечислить список этих объектов в процедуре <span class="Interface">ПриОпределенииОбъектовСЗаблокированнымиРеквизитами</span>
общего модуля <span class="Interface">ЗапретРедактированияРеквизитовОбъектовПереопределяемый</span>.</p>

<p class="Number81">2. 
Принять решение по поводу состава объектов
метаданных, наличие ссылок из которых на данный объект метаданных не должно
влиять на возможность редактирования его ключевых реквизитов. Такие объекты
следует включить в фильтр поиска исключений ссылок (см. раздел «<A href="3.4. _25E1_25E0_25E7_25EE_25E2_25E0_25FF _25F4_25F3_25ED_25EA_25F6_25E8_25EE_25ED_25E0_25EB_25FC_25ED_25EE_25F1_25F2_25FC.htm@_=1504708101#_настройка_исключений_поиска">Настройка
исключений поиска ссылок на объекты</a>»). </p>

<p class="Paragraph0c">Для каждого объекта метаданных, для которого применяется
подсистема, надо выполнить следующие шаги:</p>

<p class="Number81">1. 
Добавить в модуль менеджера объекта функцию <span class="Interface">ПолучитьБлокируемыеРеквизитыОбъекта</span>, в которой вернуть
список имен ключевых реквизитов/табличных частей объекта или реквизитов формы.
После имени реквизита можно указать точку с запятой и через запятую перечислить
имена дополнительных элементов формы, имеющих отношение к реквизиту, которые
тоже нужно заблокировать:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Возвращает описание блокируемых реквизитов.</span>
<span class="comment">//</span>
<span class="comment">// Возвращаемое значение:</span>
<span class="comment">//  Массив - содержит строки в формате ИмяРеквизита[;ИмяЭлементаФормы,...]</span>
<span class="comment">//           где ИмяРеквизита - имя реквизита объекта, ИмяЭлементаФормы - имя элемента формы,</span>
<span class="comment">//           связанного с реквизитом.</span>
<span class="comment">//</span>
<span class="keyword">Функция</span> ПолучитьБлокируемыеРеквизитыОбъекта<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Экспорт</span>
    Результат <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
    Результат<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ИмяРеквизитаОбъекта1&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Результат<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ИмяТабличнойЧастиОбъекта1&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Результат<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ИмяРеквизитаФормы1&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Результат<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ИмяРеквизитаОбъекта2; ИмяЭлементаФормы1, ИмяЭлементаФормы2&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ...
    <span class="keyword">Возврат</span> Результат<span class="operator">;</span>
<span class="keyword">КонецФункции</span></pre>

<p class="Number81">2. 
Добавить в модуль формы объекта процедуру:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_РазрешитьРедактированиеРеквизитовОбъекта<span class="operator">(</span>Команда<span class="operator">)</span>
    ЗапретРедактированияРеквизитовОбъектовКлиент<span class="operator">.</span>РазрешитьРедактированиеРеквизитовОбъекта<span class="operator">(</span>ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Number81">3. 
Добавить в обработчики событий <span class="Interface">ПриСозданииНаСервере</span> и <span class="Interface">ПослеЗаписиНаСервере</span>
код:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    <span class="comment">// Обработчик подсистемы запрета редактирования реквизитов объектов</span>
    ЗапретРедактированияРеквизитовОбъектов<span class="operator">.</span>ЗаблокироватьРеквизиты<span class="operator">(</span>ЭтотОбъект<span class="operator">)</span><span class="operator">;</span></pre>

<p class="Warningword">Примечание</p>

<p class="Notes">Вторым параметром функции может выступать группа формы, на
которую будет прикреплена команда разрешения редактирования ключевых
реквизитов.</p>

<p class="Number81">4. 
Для ключевых реквизитов в свойствах объекта
рекомендуется выставлять свойство <span class="Interface">Проверка заполнения</span>
как <span class="Interface">Выдавать ошибку </span>либо вручную осуществлять
проверку ключевых реквизитов на заполненность.</p>

<p class="Paragraph0c">Пример использования подсистемы можно посмотреть в
демонстрационной конфигурации в справочнике <span class="Interface">_ДемоНоменклатура</span>.</p>

<a name="issogl2_переопределение_логики_разрешающей_изменение_ключевых_реквизитов"><h3>Переопределение логики, разрешающей изменение ключевых реквизитов</h3></a>

<p class="Paragraph0c">Существует возможность задать нестандартные условия
разрешения изменения ключевых реквизитов. Для этого нужно сделать следующее.</p>

<p class="Paragraph0c">Во-первых, переопределить содержимое процедуры модуля
формы объекта <span class="Interface">Подключаемый_РазрешитьРедактированиеРеквизитовОбъекта</span>.
Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_РазрешитьРедактированиеРеквизитовОбъекта<span class="operator">(</span>Команда<span class="operator">)</span>
    ЗаблокированныеРеквизиты <span class="operator">=</span> ЗапретРедактированияРеквизитовОбъектовКлиент<span class="operator">.</span>Реквизиты<span class="operator">(</span>ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Если</span> ЗаблокированныеРеквизиты<span class="operator">.</span>Количество<span class="operator">(</span><span class="operator">)</span> <span class="operator">&gt;</span> <span class="number">0</span> <span class="keyword">Тогда</span>
        ПараметрыФормы <span class="operator">=</span> <span class="keyword">Новый</span> Структура<span class="operator">;</span>
        ПараметрыФормы<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;Ссылка&quot;</span><span class="operator">,</span> Объект<span class="operator">.</span>Ссылка<span class="operator">)</span><span class="operator">;</span>
        ПараметрыФормы<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;ЗаблокированныеРеквизиты&quot;</span><span class="operator">,</span> ЗаблокированныеРеквизиты<span class="operator">)</span><span class="operator">;</span>
        ОткрытьФорму<span class="operator">(</span><span class="string">&quot;Документ._ДемоЗаказПокупателя.Форма.РазблокированиеРеквизитов&quot;</span><span class="operator">,</span> ПараметрыФормы<span class="operator">,</span>
            ЭтотОбъект<span class="operator">,</span><span class="operator">,</span><span class="operator">,</span><span class="operator">,</span> <span class="keyword">Новый</span> ОписаниеОповещения<span class="operator">(</span><span class="string">&quot;ПослеВыбораРеквизитовДляРазблокирования&quot;</span><span class="operator">,</span> ЭтотОбъект<span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Иначе</span>
        ЗапретРедактированияРеквизитовОбъектовКлиент<span class="operator">.</span>ПоказатьПредупреждениеВсеВидимыеРеквизитыРазблокированы<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПослеВыбораРеквизитовДляРазблокирования<span class="operator">(</span>РазблокируемыеРеквизиты<span class="operator">,</span> Контекст<span class="operator">)</span> <span class="keyword">Экспорт</span>
    <span class="keyword">Если</span> ТипЗнч<span class="operator">(</span>РазблокируемыеРеквизиты<span class="operator">)</span> <span class="operator">&lt;</span><span class="operator">&gt;</span> Тип<span class="operator">(</span><span class="string">&quot;Массив&quot;</span><span class="operator">)</span> <span class="keyword">Тогда</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    ЗапретРедактированияРеквизитовОбъектовКлиент<span class="operator">.</span>УстановитьДоступностьЭлементовФормы<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span>
        РазблокируемыеРеквизиты<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">Во-вторых, создать свою форму <span class="Interface">РазблокированиеРеквизитов</span>.
В ней позволить пользователю пометить нужные реквизиты и вернуть результат с
помощью метода <span class="Interface">Закрыть</span>. Пример:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> РазрешитьРедактирование<span class="operator">(</span>Команда<span class="operator">)</span>
    РазблокируемыеРеквизиты <span class="operator">=</span> <span class="keyword">Новый</span> Массив<span class="operator">;</span>
    РазблокируемыеРеквизиты<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;&lt;Имя реквизита&gt;&quot;</span><span class="operator">)</span><span class="operator">;</span>
    …
    Закрыть<span class="operator">(</span>РазблокируемыеРеквизиты<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">В случаях, когда необходимо самостоятельно рассчитывать и
устанавливать значения свойств <span class="Interface">ТолькоПросмотр</span> или <span class="Interface">Доступность</span> соответствующих полей разблокируемых
реквизитов с учетом разных причин, вместо процедуры <span class="Interface">УстановитьДоступностьЭлементовФормы</span>
нужно вызвать процедуру <span class="Interface">УстановитьРазрешенностьРедактированияРеквизитов</span>.
Она не изменяет доступность полей реквизитов, а только отмечает реквизиты как
разрешенные для редактирования, что нужно для корректной работы функции <span class="Interface">Реквизиты</span>. Кроме того, если какие-то из реквизитов нужно
считать недоступными для разблокировки, например, если для реквизита формы нет
права редактирования, заданного через роли, или по другой причине, можно
переопределить значение свойства <span class="Interface">ПравоРедактирования</span>
с помощью процедуры <span class="Interface">УстановитьРазрешенностьРедактированияРеквизитов</span>.
Это необходимо для корректного отключения доступности команды разблокировки
реквизитов, когда все реквизиты уже разблокированы.</p>

<p class="Paragraph0c">Форму, которая будет разрешать редактирование реквизитов,
следует назвать <span class="Interface">РазблокированиеРеквизитов</span>, чтобы
поддержать групповое изменение объектов информационной базы. Форма должна
возвращать массив, содержащий имена реквизитов, которые нужно разблокировать.
Для возврата массива следует использовать метод <span class="Interface">Закрыть</span>.
Кроме того, если форма обслуживает более одного реквизита, то рекомендуется
использовать параметр формы <span class="Interface">ЗаблокированныеРеквизиты</span>,
в который передается <span class="Interface">Массив</span> имен реквизитов для
разблокирования.</p>

<a name="issogl2_размещение_в_командном_интерфейсе"><h3>Размещение в командном интерфейсе</h3></a>

<p class="Paragraph0c">Все действия по изменению командного интерфейса
выполняются при интеграции подсистемы (см. выше). </p>

<a name="issogl2_настройка_прав_доступа_пользователей"><h3>Настройка прав доступа пользователей</h3></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей к данным
подсистемы «Запрет редактирования реквизитов объектов» следует использовать
роль, указанную ниже.</p>

<p class="Objectname">Таблица 3.35.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="MsoListNumber">1.   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">РедактированиеРеквизитовОбъектов</span></p>
  <p class="TextinTable81">Редактирование заблокированных значений реквизитов
  объектов</p>
  </td>
 </tr>
</table>

<p class="Paragraph0c">Пример настройки прав доступа пользователей приведен ниже.</p>

<p class="Objectname">Таблица 3.36.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Группа пользователей и ее функции</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Состав ролей</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="MsoListNumber">1.   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Ответственный за ведение документов</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">&lt;ДобавлениеИзменениеДокументов&gt;</span>
  – основная роль, предоставляющая право редактирования документа.</p>
  <p class="TextinTable81"><span class="Interface">РедактированиеРеквизитовОбъектов</span></p>
  </td>
 </tr>
</table>

<a name="issogl1_использование_при_разработке_конфигурации"><h2>Использование при разработке конфигурации</h2></a>

<a name="issogl2_настройка_обмена_данными"><h3>Настройка обмена данными</h3></a>

<p class="Paragraph0c">Для настройки обмена данными никаких действий не
требуется, так как подсистема не предоставляет собственных данных.</p>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>