<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>&#1055;&#1086;&#1076;&#1087;&#1080;&#1089;&#1072;&#1090;&#1100;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="_25EF_25EE_25E4_25EF_25E8_25F1_25E0_25F2_25FC.htm" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<a name="_электроннаяподписьклиентподписать"></a><h1>Подписать</h1>

<pre> Подписывает данные, возвращает подпись и добавляет подпись в объект, если указано.
 Общий подход к обработке значений свойств с типом ОписаниеОповещения в параметре ОписаниеДанных.
  При выполнении обработки оповещения в нее передается структура параметров, в которой всегда есть
  свойство "Оповещение" типа ОписаниеОповещения, обработку которого нужно выполнить для продолжения.
  Кроме того, в структуре всегда есть свойство ОписаниеДанных, полученное при вызове процедуры.
  При вызове оповещения в качестве значения должна передаваться структура. Если в процессе асинхронного
  выполнения возникает ошибка, тогда в эту структуру нужно вставить свойство ОписаниеОшибки типа Строка.</pre>
<p class="Paragraph0c"><span class="Bold">Синтаксис</span></p>
<pre> Процедура Подписать(ОписаниеДанных, Форма = Неопределено, ОбработкаРезультата = Неопределено) Экспорт</pre>
<p class="Paragraph0c"><span class="Bold">Параметры</span></p>
<pre>  ОписаниеДанных - Структура - со свойствами:
    * Операция            - Строка - заголовок формы подписания данных, например, Подписание файла.
    * ЗаголовокДанных     - Строка - заголовок элемента или набора данных, например Файл.
    * СообщитьОЗавершении - Булево - (необязательный) - если Ложь, то не будет показано оповещение о успешном
                              завершении операции для представления данных, указанного рядом с заголовком.
    * ПоказатьКомментарий - Булево - (необязательный) - разрешает ввод комментария в форме
                              подписания данных. Если не указан, значит Ложь.
    * ОтборСертификатов  - Массив - (необязательный) - содержит ссылки на элементы справочника.
                              СертификатыЭлектроннойПодписиИШифрования, которые могут быть выбраны
                              пользователем. Отбор блокирует возможность выбора других сертификатов
                              из личного хранилища.
    * БезПодтверждения   - Булево - (необязательный) - пропустить подтверждение пользователя, если
                              в свойстве ОтборСертификатов только один сертификат и:
                              а) либо сертификат выпущен с усиленной защитой закрытого ключа,
                              б) либо пользователь запомнил пароль к сертификату на время сеанса,
                              в) либо пароль установлен ранее методом УстановитьПарольСертификата.
                              Если в процессе подписания возникла ошибка, тогда будет открыта форма
                              с возможностью указать пароль. Параметр ПоказатьКомментарий игнорируется.
    * ПередВыполнением   - ОписаниеОповещения - (необязательный) - описание обработчика дополнительной
                              подготовки данных, после выбора сертификата, которым будут подписаны данные.
                              В этом обработчике можно заполнить параметр Данные, если он зависит
                              от сертификата, который в момент вызова уже вставлен в ОписаниеДанных,
                              как ВыбранныйСертификат (см. ниже). Следует учесть общий подход (см. выше).
    * ВыполнятьНаСервере - Неопределено, Булево - (необязательный) - когда не указан или Неопределено,
                              тогда выполнение будет определено автоматически: если есть сервер, то сначала
                              на сервере, потом при неудаче на клиенте, потом сообщение о двух ошибках.
                              Когда Истина: если есть разрешено выполнение на сервере, тогда выполнение
                              только на сервере, при неудаче одно сообщение об ошибке на сервере.
                              Когда Ложь: выполнение только на клиенте, как будто нет сервера.
    * ПараметрыДополнительныхДействий - Произвольный - (необязательный) - если указан, то передается
                              на сервер в процедуру ПередНачаломОперации общего модуля.
                              ЭлектроннаяПодписьПереопределяемый, как ВходныеПараметры.
    * КонтекстОперации   - Неопределено - (необязательный) - если указан, тогда в свойство будет
                              установлено определенное значение произвольного типа, которое позволяет
                              выполнить действие с тем же сертификатом повторно (у пользователя 
                              не запрашивается ни пароль, ни подтверждение действия).
    * ------  ------   - Произвольный - (необязательный) - если определено, то действие будет выполнено
                              с тем же сертификатом без запроса пароля или подтверждения.
                              Параметр БезПодтверждения считается равным Истина.
                              Параметры Операция, ЗаголовокДанных, ПоказатьКомментарий, ОтборСертификатов
                              и ВыполнятьНаСервере игнорируются, их значения остаются, как при первом вызове.
                              Параметр ПараметрыДополнительныхДействий игнорируется.
                              Процедура ПередНачаломОперации не вызывается.
                              Если передать контекст, возвращенный процедурой Расшифровать, тогда
                              пароль, введенный для сертификата, может быть использован, как если бы
                              пароль был сохранен на время сеанса. В остальном контекст игнорируется.
    Вариант 1:
    * Данные                - ДвоичныеДанные - данные для подписания.
    * --  --              - Строка - адрес временного хранилища, содержащего двоичные данные.
    * --  --              - ОписаниеОповещения - обработчик получения данных, который возвращает
                                 их в свойстве Данные (см. выше общий подход). В момент вызова
                                 в ОписаниеДанных уже вставлен параметр ВыбранныйСертификат (см. ниже).
                            - Структура - со свойствами:
                               * ПараметрыXMLDSig - Структура - как возвращает функция ПараметрыXMLDSig общего
                                                                модуля ЭлектроннаяПодписьКлиентСервер.
                               * КонвертSOAP      - Строка - шаблон сообщения &lt;soap:Envelope&gt;.
    * Объект                - Ссылка - (необязательный) - ссылка на объект с табличной частью.
                                 ЭлектронныеПодписи, в которую нужно добавить подпись.
                                 Если не указан, то подпись не требуется добавлять.
    * --  --              - ОписаниеОповещения - (необязательный) - обработчик добавления подписи в
                                 табличную часть ЭлектронныеПодписи. Следует учесть общий подход (см. выше).
                                 В момент вызова в ОписаниеДанных уже вставлен параметр СвойстваПодписи.
                                 В случае параметра НаборДанных, в ОписаниеДанных вставляется
                                 свойство ТекущийЭлементНабораДанных, содержащее параметр СвойстваПодписи.
    * ВерсияОбъекта         - Строка - (необязательный) - версия данных объекта для проверки и
                                 блокировки объекта перед добавлением подписи.
    * Представление         - Ссылка, Строка, Структура - (необязательный), если не указан, тогда
                                 представление вычисляется по значению свойства Объект.
                                 Структура содержит свойства:
                                    * Значение      - Ссылка, ОписаниеОповещения - для открытия.
                                    * Представление - Строка - представление значения.
    Вариант 2:
    * НаборДанных           - Массив - структуры со свойствами, описанными в Варианте 1.
    * ПредставлениеНабора   - Строка - представления нескольких элементов набора данных, например, "Файлы (%1)".
                                 В это представление в параметр %1 заполняется количество элементов.
                                 По гиперссылке можно открыть список.
                                 Если в наборе данных 1 элемент, тогда используется значение
                                 в свойстве Представление свойства НаборДанных, если не указано, тогда
                                 представление вычисляется по значению свойства Объект элемента набора данных.
    * СписокПредставлений   - СписокЗначений, Массив - (необязательный) - произвольный список элементов
                                 или массив со значениями, как у свойства Представление, которые
                                 сможет открыть пользователь. Если не указан, то заполняется из
                                 свойств Представление или Объект в свойстве НаборДанных.
  Форма - УправляемаяФорма - форма из которой нужно получить уникальный идентификатор, который будет
                                использоваться при блокировке объекта.
        - Неопределено     - использовать стандартную форму.
  ОбработкаРезультата - ОписаниеОповещения - необязательный параметр.
     Требуется для нестандартной обработки результата, например, если не указан параметр Объект и/или Форма.
     В результат передается входной параметр ОписаниеДанных, который в успешном случае, дополняется свойствами:
     * Успех - Булево - Истина, если все прошло успешно. Если Успех = Ложь, то частичное завершение
               определяется по наличию свойства СвойстваПодписи. Если есть, то шаг выполнен.
     * ВыбранныйСертификат - Структура - содержит свойства сертификата:
         * Ссылка    - СправочникСсылка.СертификатыКлючейЭлектроннойПодписиИШифрования - ссылка на сертификат.
         * Отпечаток - Строка - отпечаток сертификата в формате строки Base64.
         * Данные    - Строка - адрес временного хранилища, содержащего двоичные данные сертификата.
     * СвойстваПодписи - Строка - адрес временного хранилища, содержащего описанную ниже структуру.
                         При передаче параметра НаборДанных, свойство нужно проверять в нем.
                       - Структура - развернутое описание подписи:
         * Подпись             - ДвоичныеДанные - результат подписания.
                               - Строка - подписанный конверт SOAP, если передавался в данных.
         * УстановившийПодпись - СправочникСсылка.Пользователи - пользователь, который
                                    подписал объект информационной базы.
         * Комментарий         - Строка - комментарий, если он был введен при подписании.
         * ИмяФайлаПодписи     - Строка - пустая строка, т.к. подпись добавлена не из файла.
         * ДатаПодписи         - Дата   - дата, когда подпись была сделана. Имеет смысл для случая,
                                          когда дату невозможно извлечь из данных подписи. Если не
                                          указана или пустая, тогда используется текущая дата сеанса.
         * ДатаПроверкиПодписи - Дата   - дата проверки подписи после подписания.
         * ПодписьВерна        - Булево - результат проверки подписи после подписания.
         Производные свойства:
         * Сертификат          - ДвоичныеДанные - содержит выгрузку сертификата,
                                    который использовался для подписания (содержится в подписи).
         * Отпечаток           - Строка - отпечаток сертификата в формате строки Base64.
         * КомуВыданСертификат - Строка - представление субъекта, полученное из двоичных данных сертификата.</pre>
<p class="Paragraph0c"><span class="Bold">Пример вызова</span></p>
<pre> ЭлектроннаяПодписьКлиент.Подписать(ОписаниеДанных, Форма, ОбработкаРезультата)</pre>
<p class="Paragraph0c"><span class="Bold">Доступность</span></p>
<pre> Тонкий клиент, Толстый клиент</pre>
	</body>
</html>