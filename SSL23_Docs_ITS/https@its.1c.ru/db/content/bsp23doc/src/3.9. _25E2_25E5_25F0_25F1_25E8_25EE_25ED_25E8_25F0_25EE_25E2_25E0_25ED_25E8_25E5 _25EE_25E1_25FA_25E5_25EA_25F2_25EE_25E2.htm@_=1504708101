<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>3.9. &#1042;&#1077;&#1088;&#1089;&#1080;&#1086;&#1085;&#1080;&#1088;&#1086;&#1074;&#1072;&#1085;&#1080;&#1077; &#1086;&#1073;&#1098;&#1077;&#1082;&#1090;&#1086;&#1074;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js@_=1504708101" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="3.9. _25E2_25E5_25F0_25F1_25E8_25EE_25ED_25E8_25F0_25EE_25E2_25E0_25ED_25E8_25E5 _25EE_25E1_25FA_25E5_25EA_25F2_25EE_25E2.htm" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<h1>3.9. Версионирование объектов</h1>

<p class="Paragraph0c">Подсистема «Версионирование объектов» предназначена для
учета истории изменений объектов (кто, когда и что изменил). Также она
позволяет получать отчеты по версиям или по конкретной версии объекта.
Версионируемыми объектами могут быть справочники, документы и бизнес-процессы
конфигурации.</p>

<a name="issogl1_настройка"><h2>Настройка</h2></a>

<p class="Paragraph0c">Для использования подсистемы в конфигурации необходимо:</p>

<p class="MsoListBullet">&#9679; 
если в конфигурации не используется подсистема
«Настройки программы», то необходимо разместить в командном интерфейсе
администратора системы регистр сведений <span class="Interface">НастройкиВерсионированияОбъектов</span>
и поместить константу <span class="Interface">ИспользоватьВерсионированиеОбъектов</span>
в основную форму редактирования констант конфигурации или в любую другую форму,
предназначенную для администрирования системы;</p>

<p class="MsoListBullet">&#9679; 
создать подписку <span class="Interface">ЗаписатьВерсиюДокумента</span>
на событие <span class="Interface">ПередЗаписью</span>, обработчик <span class="Interface">ВерсионированиеОбъектовСобытия.ЗаписатьВерсиюДокумента</span>.</p>

<p class="Paragraph0c">Принять решение по поводу объектов метаданных конфигурации
ссылочного типа, которые следует версионировать. Для каждого объекта
метаданных, который определен для встраивания подсистемы версионирования
объектов, необходимо:</p>

<p class="MsoListBullet">&#9679; 
все версионируемые объекты перечислить в
свойстве <span class="Interface">Тип</span> определяемого типа <span class="Interface">ВерсионируемыеДанные </span>(типы <span class="Interface">Ссылка</span>
– например, <span class="Interface">СправочникСсылка</span> или <span class="Interface">ДокументСсылка</span>);</p>

<p class="MsoListBullet">&#9679; 
в свойстве <span class="Interface">Тип</span>
определяемого типа <span class="Interface">ВерсионируемыеДанныеОбъект</span>
перечислить все версионируемые объекты, кроме документов (типы <span class="Interface">Объект</span> – например, <span class="Interface">СправочникОбъект</span>
или <span class="Interface">БизнесПроцессОбъект</span>);</p>

<p class="MsoListBullet">&#9679; 
перечислить все версионируемые документы в
свойстве <span class="Interface">Источник</span> подписок <span class="Interface">ЗаписатьВерсиюДокумента
</span>(типы <span class="Interface">ДокументОбъект</span>);</p>

<p class="MsoListBullet">&#9679; 
во всех формах объектов (элементов), для которых
встраивается версионирование, в обработчике <span class="Interface">ПриСозданииНаСервере</span>
добавить фрагмент кода:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СтандартныеПодсистемы.ВерсионированиеОбъектов</span>
ВерсионированиеОбъектов<span class="operator">.</span>ПриСозданииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
<span class="comment">// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов</span></pre>

<p class="MsoListBullet">&#9679; 
во всех модулях менеджера объектов (элементов),
для которых встраивается версионирование, добавить фрагмент кода:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СтандартныеПодсистемы.ВерсионированиеОбъектов</span>
<span class="comment">// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.</span>
<span class="comment">//</span>
<span class="comment">// Параметры:</span>
<span class="comment">// Настройки - Структура - настройки подсистемы.</span>
<span class="keyword">Процедура</span> ПриОпределенииНастроекВерсионированияОбъектов<span class="operator">(</span>Настройки<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов</span></pre>

<p class="MsoListBullet">&#9679; 
принять решение о необходимости скрытия из
отчетов по версиям реквизитов и табличных частей, имеющих техническое назначение.
Для скрытия реквизитов и табличных частей необходимо в процедуре <span class="Interface">ПриОпределенииНастроекВерсионированияОбъектов</span> модуля
менеджера объекта добавить следующий код:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    Настройки<span class="operator">.</span>ПриПолученииСлужебныхРеквизитов <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span></pre>

<p class="Bullet0">и добавить в модуле менеджера процедуру <span class="Interface">ПриПолученииСлужебныхРеквизитов</span>,
в которой перечислить список скрываемых реквизитов и табличных частей:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СтандартныеПодсистемы.ВерсионированиеОбъектов</span>
<span class="comment">// Определяет настройки объекта для подсистемы ВерсионированиеОбъектов.</span>
<span class="comment">//</span>
<span class="comment">// Параметры:</span>
<span class="comment">// Настройки - Структура - настройки подсистемы.</span>
<span class="keyword">Процедура</span> ПриОпределенииНастроекВерсионированияОбъектов<span class="operator">(</span>Настройки<span class="operator">)</span> <span class="keyword">Экспорт</span>
                Настройки<span class="operator">.</span>ПриПолученииСлужебныхРеквизитов <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Ограничивает видимость реквизитов объекта в отчете по версии.</span>
<span class="comment">//</span>
<span class="comment">// Параметры:</span>
<span class="comment">// Реквизиты - Массив - список имен реквизитов объекта.</span>
<span class="keyword">Процедура</span> ПриПолученииСлужебныхРеквизитов<span class="operator">(</span>Реквизиты<span class="operator">)</span> <span class="keyword">Экспорт</span>
    Реквизиты<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ИмяРеквизита&quot;</span><span class="operator">)</span><span class="operator">;</span> <span class="comment">// реквизит объекта</span>
    Реквизиты<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ИмяТабличнойЧасти.*&quot;</span><span class="operator">)</span><span class="operator">;</span> <span class="comment">// табличная часть объекта</span>
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Конец СтандартныеПодсистемы.ВерсионированиеОбъектов</span></pre>

<a name="issogl2_настройка_прав_доступа_пользователей"><h3>Настройка прав доступа пользователей</h3></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей к данным
подсистемы «Версионирование объектов» следует использовать роли, приведенные
ниже.</p>

<p class="Objectname">Таблица 3.17.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="MsoListNumber">1.   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ПолныеПрава</span> (из подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Включение и
  отключение использования версионирования. Чтение версий объектов. Просмотр
  отчета по версиям. Возврат к предыдущим версиям объектов. Изменение настроек
  хранения объектов. Очистка устаревших версий объектов</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="MsoListNumber">2.   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ЧтениеВерсийОбъектов</span></p>
  <p class="TextinTable81">Чтение версий
  объектов. Просмотр отчета по версиям</p>
  </td>
 </tr>
</table>

<a name="issogl1_использование_при_разработке_конфигурации"><h2>Использование при разработке конфигурации</h2></a>

<a name="issogl2_разработка_макетов_отчета_по_конкретной_версии_объекта"><h3>Разработка макетов отчета по конкретной версии объекта</h3></a>

<p class="Paragraph0c">Подсистема «Версионирование объектов» позволяет
использовать произвольный макет отчета по версии объекта вместо макета по
умолчанию. </p>

<p class="Paragraph0c">Для создания макета отчета для версионируемого объекта
можно воспользоваться конструктором печати объекта:</p>

<p class="MsoListBullet">&#9679; 
открыть конструктор печати объекта;</p>

<p class="MsoListBullet">&#9679; 
выбрать <span class="Interface">Создать новую
команду</span>, ввести имя команды (например, <span class="Interface">Печать</span>;
при этом необходимо убедиться, что процедуры с таким именем нет в модуле
менеджера объекта метаданных) и нажать кнопку <span class="Interface">Далее</span>;</p>

<p class="MsoListBullet">&#9679; 
выбрать необходимые реквизиты, которые будут
выводиться в отчете, и нажать кнопку <span class="Interface">Далее</span>;</p>

<p class="MsoListBullet">&#9679; 
выбрать необходимые поля в табличных частях
объекта (если есть) и последовательно нажать кнопку <span class="Interface">Далее</span>
для каждой табличной части;</p>

<p class="MsoListBullet">&#9679; 
не выбирать реквизиты для подвала документа и
нажать кнопку <span class="Interface">Далее</span>;</p>

<p class="MsoListBullet">&#9679; 
в итоговом диалоге выбора группы оставить все
значения по умолчанию и нажать <span class="Interface">ОК</span>;</p>

<p class="MsoListBullet">&#9679; 
удалить созданную команду печати и процедуру
формирования данных печати из модуля менеджера объекта, которые были созданы на
предыдущем шаге (в примере <span class="Interface">Печать</span>);</p>

<p class="MsoListBullet">&#9679; 
переименовать созданный макет в <span class="Interface">МакетОбъекта</span> и при необходимости настроить его оформление.</p>

<a name="issogl2_настройка_обмена_данными"><h3>Настройка обмена данными</h3></a>

<p class="Paragraph0c">Все объекты метаданных подсистемы, содержащие данные,
рекомендуется включать в планы обмена распределенной ИБ (РИБ).</p>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>