<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>3.24. &#1050;&#1086;&#1085;&#1090;&#1072;&#1082;&#1090;&#1085;&#1072;&#1103; &#1080;&#1085;&#1092;&#1086;&#1088;&#1084;&#1072;&#1094;&#1080;&#1103;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js@_=1504708101" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="3.24. _25EA_25EE_25ED_25F2_25E0_25EA_25F2_25ED_25E0_25FF _25E8_25ED_25F4_25EE_25F0_25EC_25E0_25F6_25E8_25FF.htm" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<a name="_контактная_информация"></a><h1>3.24. Контактная информация</h1>

<p class="Paragraph0c">Подсистема «Контактная информация» позволяет расширять
состав реквизитов объекта произвольным набором реквизитов контактной информации
(КИ). Реквизиты КИ могут быть как предопределенными (адреса, телефоны, факс,
e-mail, www), так и пользовательскими (например, «телефон с 18:00 до 24:00»).
Справочник со встроенной контактной информацией называется владельцем КИ.</p>

<p class="Warningword">Важно!</p>

<p class="Notes">Вид КИ <span class="Interface">Адрес</span> использует возможности
подсистемы «Адресный классификатор». Основной режим использования подсистемы
предполагает, что в конфигурацию также переносится подсистема «Адресный
классификатор». </p>

<a name="issogl1_настройка"><h2>Настройка</h2></a>

<p class="Paragraph0c">После выполнения переноса объектов библиотеки необходимо
включить в командный интерфейс конфигурации справочники:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ВидыКонтактнойИнформации</span>,
</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Страны мира</span>. </p>

<p class="Paragraph0c">Настройка объектов подсистемы сводится к созданию в справочнике
<span class="Interface">ВидыКонтактнойИнформации</span> предопределенных
элементов и вызову обработчика обновления информационной базы, использующего
процедуру <span class="Interface">УстановитьСвойстваВидаКонтактнойИнформации</span>
из модуля <span class="Interface">УправлениеКонтактнойИнформацией</span>, для
установки значения реквизитов этих элементов.</p>

<p class="Number81">1. 
Принять решение по поводу состава объектов –
владельцев контактной информации и видов контактной информации у каждого такого
объекта. Например, у справочника <span class="Interface">КонтактныеЛица</span>
необходимо разместить телефон и адрес, а у справочника <span class="Interface">Контрагент</span>
– адрес электронной почты.</p>

<p class="Number81">2. 
Добавить ссылки на объекты-владельцы (кроме
документов) в состав определяемого типа <span class="Interface">ВладелецКонтактнойИнформации</span>.</p>

<p class="Number81">3. 
Добавить ссылки на документы-владельцы в подписку
на событие <span class="Interface">ЗаполнитьКонтактнуюИнформациюДокумента</span>.</p>

<p class="Number81">4. 
Перечислить виды контактной информации в
справочнике <span class="Interface">ВидыКонтактнойИнформации</span>. Справочник
видов контактной информации – иерархический.</p>

<p class="MsoListBullet2">&#9679;  На
первом уровне вводятся предопределенные группы: для каждого вида объекта –
владельца контактной информации – своя группа. У группы должно быть задано имя
в формате <span class="Interface">Справочник&lt;ИмяСправочника&gt;</span> или <span class="Interface">Документ&lt;ИмяДокумента&gt;</span>. Например, для справочника
физических лиц – <span class="Interface">СправочникФизическиеЛица</span>.
Наименование группы рекомендуется задавать в виде: <span class="Interface">Контактная
информация справочника &quot;Физические лица&quot;</span>.</p>

<p class="MsoListBullet2">&#9679;  На
втором уровне вводятся элементы – виды контактной информации, список которых
определяет разработчик конфигурации. На втором уровне могут быть также заведены
предопределенные группе, если предполагается хранение контактной информации для
табличной части объекта. В этом случае у группы должно быть задано имя в
формате <span class="Interface">Документ&lt;ИмяСправочника&gt;&lt;ИмяТабличнойЧасти&gt;</span>.</p>

<p class="MsoListBullet2">&#9679;  На
третьем уровне вводятся элементы – виды контактной информации для табличной
части объекта. Список видов контактной информации определяет ответственный за
конфигурацию. </p>

<p class="Number81">5. 
Добавить обработчик обновления информационной
базы, предназначенный для первоначального заполнения и обновления значения реквизитов,
предопределенных видов КИ при помощи процедуры <span class="Interface">УстановитьСвойстваВидаКонтактнойИнформации</span>
модуля <span class="Interface">УправлениеКонтактнойИнформацией</span>.</p>

<p class="Paragraph0c">Пример процедуры обновления информационной базы:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// Процедура обновления ИБ для справочника видов контактной информации</span>
<span class="keyword">Процедура</span> КонтактнаяИнформацияОбновлениеИБ<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Экспорт</span>
    <span class="comment">// Справочник &quot;Контрагенты&quot;</span>
    ПараметрыВида <span class="operator">=</span> УправлениеКонтактнойИнформацией<span class="operator">.</span>ПараметрыВидаКонтактнойИнформации<span class="operator">(</span>Перечисления<span class="operator">.</span>ТипыКонтактнойИнформации<span class="operator">.</span>Адрес<span class="operator">)</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>Вид <span class="operator">=</span> Справочники<span class="operator">.</span>ВидыКонтактнойИнформации<span class="operator">.</span>_ДемоАдресКонтрагента<span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>Используется <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>МожноИзменятьСпособРедактирования <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>Порядок <span class="operator">=</span> <span class="number">1</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>НастройкиПроверки<span class="operator">.</span>АдресТолькоРоссийский <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>НастройкиПроверки<span class="operator">.</span>ПроверятьКорректность <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>НастройкиПроверки<span class="operator">.</span>ПроверятьПоФИАС <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>УстановитьСвойстваВидаКонтактнойИнформации<span class="operator">(</span>ПараметрыВида<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<a name="issogl2_настройка_объектов_владельцев_контактной_информации"><h3>Настройка объектов – владельцев контактной информации</h3></a>

<p class="Number81">1. 
У объекта – владельца контактной информации
необходимо создать табличную часть <span class="Interface">КонтактнаяИнформация</span>
со следующими обязательными реквизитами:</p>

<p class="Objectname">Таблица 3.42.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Имя</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Тип значения</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Подсказка</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Тип</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ПеречислениеСсылка.ТипыКонтактнойИнформации</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Тип контактной информации (телефон, адрес и т. п.)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Вид</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">СправочникСсылка.ВидыКонтактнойИнформации</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Вид контактной информации</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Представление</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (500)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Представление контактной информации для отображения в
  формах</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ЗначенияПолей</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка неограниченной длины</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Служебное поле для хранения контактной информации</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Страна</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (100)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Страна (заполняется для адреса)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Регион</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (50)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Регион (заполняется для адреса)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Город</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (50)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Город (заполняется для адреса)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">АдресЭП</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (100)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Адрес электронной почты</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ДоменноеИмяСервера</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (100)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Доменное имя сервера электронной почты или веб-страницы</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">НомерТелефона</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (20)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Полный номер телефона</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">НомерТелефонаБезКодов</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Строка (20)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Номер телефона без кодов и добавочного номера</p>
  </td>
 </tr>
</table>

<p class="Bullet0">Для реквизитов <span class="Interface">Вид</span> и <span class="Interface">Тип</span> необходимо включить индексирование.</p>

<p class="Bullet0">Для всех строковых реквизитов ограниченной длины следует устанавливать
индексы по необходимости. Т. е. индексирование должно быть включено только для
тех реквизитов, которые используются для выборки данных.</p>

<p class="Bullet0">Кроме того, для задействования дополнительных возможностей
подсистемы список реквизитов табличной части <span class="Interface">КонтактнаяИнформация</span>
может также включать в себя:</p>

<p class="Objectname">Таблица 3.43.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Имя</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Тип значения</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Подсказка</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ИдентификаторСтрокиТабличнойЧасти
  </span>*</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Число</span> (7,0)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Идентификатор строки табличной части</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ВидДляСписка</span>**</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">СправочникСсылка.ВидыКонтактнойИнформации</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Вид контактной информации отображаемый в списках</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ДействуетС </span>***</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Дата</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Дата, с которой действует запись контактной информации</p>
  </td>
 </tr>
</table>

<p class="Bullet0">* если предполагается хранение контактной информации для
табличной части объекта. В этом случае необходимо также добавить этот же
реквизит в табличную часть объекта. Пример реализации см. в документе <span class="Interface">_ДемоЗаказПокупателя</span> демонстрационной конфигурации.</p>

<p class="Bullet0">** если предполагается <a href="#_вывод_полей_контактной">вывод полей контактной информации в списках
и отчетах</a>.</p>

<p class="Bullet0">*** если предполагается <a href="#_хранение_истории_изменений_1">хранение истории изменения контактной информации</a>.
</p>

<p class="Number81">2. 
Изменить форму элемента:</p>

<p class="MsoListBullet2">&#9679;  Если
предполагается хранение контактной информации для объекта, то в форме элемента
создать группу или страницу с именем <span class="Interface">ГруппаКонтактнаяИнформация</span>
и задать ей заголовок – <span class="Interface">Адреса, телефоны</span> (или
другой). </p>

<p class="MsoListBullet2">&#9679;  Если
предполагается хранение контактной информации для табличной части объекта, то
создать группу колонок с именем <span class="Interface">&lt;ИмяТабличнойЧасти&gt;ГруппаКонтактнаяИнформация</span>
в нужной табличной части объекта. Например, для табличной части <span class="Interface">Партнеры</span> группа контактной информации должна иметь вид <span class="Interface">ПартнерыГруппаКонтактнаяИнформация</span>.</p>

<p class="Number81">3. 
Изменить модуль формы элемента.</p>

<p class="MsoListBullet2">&#9679; 
В обработчики событий формы <span class="Interface">ПриСозданииНаСервере</span>, <span class="Interface">ПриЧтенииНаСервере</span>,
<span class="Interface">ОбработкаПроверкиЗаполненияНаСервере</span> и <span class="Interface">ПередЗаписьюНаСервере</span> вставить строки из соответствующих
процедур, располагающихся ниже. Если предполагается хранение контактной
информации для табличной части объекта, то в обработчик события формы <span class="Interface">ПослеЗаписиНаСервере</span> вставить строки из соответствующей
процедуры ниже. Добавляемые строки должны располагаться после проверок, которые
могут вызвать отказ в событии.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">#Область ОбработчикиСобытийФормы</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПриСозданииНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриСозданииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">,</span> <span class="string">&quot;ГруппаКонтактнаяИнформация&quot;</span><span class="operator">,</span> ПоложениеЗаголовкаЭлементаФормы<span class="operator">.</span>Лево<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПриЧтенииНаСервере<span class="operator">(</span>ТекущийОбъект<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриЧтенииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ТекущийОбъект<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ОбработкаПроверкиЗаполненияНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> ПроверяемыеРеквизиты<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ОбработкаПроверкиЗаполненияНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">,</span> Отказ<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПередЗаписьюНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> ТекущийОбъект<span class="operator">,</span> ПараметрыЗаписи<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПередЗаписьюНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ТекущийОбъект<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПослеЗаписиНаСервере<span class="operator">(</span>ТекущийОбъект<span class="operator">,</span> ПараметрыЗаписи<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПослеЗаписиНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ТекущийОбъект<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">#КонецОбласти</span></pre>

<p class="Bullet0">где <span class="Interface">&lt;ГруппаКонтактнаяИнформация&gt;</span>,
ссылка на элемент формы – контейнер, в который будут добавляться элементы для
редактирования контактной информации. Например: </p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриСозданииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">,</span> <span class="string">&quot;ГруппаКонтактнаяИнформация&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoListBullet2">&#9679; 
В вызове процедуры <span class="Interface">УправлениеКонтактнойИнформацией.ПриСозданииНаСервере</span>
в качестве третьего параметра нужно указать имя элемента, в котором будут
располагаться создаваемые поля ввода. Четвертый (необязательный) параметр
позволяет задать положение заголовка элементов контактной информации. Заголовки
могут располагаться сверху и слева (значения параметра <span class="Interface">ПоложениеЗаголовкаЭлементаФормы.Лево</span>
и <span class="Interface">ПоложениеЗаголовкаЭлементаФормы.Верх</span> соответственно).</p>

<p class="Number81">4. 
Перенести блок процедур контактной информации,
расположенный ниже, в модуль формы объекта – владельца контактной информации.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_КонтактнаяИнформацияПриИзменении<span class="operator">(</span>Элемент<span class="operator">)</span>
        УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>ПриИзменении<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Элемент<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_КонтактнаяИнформацияНачалоВыбора<span class="operator">(</span>Элемент<span class="operator">,</span> ДанныеВыбора<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>НачалоВыбора<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Элемент<span class="operator">,</span> <span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_КонтактнаяИнформацияПриНажатии<span class="operator">(</span>Элемент<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>НачалоВыбора<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Элемент<span class="operator">,</span> <span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_КонтактнаяИнформацияОчистка<span class="operator">(</span>Элемент<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>Очистка<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Элемент<span class="operator">.</span>Имя<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> Подключаемый_КонтактнаяИнформацияВыполнитьКоманду<span class="operator">(</span>Команда<span class="operator">)</span>
    УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>ВыполнитьКоманду<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Команда<span class="operator">.</span>Имя<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> Подключаемый_ОбновитьКонтактнуюИнформацию<span class="operator">(</span>Результат<span class="operator">)</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ОбновитьКонтактнуюИнформацию<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">,</span> Результат<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span></pre>

<a name="issogl2_настройка_прав_доступа_пользователей"><h3>Настройка прав доступа пользователей</h3></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей к данным подсистемы
«Контактная информация» следует использовать роли, перечисленные ниже.</p>

<p class="Objectname">Таблица 3.44.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">БазовыеПрава </span>(из
  подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Чтение видов контактной информации и списка стран</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ДобавлениеИзменениеВидовКонтактнойИнформации</span></p>
  <p class="TextinTable81">Ведение списка стран</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">3. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ПолныеПрава</span> (из
  подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Ведение видов контактной информации, списка стран, а
  также удаление помеченных на удаление объектов подсистемы</p>
  </td>
 </tr>
</table>

<p class="Paragraph0c">Примеры настройки прав доступа пользователей приведены
ниже.</p>

<p class="Objectname">Таблица 3.45.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Группа пользователей и ее
   функции</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Состав ролей</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Администратор</p>
  </td>
  <td valign="top">
  <p class="BulletTab">&#9679; 
  <span class="Interface">ПолныеПрава</span> (из
  подсистемы «Базовая функциональность»)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Ответственный за нормативно-справочную информацию
  (НСИ): ведение видов контактной информации, списка стран, а также всей
  остальной НСИ</p>
  </td>
  <td valign="top">
  <p class="BulletTab">&#9679; 
  <span class="Interface">БазовыеПрава</span> (из
  подсистемы «Базовая функциональность»),</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ЗапускТонкогоКлиента </span>(из
  подсистемы «Базовая функциональность»),</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ДобавлениеИзменениеВидовКонтактнойИнформации</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">3. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Менеджер по закупкам: ведение списка номенклатуры,
  ведение списка стран мира (для ввода стран происхождения товаров)</p>
  </td>
  <td valign="top">
  <p class="BulletTab">&#9679; 
  <span class="Interface">БазовыеПрава</span> (из
  подсистемы «Базовая функциональность»),</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ЗапускТонкогоКлиента</span>
  (из подсистемы «Базовая функциональность»),</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ДобавлениеИзменениеВидовКонтактнойИнформации</span>,</p>
  <p class="BulletTab"><span class="Interface">&#9679;  </span><span class="Interface">&lt;ДобавлениеИзменениеНоменклатуры&gt;</span></p>
  </td>
 </tr>
</table>

<a name="issogl2_особые_случаи_внедрения_подсистемы"><h3>Особые случаи внедрения подсистемы</h3></a>

<a name="_вывод_полей_контактной"></a><a name="issogl3_вывод_полей_контактной_информации_в_списках_и_отчетах"><h4>Вывод полей контактной информации в списках и отчетах</h4></a>

<p class="Paragraph0c">Для вывода контактной информации в динамических списках и
отчетах необходимо выполнить следующую настройку. В объекте-владельце
контактной информации в табличную часть <span class="Interface">КонтактнаяИнформация</span>
добавить реквизит <span class="Interface">ВидДляСписка</span> с типом <span class="Interface">СправочникСсылка</span>.<span class="Interface">ВидКонтактнойИнформации</span>,
затем в форме <span class="Interface">Дополнительные характеристики объекта данных</span>
добавить дополнительную характеристику:</p>

<p class="Objectname">Таблица 3.46.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <tr>
  <td colspan="3" valign="top">
  <p class="TextinTable81"><span class="Interface">Виды характеристик</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Поле ключа</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Поле отбора видов</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Значение отбора видов</span></p>
  </td>
 </tr>
 <tr>
  <td colspan="3" valign="top">
  <p class="TextinTable81"><span class="Interface">Справочник.ВидыКонтактнойИнформации</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Ссылка</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Родитель</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">&lt;Предопределенная группа
  справочника <br>
  ВидыКонтактнойИнформации&gt;</span></p>
  </td>
 </tr>
</table>

<p class="Objectname">Таблица 3.47.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <tr>
  <td colspan="3" valign="top">
  <p class="TextinTable81"><span class="Interface">Значения характеристик</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Поле объекта</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Поле вида</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Поле значения</span></p>
  </td>
 </tr>
 <tr>
  <td colspan="3" valign="top">
  <p class="TextinTable81"><span class="Interface">Справочник.&lt;Имя объекта с
  контактной информацией&gt;.ТабличнаяЧасть.КонтактнаяИнформация</span></p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Ссылка</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ВидДляСписка</span></p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">Представление</span></p>
  </td>
 </tr>
</table>

<p class="Paragraph0c">где <span class="Interface">&lt;Предопределенная группа
(элемент) справочника ВидыКонтактнойИнформации&gt;</span> – предопределенная
группа(элемент), созданная на этапе формирования видов контактной информации. </p>

<p class="Paragraph0c">Для отображения контактной информации в списках, в форме
списка в меню <span class="Interface">Еще</span> выбрать пункт <span class="Interface">Изменить форму</span>. В таблице <span class="Interface">Элементы
формы</span> выбрать реквизит <span class="Interface">Ссылка</span>, нажать
кнопку <span class="Interface">Добавить поля</span> в командной панели формы и
далее в открывшемся списке полей выбрать нужные поля контактной информации для
отображения.</p>

<p class="Paragraph0c">См. пример реализации в справочнике <span class="Interface">_ДемоКонтрагенты</span>
демонстрационной конфигурации.</p>

<a name="issogl3_создание_статических_элементов_управления"><h4>Создание статических элементов управления</h4></a>

<p class="Paragraph0c">Создание статических реквизитов контактной информации
позволяет:</p>

<p class="MsoListBullet">&#9679; 
добавлять элементы контактной информации в
различные части формы (например, вынести самые важные виды контактной
информации в шапку);</p>

<p class="MsoListBullet">&#9679; 
изменять внешний вид и свойства элементов
контактной информации без внесения изменений в типовую конфигурацию;</p>

<p class="MsoListBullet">&#9679; 
повысить скорость открытия формы – владельца
контактной информации.</p>

<p class="Paragraph0c">Для создания статических элементов контактной информации
необходимо:</p>

<p class="MsoListBullet">&#9679; 
принять решение о видах контактной информации,
элементы управления которых должны создаваться вручную;</p>

<p class="MsoListBullet">&#9679; 
в обработчике <span class="Interface">ПриСозданииНаСервере</span>
добавить выбранные виды в массив и передать его в качестве пятого параметра в
процедуру <span class="Interface">УправлениеКонтактнойИнформацией.ПриСозданииНаСервере</span>;</p>

<p class="MsoListBullet">&#9679; 
добавить в форму реквизит <span class="Interface">ПараметрыКонтактнойИнформации</span>,
тип – произвольный;</p>

<p class="MsoListBullet">&#9679; 
добавить в форму реквизит <span class="Interface">КонтактнаяИнформацияОписаниеДополнительныхРеквизитов</span>,
тип – таблица значений с колонками:</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ИмяРеквизита – Строка</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Вид – СправочникСсылка.ВидыКонтактнойИнформации</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Тип – ПеречислениеСсылка.ТипыКонтактнойИнформации</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ЗначенияПолей – СписокЗначений</span>, <span class="Interface">Строка</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Представление – Строка</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Комментарий – Строка</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ЭтоРеквизитТабличнойЧасти – Булево</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ЭтоИсторическаяКонтактнаяИнформация – Булево</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ИмяЭлементаДляРазмещения – Строка</span>;</p>

<p class="MsoListBullet">&#9679; 
для каждого вида контактной информации добавить
реквизит с именем вида <span class="Interface">КонтактнаяИнформацияПоле&lt;ИмяВидаКонтактнойИнформации&gt;</span>;</p>

<p class="MsoListBullet">&#9679; 
добавить на форму элементы:</p>

<p class="MsoListBullet2">&#9679;  для
каждого вида контактной информации добавить на форму группу с именем <span class="Interface">ГруппаКонтактнаяИнформацияПоле &lt;ИмяВидаКонтактнойИнформации&gt;</span>.
Свойства: <span class="Interface">Отображение</span> – <span class="Interface">Нет</span>,
<span class="Interface">Группировка</span> – <span class="Interface">Горизонтальная</span>,
<span class="Interface">ОтображатьЗаголовок</span> – <span class="Interface">Ложь</span>;</p>

<p class="MsoListBullet2">&#9679;  в
созданную группу перетащить ранее созданный реквизит с именем вида <span class="Interface">КонтактнаяИнформацияПоле&lt;ИмяВидаКонтактнойИнформации&gt;</span>,
установив соответствующее отображение заголовка (<span class="Interface">Лево</span>
или <span class="Interface">Верх</span>) в зависимости от положения заголовка,
передаваемого в процедуру <span class="Interface">УправлениеКонтактнойИнформацией.ПриСозданииНаСервере</span>;</p>

<p class="MsoListBullet2">&#9679;  для
добавления действия необходимо создать команду с именем вида <span class="Interface">КомандаКонтактнаяИнформацияПоле&lt;ИмяВидаКонтактнойИнформации&gt;</span>,
отображение <span class="Interface">Картинка</span>. Затем эту команду необходимо
перетащить в ранее созданную группу <span class="Interface">ГруппаКонтактнаяИнформацияПоле
&lt;ИмяВидаКонтактнойИнформации&gt;</span>. Картинка команды, заголовок и
подисказка устанавливаются в зависимости от типа контактной информации:</p>

<p class="MsoListBullet3">&#9679; 
для типа <span class="Interface">Адрес</span>
действие добавляется только в том случае, если имеется несколько видов
контактной информации типа <span class="Interface">Адрес</span>. В этом случае
для команды устанавливается картинка <span class="Interface">ПереместитьВлево</span>,
заголовок <span class="Interface">Заполнить</span>, подсказка <span class="Interface">Заполнить адрес из другого поля</span>;</p>

<p class="MsoListBullet3">&#9679; 
для типа <span class="Interface">ВебСтраница</span>
картинка <span class="Interface">КонтактнаяИнформацияПерейтиПоСсылке</span>,
заголовок <span class="Interface">Перейти</span>, подсказка <span class="Interface">Перейти по ссылке</span>;</p>

<p class="MsoListBullet3">&#9679; 
для типа <span class="Interface">АдресЭлектроннойПочты</span>
действие устанавливается только при наличии подсистемы «<span class="Interface"><A href="3.43. _25F0_25E0_25E1_25EE_25F2_25E0 _25F1 _25EF_25EE_25F7_25F2_25EE_25E2_25FB_25EC_25E8 _25F1_25EE_25EE_25E1_25F9_25E5_25ED_25E8_25FF_25EC_25E8.htm@_=1504708101#_работа_с_почтовыми">РаботаСПочтовымиСообщениями</a>»</span>. При этом
устанавливается картинка <span class="Interface">ОтправитьЭлектронноеПисьмо</span>,
заголовок <span class="Interface">Написать письмо</span>, подсказка <span class="Interface">Написать письмо</span>;</p>

<p class="MsoListBullet3">&#9679; 
для типа <span class="Interface">Телефон</span>
при наличии подсистемы «<A href="3.30. _25EE_25E1_25ED_25EE_25E2_25EB_25E5_25ED_25E8_25E5 _25EA_25EE_25ED_25F4_25E8_25E3_25F3_25F0_25E0_25F6_25E8_25E8.htm@_=1504708101#_отправка_sms">ОтправкаSMS</a>»
используется картинка <span class="Interface">ПозвонитьИлиОтправитьSMS</span>,
заголовок <span class="Interface">Позвонить или отправить SMS</span>, подсказка <span class="Interface">Позвонить или отправить SMS</span>. Если подсистемы «<A href="3.30. _25EE_25E1_25ED_25EE_25E2_25EB_25E5_25ED_25E8_25E5 _25EA_25EE_25ED_25F4_25E8_25E3_25F3_25F0_25E0_25F6_25E8_25E8.htm@_=1504708101#_отправка_sms">ОтправкаSMS</a>»
нет, то используется картинка <span class="Interface">Позвонить</span>, заголовок
<span class="Interface">Позвонить</span>, подсказка <span class="Interface">Позвонить
по телефону</span>;</p>

<p class="MsoListBullet3">&#9679; 
для типа <span class="Interface">Skype</span>
необходимо установить картинку, заголовок и подсказку <span class="Interface">Skype</span>.</p>

<p class="Paragraph0c">Виды контактной информации, добавляемые в форму вручную,
рекомендуется сделать недоступными для редактирования пользователем. Это можно
сделать в обработчике обновления при помощи процедуры <span class="Interface">УстановитьСвойстваВидаКонтактнойИнформации</span>
из общего модуля <span class="Interface">УправлениеКонтактнойИнформацией</span>.
За недоступность редактирования пользователем отвечает свойство <span class="Interface">ЗапретитьРедактированиеПользователем</span>.</p>

<p class="Paragraph0c">Пример использования см. в форме элемента справочника <span class="Interface">_ДемоКонтрагенты</span> демонстрационной конфигурации.</p>

<a name="issogl3_отложенная_инициализация_элементов_контактной_информации"><h4>Отложенная инициализация элементов контактной информации</h4></a>

<p class="Paragraph0c">Если элементы контактной информации (или их часть)
располагаются на отдельной закладке и работа с ними не является основным
сценарием работы с формой, то можно увеличить скорость открытия формы путем
переноса создания элементов контактной информации с момента открытия формы на
момент перехода на закладку контактной информации.</p>

<p class="Paragraph0c">Использование отложенной инициализации также накладывает
следующие ограничения:</p>

<p class="MsoListBullet">&#9679; 
невозможно перетаскивать элементы со страницы
контактной информации,</p>

<p class="MsoListBullet">&#9679; 
в некоторых случаях возможны «скачки» формы.</p>

<p class="Paragraph0c">Для использования отложенной инициализации необходимо:</p>

<p class="MsoListBullet">&#9679; 
добавить в форму реквизит <span class="Interface">ПараметрыКонтактнойИнформации</span>,
тип – произвольный;</p>

<p class="MsoListBullet">&#9679; 
добавить в форму реквизит <span class="Interface">КонтактнаяИнформацияОписаниеДополнительныхРеквизитов</span>,
тип – таблица значений. Описание колонок и их типов см. в предыдущем разделе;</p>

<p class="MsoListBullet">&#9679; 
в обработчик <span class="Interface">УправлениеКонтактнойИнформацией.ПриСозданииНаСервере</span>
передать в качестве шестого параметра (<span class="Interface">ОтложеннаяИнициализация</span>)
значение <span class="Interface">Истина</span>;</p>

<p class="MsoListBullet">&#9679; 
для страницы контактной информации установить
свойство <span class="Interface">РазрешитьИзменениеСостава</span> в значение <span class="Interface">Ложь</span>;</p>

<p class="MsoListBullet">&#9679; 
для группы страниц, содержащей страницу
контактной информации, добавить обработчик <span class="Interface">ПриСменеСтраницы</span>,
в который добавить код:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    <span class="keyword">Если</span> ТекущаяСтраница<span class="operator">.</span>Имя <span class="operator">=</span> ЭтотОбъект<span class="operator">.</span>ПараметрыКонтактнойИнформации<span class="operator">.</span>ГруппаДляРазмещения <span class="keyword">И</span> <span class="keyword">Не</span>    
     ЭтотОбъект<span class="operator">.</span>ПараметрыКонтактнойИнформации<span class="operator">.</span>ВыполненаОтложеннаяИнициализация <span class="keyword">Тогда</span>
              КонтактнаяИнформацияПриСменеСтраницы<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span></pre>

<p class="MsoListBullet">&#9679; 
в блок процедур контактной информации добавить
процедуру:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> КонтактнаяИнформацияПриСменеСтраницы<span class="operator">(</span><span class="operator">)</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ВыполнитьОтложеннуюИнициализацию<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="MsoListBullet">&#9679; 
если на странице контактной информации нет
статических элементов, то добавить декорацию с именем <span class="Interface">ПустаяДекорацияКонтактнаяИнформация</span>.</p>

<p class="Paragraph0c">Пример использования см. в форме элемента справочника <span class="Interface">_ДемоКонтрагенты</span> демонстрационной конфигурации.</p>

<a name="_хранение_истории_изменений_1"></a><a name="issogl3_хранение_истории_изменений_контактной_информации"><h4>Хранение истории изменений контактной информации</h4></a>

<p class="Paragraph0c">В случае если для ведения учета важно хранить не только текущие
значения полей контактной информации, но и их историю, а также получать
значение на указанную дату, необходимо настроить хранение истории изменения
контактной информации:</p>

<p class="Number81">1. 
Принять решение по поводу состава объектов –
владельцев контактной информацией и видов контактной информации, у которых
необходимо хранить историю изменения контактной информации. Например, у справочника
<span class="Interface">Организации</span> это может быть юридический адрес.</p>

<p class="Number81">2. 
Добавить в табличную часть <span class="Interface">КонтактнаяИнформация</span> этих объектов реквизит <span class="Interface">ДействуетС</span> с типом <span class="Interface">Дата</span>. </p>

<p class="Number81">3. 
Написать обработчик обновления, устанавливающий
флаг о необходимости хранения история изменений для вида контактной информации.
Пример кода обработчика:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    ПараметрыВида <span class="operator">=</span> УправлениеКонтактнойИнформацией<span class="operator">.</span>ПараметрыВидаКонтактнойИнформации<span class="operator">(</span><span class="string">&quot;Адрес&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ПараметрыВида<span class="operator">.</span>ХранитьИсториюИзменений <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span>
  УправлениеКонтактнойИнформацией<span class="operator">.</span>УстановитьСвойстваВидаКонтактнойИнформации<span class="operator">(</span>ПараметрыВида<span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Для получения контактной информации на заданную дату
необходимо в процедурах и функциях <span class="Interface">КонтактнаяИнформацияОбъекта</span>,
<span class="Interface">КонтактнаяИнформацияОбъектов</span>, <span class="Interface">СоздатьВТКонтактнаяИнформация</span>, <span class="Interface">ТаблицаКонтактнойИнформацииОбъекта</span>
указывать параметр <span class="Interface">Дата</span> (например, дату документа
в коде печатных форм). Для записи контактной информации на заданную дату
следует использовать процедуры <span class="Interface">ЗаполнитьКонтактнуюИнформациюОбъектов</span>
и <span class="Interface">ЗаполнитьКонтактнуюИнформациюОбъекта</span> аналогичным
образом. При включенной истории хранения изменений не допускается возможность
ввода нескольких значений контактной информации. Более подробную информацию см.
в комментариях к процедурам.</p>

<p class="Paragraph0c">Пример реализации см. в демонстрационной конфигурации в
справочнике <span class="Interface">_ДемоОрганизации</span> для вида контактной
информации <span class="Interface">Юридический адрес</span>. </p>

<a name="issogl3_заполнение_и_редактирование_контактной_информации_одного_объекта_в_форме_другого_объекта"><h4>Заполнение и редактирование контактной информации одного объекта в форме другого объекта</h4></a>

<p class="Paragraph0c">Имеется возможность выводить контактную информацию объекта
в отдельной форме или форме другого объекта. Такая возможность позволяет
редактировать контактную информацию объекта без необходимости открытия формы
владельца контактной информации.</p>

<p class="Paragraph0c">Например, если необходимо для вывода к уже ранее размещенной
контактной информации элемента справочника <span class="Interface">Демо:
Контакные лица партнеров</span> выводить контактную информацию реквизита <span class="Interface">ФизическоеЛицо</span> ссылающегося на элемент справочника <span class="Interface">Демо: Физические лица</span>, то следует сделать следующие: </p>

<p class="MsoListBullet">&#9679; 
создать реквизит формы <span class="Interface">ФизическоеЛицо</span>
с типом <span class="Interface">СправочникОбъект._ДемоФизическиеЛица</span>,
содержащий объект владельца редактируемой контактной информацией; </p>

<p class="MsoListBullet">&#9679; 
на форме создать группу или страницу с именем <span class="Interface">ГруппаКонтактнаяИнформацияФизическоеЛицо </span>– контейнер, в
который будут добавляться элементы формы для редактирования контактной
информации физического лица; </p>

<p class="MsoListBullet">&#9679; 
в обработчиках событий формы <span class="Interface">ПриСозданииНаСервере</span>, <span class="Interface">ПриЧтенииНаСервере</span>
и <span class="Interface">ПередЗаписьюНаСервере </span>для заполнения и
сохранения контактной информации физического лица добавить аналогичные вызовы,
где в качестве параметров указать реквизит формы <span class="Interface">ФизическоеЛицо</span>
и группу размещения контактной информации:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">#Область ОбработчикиСобытийФормы</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПриСозданииНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриСозданииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">,</span><span class="operator">,</span> ПоложениеЗаголовкаЭлементаФормы<span class="operator">.</span>Лево<span class="operator">)</span><span class="operator">;</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриСозданииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ФизическоеЛицо<span class="operator">,</span> <span class="string">&quot;ГруппаКонтактнаяИнформацияФизическогоЛица&quot;</span><span class="operator">,</span> ПоложениеЗаголовкаЭлементаФормы<span class="operator">.</span>Лево<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПриЧтенииНаСервере<span class="operator">(</span>ТекущийОбъект<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    <span class="keyword">Если</span> ЗначениеЗаполнено<span class="operator">(</span>ТекущийОбъект<span class="operator">.</span>ФизическоеЛицо<span class="operator">)</span> <span class="keyword">Тогда</span>
        ЗначениеВРеквизитФормы<span class="operator">(</span>ТекущийОбъект<span class="operator">.</span>ФизическоеЛицо<span class="operator">.</span>ПолучитьОбъект<span class="operator">(</span><span class="operator">)</span><span class="operator">,</span> <span class="string">&quot;ФизическоеЛицо&quot;</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриЧтенииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ФизическоеЛицо<span class="operator">,</span> <span class="string">&quot;ГруппаКонтактнаяИнформацияФизическогоЛица&quot;</span><span class="operator">)</span><span class="operator">;</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПриЧтенииНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> Объект<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПередЗаписьюНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> ТекущийОбъект<span class="operator">,</span> ПараметрыЗаписи<span class="operator">)</span>
    <span class="comment">// СтандартныеПодсистемы.КонтактнаяИнформация</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПередЗаписьюНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ТекущийОбъект<span class="operator">)</span><span class="operator">;</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>ПередЗаписьюНаСервере<span class="operator">(</span>ЭтотОбъект<span class="operator">,</span> ФизическоеЛицоОбъект<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Конец СтандартныеПодсистемы.КонтактнаяИнформация</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ПриЗаписиНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> ТекущийОбъект<span class="operator">,</span> ПараметрыЗаписи<span class="operator">)</span>
    ФизическоеЛицоОбъект <span class="operator">=</span> РеквизитФормыВЗначение<span class="operator">(</span><span class="string">&quot;ФизическоеЛицо&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ФизическоеЛицоОбъект<span class="operator">.</span>Записать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    ЗначениеВРеквизитФормы<span class="operator">(</span>ФизическоеЛицоОбъект<span class="operator">,</span> <span class="string">&quot;ФизическоеЛицо&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">#КонецОбласти</span></pre>

<p class="MsoListBullet">&#9679; 
добавить код блокирующий для изменения элемент
справочника <span class="Interface">Демо: Физические лица</span>, контактная информация
которого выведна на форму: </p>

<p class="MsoListBullet2">&#9679; 
для этого в обработчики события <span class="Interface">ПриОткрытии</span> подключаем обработчик проверяющий необходимость
блокировки объекта физического лица:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПриОткрытии<span class="operator">(</span>Отказ<span class="operator">)</span>
    ПодключитьОбработчикОжидания<span class="operator">(</span><span class="string">&quot;ПроверитьНеобходимостьБлокировкиФизическогоЛица&quot;</span><span class="operator">,</span> <span class="number">1</span><span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="MsoListBullet2">&#9679; 
и процедуру, вызываемую этим обработчиком для
попытки блокировки элемента справочника физического лица, если информация на
форме была изменена:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПроверитьНеобходимостьБлокировкиФизическогоЛица<span class="operator">(</span><span class="operator">)</span>
    <span class="keyword">Если</span> Модифицированность <span class="keyword">Тогда</span>
        <span class="keyword">Попытка</span>
            ЗаблокироватьДанныеДляРедактирования<span class="operator">(</span>ФизическоеЛицо<span class="operator">.</span>Ссылка<span class="operator">,</span> ФизическоеЛицо<span class="operator">.</span>ВерсияДанных<span class="operator">,</span> ФормаУникальныйИдентификатор<span class="operator">)</span><span class="operator">;</span>
            ОтключитьОбработчикОжидания<span class="operator">(</span><span class="string">&quot;ПроверитьНеобходимостьБлокировкиФизическогоЛица&quot;</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">Исключение</span>
            <span class="keyword">ВызватьИсключение</span> НСтр<span class="operator">(</span><span class="string">&quot;ru = 'Данные контактого лица не могут быть записаны, т.к. личные данные физического лица недоступны для изменения.</span>
<span class="string">            |Возможно, эти данные физического лица редактируются другим пользователем.'&quot;</span><span class="operator">)</span><span class="operator">;</span>
            Прочитать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">КонецПопытки</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">Пример использования см. в форме элемента справочника <span class="Interface">_ДемоКонтактныеЛицаПартнеров</span> демонстрационной
конфигурации.</p>

<a name="issogl3_добавление_произвольных_реквизитов_с_контактной_информацией"><h4>Добавление произвольных реквизитов с контактной информацией</h4></a>

<p class="Paragraph0c">Имеется возможность хранить значения полей контактной
информации не только в стандартной табличной части <span class="Interface">КонтактнаяИнформация</span>,
но и в произвольных реквизитах произвольных объектов конфигурации. Такая
возможность может быть востребована для добавления к объектам отдельных полей с
контактной информацией. </p>

<p class="Paragraph0c">Например, необходимо хранить данные адреса доставки в
документе <span class="Interface">ЗаказПокупателя</span>. При этом в форме документа
должно быть поле <span class="Interface">Адрес доставки</span>, редактируемое с
помощью стандартной формы ввода адреса, и поля <span class="Interface">Дата
доставки</span>, <span class="Interface">Метро</span>, <span class="Interface">Комментарий</span>.
При этом в заказе покупателя не требуются остальные сервисы подсистемы по
заведению других видов контактной информации.</p>

<p class="Paragraph0c">Для решения этой задачи необходимо:</p>

<p class="Number81">1. 
Добавить к документу <span class="Interface">ЗаказПокупателя</span>
основные реквизиты:</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">АдресДоставки</span> типа «строка неограниченной длины». Этот
реквизит будет хранить служебные значения контактной информации адреса
доставки;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ДатаДоставки</span> типа <span class="Interface">Дата</span> для
хранения даты доставки;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Метро</span>. Ссылка на справочник <span class="Interface">СтанцииМетро</span>.</p>

<p class="Number81">2. 
Добавить к документу <span class="Interface">ЗаказПокупателя</span>
вспомогательные реквизиты, данные в которых будут вычисляться при записи документа
по данным реквизита <span class="Interface">АдресДоставки</span>. Эти реквизиты
предназначены для оперативного поиска документов по данным контактной
информации, вывода данных на печать и т. п.</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">АдресДоставкиСтрокой</span> – строка длиной 200 символов;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ГородАдресаДоставки</span> – строка длиной 100 символов.</p>

<p class="Number81">3. 
Поместить в форму вспомогательный реквизит <span class="Interface">ВидКонтактнойИнформацииАдресаДоставки</span> для контроля
работы с адресом и инициализировать его при создании формы:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    ВидКонтактнойИнформацииАдресаДоставки <span class="operator">=</span> <span class="keyword">Новый</span> Структура<span class="operator">;</span>
    ВидКонтактнойИнформацииАдресаДоставки<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;Тип&quot;</span><span class="operator">,</span> Перечисления<span class="operator">.</span>ТипыКонтактнойИнформации<span class="operator">.</span>Адрес    <span class="operator">)</span><span class="operator">;</span>
    ВидКонтактнойИнформацииАдресаДоставки<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;АдресТолькоРоссийский&quot;</span><span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span>
    ВидКонтактнойИнформацииАдресаДоставки<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;ВключатьСтрануВПредставление&quot;</span><span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span>
    ВидКонтактнойИнформацииАдресаДоставки<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;СкрыватьНеактуальныеАдреса&quot;</span><span class="operator">,</span> <span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Bullet0">Эта структура заменяет собой соответствующий элемент
справочника <span class="Interface">ВидыКонтактнойИнформации</span>.</p>

<p class="Number81">4. 
Поместить в форму документа вспомогательный
строковый реквизит <span class="Interface">ПредставлениеАдресаДоставки</span>. Инициализировать
значение реквизита при создании формы:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ПредставлениеАдресаДоставки <span class="operator">=</span> УправлениеКонтактнойИнформацией<span class="operator">.</span>ПредставлениеКонтактнойИнформации<span class="operator">(</span>Объект<span class="operator">.</span>АдресДоставки<span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoListBullet2">&#9679;  создать
соответствующее вспомогательному реквизиту поле ввода, установить у него флажок
<span class="Interface">КнопкаВыбора</span> в <span class="Interface">Истина</span>;
</p>

<p class="MsoListBullet2">&#9679;  определить
обработчики событий для этого элемента:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПредставлениеАдресаДоставкиПриИзменении<span class="operator">(</span>Элемент<span class="operator">)</span>
    Текст <span class="operator">=</span> Элемент<span class="operator">.</span>ТекстРедактирования<span class="operator">;</span>
    <span class="keyword">Если</span> ПустаяСтрока<span class="operator">(</span>Текст<span class="operator">)</span> <span class="keyword">Тогда</span>
        <span class="comment">// Очистка данных.</span>
        <span class="comment">// Cбрасываем как представления, </span>
        <span class="comment">// так и внутренние значения полей</span>
        ПредставлениеАдресаДоставки <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
        КомментарийАдресаДоставки   <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
        Объект<span class="operator">.</span>АдресДоставки        <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="comment">// Формируем внутренние значения полей по тексту </span>
    <span class="comment">// и параметрам</span>
    ПредставлениеАдресаДоставки <span class="operator">=</span> Текст<span class="operator">;</span>
    Объект<span class="operator">.</span>АдресДоставки <span class="operator">=</span> ЗначенияПолейКонтактнойИнформацииСервер<span class="operator">(</span>Текст<span class="operator">,</span>                            
        ВидКонтактнойИнформацииАдресаДоставки<span class="operator">,</span> КомментарийАдресаДоставки<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПредставлениеАдресаДоставкиНачалоВыбора<span class="operator">(</span>Элемент<span class="operator">,</span> ДанныеВыбора<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    <span class="comment">// Если представление было изменено в поле и сразу нажата</span>
    <span class="comment">// кнопка выбора, то необходимо привести данные в соответствие</span>
    <span class="comment">// и сбросить внутренние поля для повторного репарсинга</span>
    <span class="keyword">Если</span> Элемент<span class="operator">.</span>ТекстРедактирования<span class="operator">&lt;</span><span class="operator">&gt;</span>ПредставлениеАдресаДоставки <span class="keyword">Тогда</span>
        ПредставлениеАдресаДоставки <span class="operator">=</span> Элемент<span class="operator">.</span>ТекстРедактирования<span class="operator">;</span>
        Объект<span class="operator">.</span>АдресДоставки <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="comment">// Данные для редактирования</span>
    ПараметрыОткрытия <span class="operator">=</span> <span class="keyword">Новый</span> Структура<span class="operator">;</span>
    ПараметрыОткрытия<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;ВидКонтактнойИнформации&quot;</span><span class="operator">,</span> ВидКонтактнойИнформацииАдресаДоставки<span class="operator">)</span><span class="operator">;</span>
    ПараметрыОткрытия<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;ЗначенияПолей&quot;</span><span class="operator">,</span> Объект<span class="operator">.</span>АдресДоставки<span class="operator">)</span><span class="operator">;</span>
    ПараметрыОткрытия<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;Представление&quot;</span><span class="operator">,</span> ПредставлениеАдресаДоставки<span class="operator">)</span><span class="operator">;</span>
    ПараметрыОткрытия<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;Комментарий&quot;</span><span class="operator">,</span> КомментарийАдресаДоставки<span class="operator">)</span><span class="operator">;</span>
    <span class="comment">// Переопределямый заголовок формы,</span>
    <span class="comment">// по умолчанию отобразятся данные по ВидКонтактнойИнформации</span>
    ПараметрыОткрытия<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;Заголовок&quot;</span><span class="operator">,</span> НСтр<span class="operator">(</span><span class="string">&quot;ru='Адрес доставки'&quot;</span><span class="operator">)</span><span class="operator">)</span><span class="operator">;</span>
    УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>ОткрытьФормуКонтактнойИнформации<span class="operator">(</span>ПараметрыОткрытия<span class="operator">,</span> Элемент    <span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПредставлениеАдресаДоставкиОчистка<span class="operator">(</span>Элемент<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    <span class="comment">// Сбрасываем как представления,</span>
    <span class="comment">//  так и внутренние значения полей</span>
    ПредставлениеАдресаДоставки <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
    КомментарийАдресаДоставки   <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
    Объект<span class="operator">.</span>АдресДоставки        <span class="operator">=</span> <span class="string">&quot;&quot;</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> ПредставлениеАдресаДоставкиОбработкаВыбора<span class="operator">(</span>Элемент<span class="operator">,</span> ВыбранноеЗначение<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    СтандартнаяОбработка <span class="operator">=</span> <span class="keyword">Ложь</span><span class="operator">;</span>
    <span class="keyword">Если</span> ТипЗнч<span class="operator">(</span>ВыбранноеЗначение<span class="operator">)</span><span class="operator">&lt;</span><span class="operator">&gt;</span>Тип<span class="operator">(</span><span class="string">&quot;Структура&quot;</span><span class="operator">)</span> <span class="keyword">Тогда</span>
        <span class="comment">// Отказ от выбора, данные неизменны</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    ПредставлениеАдресаДоставки <span class="operator">=</span> ВыбранноеЗначение<span class="operator">.</span>Представление<span class="operator">;</span>
    КомментарийАдресаДоставки   <span class="operator">=</span> ВыбранноеЗначение<span class="operator">.</span>Комментарий<span class="operator">;</span>
    Объект<span class="operator">.</span>АдресДоставки        <span class="operator">=</span> ВыбранноеЗначение<span class="operator">.</span>КонтактнаяИнформация<span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Bullet0">Следует заметить, что если функционал ввода адреса строкой не
требуется, то можно обойтись без этого вспомогательного поля ввода, заменив
его, например, на гиперссылку. Текст гиперссылки при этом будет представлением
адреса, а обработчик нажатия аналогичен обработчику <span class="Interface">НачалоВыбора</span>.</p>

<p class="Number81">5. 
Поместить в форму вспомогательный реквизит <span class="Interface">КомментарийАдресаДоставки</span> для редактирования комментария,
не попадающего в основное представление адреса. Инициализировать его при создании
формы:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">КомментарийАдресаДоставки <span class="operator">=</span> 
УправлениеКонтактнойИнформацией<span class="operator">.</span>КомментарийКонтактнойИнформации<span class="operator">(</span>
    Объект<span class="operator">.</span>АдресДоставки
<span class="operator">)</span><span class="operator">;</span></pre>

<p class="Number81">6. 
Поместить в форму поле ввода и связать его с
реквизитом <span class="Interface">КомментарийАдресаДоставки</span>. Определить
следующие обработчики изменений:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="preprocessor">&amp;НаКлиенте</span>
<span class="keyword">Процедура</span> КомментарийАдресаДоставкиПриИзменении<span class="operator">(</span>Элемент<span class="operator">)</span>
    ЗаполнитьКомментарийАдресаДоставкиСервер<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span>
<span class="comment">// Устанавливаем новый комментарий для адреса доставки</span>
<span class="comment">// </span>
<span class="preprocessor">&amp;НаСервере</span>
<span class="keyword">Процедура</span> ЗаполнитьКомментарийАдресаДоставкиСервер<span class="operator">(</span><span class="operator">)</span>
    <span class="keyword">Если</span> ПустаяСтрока<span class="operator">(</span>Объект<span class="operator">.</span>АдресДоставки<span class="operator">)</span> <span class="keyword">Тогда</span>
        <span class="comment">// Необходимо инициализировать данные</span>
        Объект<span class="operator">.</span>АдресДоставки <span class="operator">=</span> ЗначенияПолейКонтактнойИнформацииСервер<span class="operator">(</span>ПредставлениеАдресаДоставки<span class="operator">,</span>
                ВидКонтактнойИнформацииАдресаДоставки<span class="operator">,</span> КомментарийАдресаДоставки<span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    УправлениеКонтактнойИнформацией<span class="operator">.</span>КомментарийКонтактнойИнформации<span class="operator">(</span>Объект<span class="operator">.</span>АдресДоставки<span class="operator">,</span>       
         КомментарийАдресаДоставки<span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Number81">7. 
Поместить в форму документа поля ввода,
связанные с реквизитами объекта <span class="Interface">ДатаДоставки</span> и <span class="Interface">Метро</span>.</p>

<p class="Number81">8. 
В модуле объекта документа, в обработчике
события <span class="Interface">ПередЗаписью</span> заполнить вспомогательные
реквизиты:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    ГородДоставки <span class="operator">=</span> УправлениеКонтактнойИнформацией<span class="operator">.</span>ГородАдресаКонтактнойИнформации<span class="operator">(</span>АдресДоставки<span class="operator">)</span><span class="operator">;</span>
    АдресДоставкиСтрокой <span class="operator">=</span> УправлениеКонтактнойИнформацией<span class="operator">.</span>ПредставлениеКонтактнойИнформации<span class="operator">(</span>АдресДоставки<span class="operator">)</span><span class="operator">;</span></pre>

<p class="Bullet0">БСП обеспечивает программный интерфейс для оперирования
данными:</p>

<p class="MsoListBullet2">&#9679;  методы
для разбора контактной информации из строки представления;</p>

<p class="MsoListBullet2">&#9679;  методы
для формирования представления контактной информации;</p>

<p class="MsoListBullet2">&#9679;  методы
для получения и установки значений частей контактной информации (например, комментария,
страны адреса, города адреса и т. п.);</p>

<p class="MsoListBullet2">&#9679;  методы
для сравнения объектов контактной информации.</p>

<p class="Paragraph0c">Пример реализации см. в демонстрационной конфигурации в
реквизите <span class="Interface">АдресДоставки</span> документа <span class="Interface">_ДемоЗаказПокупателя</span>.</p>

<a name="_настройка_дополнительных_характерис"></a><a name="_хранение_истории_изменений"></a><a name="issogl3_отключение_неиспользуемых_видов_контактной_информации"><h4>Отключение неиспользуемых видов контактной информации</h4></a>

<p class="Paragraph0c">В случае если объект – владелец контактной информации
отключен по функциональной опции, имеется возможность отключить неиспользуемый
вид контактной информации. Для этого можно воспользоваться свойством <span class="Interface">Используется</span> вида контактной информации. При установке
значения свойства <span class="Interface">Используется</span> в значение <span class="Interface">Ложь</span> вид контактной информации перестает отображаться в
форме списка, а также в форме объекта – владельца контактной информации.
Устанавливать свойство <span class="Interface">Используется</span> можно как для
отдельных видов контактной информации, так и для всей контактной информации
объекта владельца (группа видов контактной информации). Для отключения
неиспользуемого вида контактной информации необходимо:</p>

<p class="MsoListBullet">&#9679; 
Написать обработчик обновления, отключающий
неиспользуемые виды контактной информации при переходе на новую версию. Пример
кода обработчика:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">КонтактныеЛицПартнеров <span class="operator">=</span> Справочники<span class="operator">.</span>ВидыКонтактнойИнформации<span class="operator">.</span>Справочник_ДемоКонтактныеЛицаПартнеров<span class="operator">.</span>ПолучитьОбъект<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    КонтактныеЛицПартнеров<span class="operator">.</span>Используется <span class="operator">=</span>     ПолучитьФункциональнуюОпцию<span class="operator">(</span><span class="string">&quot;_ДемоИспользоватьКонтактныеЛицаПартнеров&quot;</span><span class="operator">)</span><span class="operator">;</span>
    ОбновлениеИнформационнойБазы<span class="operator">.</span>ЗаписатьДанные<span class="operator">(</span>КонтактныеЛицПартнеров<span class="operator">)</span><span class="operator">;</span></pre>

<p class="MsoListBullet">&#9679; 
Добавить аналогичный код в событие при изменении
значения функциональной опции. См. пример в событии <span class="Interface">ПриЗаписи</span>
в модуле менеджера значения константы _<span class="Interface">ДемоИспользоватьКонтактныеЛицаПартнеров</span>.</p>

<a name="issogl3_добавление_реквизитов_типа_справочникссылка.странымира"><h4>Добавление реквизитов типа «СправочникСсылка.СтраныМира»</h4></a>

<p class="Paragraph0c">В общем случае при добавлении реквизита типа <span class="Interface">СправочникСсылка.СтраныМира</span> можно выбирать любой элемент
справочника. Но если список выбираемых стран мира должен быть регламентирован
(т. е. разрешен выбор стран только из классификатора), то дополнительно следует
в свойстве <span class="Interface">ПараметрыВыбора</span> элемента формы (поля
ввода) указать:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">РазрешитьДанныеКлассификатора
– Булево</span>, <span class="Interface">Истина</span>;</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ТолькоДанныеКлассификатора
– Булево</span>, <span class="Interface">Истина</span>.</p>

<p class="Paragraph0c">Также есть возможность автоматически создавать новые
элементы справочника <span class="Interface">СтраныМира</span> при выборе
автоподбором. Для этого необходимо в модуле формы в обработчике события <span class="Interface">ОбработкаВыбора</span> вставить вызов:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    УправлениеКонтактнойИнформациейКлиент<span class="operator">.</span>СтранаМираОбработкаВыбора<span class="operator">(</span>Элемент<span class="operator">,</span> ВыбранноеЗначение<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Пример использования см. в форме элемента справочника <span class="Interface">_ДемоНоменклатура</span> демонстрационной конфигурации.</p>

<a name="issogl3_совместное_внедрение_с_другими_подсистемами"><h4>Совместное внедрение с другими подсистемами</h4></a>

<p class="MsoListBullet">&#9679; 
<A href="3.59. _25EE_25F1_25EE_25E1_25FB_25E5 _25F1_25EB_25F3_25F7_25E0_25E8 _25E2_25ED_25E5_25E4_25F0_25E5_20EA087B14A#_внедрение_подсистемы_«пользователи»">Внедрение подсистемы «Пользователи» без
подсистемы «Контактная информация»</a>.</p>

<a name="issogl1_использование_при_разработке_конфигурации"><h2>Использование при разработке конфигурации</h2></a>

<p class="Paragraph0c">При разработке новых или доработке существующих
предопределенных видов контактной информации необходимо предусмотреть их
обновление при помощи обработчика обновления.</p>

<a name="issogl2_автоматическое_добавление_элементов_в_справочник_странымира_из_классификатора_стран_мира_оксм"><h3>Автоматическое добавление элементов в справочник «СтраныМира» из классификатора стран мира (ОКСМ)</h3></a>

<p class="Paragraph0c">По умолчанию справочник <span class="Interface">СтраныМира</span>
содержит только один предопределенный элемент <span class="Interface">Россия</span>.
Пользователи с соответствующими правами могут добавлять в справочник новые
элементы – как вручную, так и с помощью подбора из классификатора стран мира.
При этом новые элементы справочника могут быть автоматически созданы по данным
классификатора в процессе выбора и непосредственно при автоподборе в поле ввода
страны. </p>

<p class="Paragraph0c">Таким образом, в справочнике <span class="Interface">СтраныМира</span>
содержатся только те страны, которые используются в учете.</p>

<a name="issogl2_настройка_обмена_данными"><h3>Настройка обмена данными</h3></a>

<p class="Paragraph0c">Для настройки обмена данными следует руководствоваться
общими правилами. В план обмена необходимо включить все объекты метаданных,
содержащие данные, кроме регистра сведений <span class="Interface">УдалитьСтраныМира</span>.</p>

<p class="Paragraph0c">При включении справочника <span class="Interface">СтраныМира</span>
в план обмена между различными прикладными решениями с использованием правил
конвертации необходимо настроить в правиле конвертации объекта (ПКО) поиск по
ссылке, а затем по полям поиска – составному ключу <span class="Interface">Код</span>
и <span class="Interface">Наименование</span>.</p>

<a name="issogl3_настройка_обмена_данными_с_предыдущими_версиями"><h4>Настройка обмена данными с предыдущими версиями</h4></a>

<p class="MsoListBullet">&#9679; 
При синхронизации контактной информации с
конфигурациями на базе БСП версии 2.1.2 и меньше необходимо при выгрузке в эту
конфигурацию производить конвертацию реквизита <span class="Interface">ЗначенияПолей</span>
табличной части <span class="Interface">КонтактнаяИнформация</span> при помощи
вызова:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Значение <span class="operator">=</span> УправлениеКонтактнойИнформацией<span class="operator">.</span>ПредыдущийФорматКонтактнойИнформацииXML<span class="operator">(</span>Значение<span class="operator">,</span> <span class="keyword">Истина</span><span class="operator">)</span></pre>

<p class="Paragraph0c">При использовании правил конвертации для этого необходимо
вписать приведенный выше код в обработчик <span class="Interface">ПриВыгрузке</span>
правила конвертации свойства (ПКС) для реквизита <span class="Interface">ЗначенияПолей</span>
табличной части <span class="Interface">КонтактнаяИнформация</span>.</p>

<p class="MsoListBullet">&#9679; 
При синхронизации контактной информации с
конфигурациями на базе БСП редакции 2.2 и меньше, необходимо в правилах
конвертации настроить правила выгрузки из БСП 2.3.1 в БСП 2.2 таким образом,
чтобы для объектов – владельцев контактной информации исключать выгрузку:</p>

<p class="MsoListBullet2">&#9679;  реквизита
<span class="Interface">ВидДляСписка</span> табличной части <span class="Interface">КонтактнаяИнформация</span>; </p>

<p class="MsoListBullet2">&#9679;  всех
строк табличной части <span class="Interface">КонтактнаяИнформация</span> с типом
контактной информации <span class="Interface">Skype</span>.</p>

<p class="MsoListBullet"><a name="_напоминания_пользователя"></a>&#9679; 
Если табличная часть <span class="Interface">КонтактнаяИнформация</span>
содержит реквизит <span class="Interface">ДействуетС</span>, то при синхронизации
контактной информации с конфигурациями на базе БСП версии 2.3.1 и меньше для
видов контактной информации с установленным свойством <span class="Interface">ХранитьИсториюИзменений</span>
необходимо настроить правила обмена следующим образом:</p>

<p class="MsoListBullet2">&#9679;  при
выгрузке данных – если у вида контактной информации существует несколько
записей с разными датами в реквизите <span class="Interface">ДействуетС</span>,
то в выгрузку включается только актуальная (действующая) запись. Все исторические
записи игнорируются и в выгрузку не попадают;</p>

<p class="MsoListBullet2">&#9679;  при
загрузке данных – все записи этого вида контактной информации сохраняются без
изменений. Но в случае, когда<span class="Interface"> </span>загружаемая запись
отличается от данных текущей (действующей) записи этого вида контактной
информации, в табличную часть <span class="Interface">КонтактнаяИнформация</span>
добавляется новая строка с загружаемыми данными, а реквизиту <span class="Interface">ДействуетС </span>новой строки контактной информации присваивается
текущая дата сеанса, т. к. эта запись становится актуальной<span class="Interface"> </span>(действующей). </p>

<p class="Paragraph0c">Пример использования см. в демонстрационной конфигурации, в
макетах <span class="Interface">ПравилаОбмена</span> и <span class="Interface">ПравилаОбменаКорреспондента</span>
плана обмена _<span class="Interface">ДемоОбменСБиблиотекойСтандартныхПодсистем225</span>.</p>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>