<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>3.29. &#1054;&#1073;&#1085;&#1086;&#1074;&#1083;&#1077;&#1085;&#1080;&#1077; &#1074;&#1077;&#1088;&#1089;&#1080;&#1080; &#1048;&#1041;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js@_=1504708101" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="3.29. _25EE_25E1_25ED_25EE_25E2_25EB_25E5_25ED_25E8_25E5 _25E2_25E5_25F0_25F1_25E8_25E8 _25E8_25E1.htm" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<h1>3.29. Обновление версии ИБ</h1>

<p class="Paragraph0c">Подсистема «Обновление версии ИБ» предоставляет программный
интерфейс для выполнения процедур-обработчиков по первоначальному заполнению и
обновлению данных информационной базы (ИБ) при изменении версии конфигурации, а
также позволяет выводить отчет об изменениях в новой версии конфигурации.</p>

<p class="Paragraph0c">Принципиальная схема обновления конфигурации
информационной базы представлена на рисунке.</p>

<p class="Picture"><IMG src="_img/bb4930f70ba50b6391a4d4b0238cf1d5/image020.png@_=1504708101" WIDTH="800" ALT HEIGHT="444"></p>

<p class="Paragraph0c">При запуске клиентского приложения подсистема «Обновление
версии ИБ» проверяет, не изменилась ли конфигурация. Если версия конфигурации
отличается от версии, сохраненной в информационной базе, то при запуске системы
с административными правами выполняется обновление информационной базы. В этом
случае, подсистема «Обновление версии ИБ» последовательно выполняет процедуры –
обработчики обновления в интервале от номера версии информационной базы до
номера версии конфигурации включительно и записывает в информационную базу
текущую версию конфигурации. </p>

<p class="Paragraph0c">После обновления информационной базы подсистема
«Обновление версии ИБ» выводит форму <span class="Interface">Описание обновлений</span>,
в которой администратор может ознакомиться с описанием изменений в текущей
версии конфигурации. </p>

<p class="Paragraph0c">Если у пользователя недостаточно прав (нет прав <span class="Interface">МонопольныйРежим</span> и <span class="Interface">Администрирование</span>)
или при обновлении происходит ошибка, то запуск системы останавливается. </p>

<p class="Paragraph0c">Если в конфигурации предусмотрены отложенные процедуры – обработчики
обновления, то в клиент-серверной версии они запускаются в фоне с помощью
регламентного задания <span class="Interface">Отложенное обновление ИБ</span>,
параллельно с началом работы пользователей с новой версией программы. В
файловом режиме работы отложенные обработчики выполняются сразу, в основном
цикле обновления.</p>

<a name="issogl1_настройка"><h2>Настройка</h2></a>

<a name="_подготовка_к_использованию"></a><a name="issogl2_подготовка_к_использованию_подсистемы"><h3>Подготовка к использованию подсистемы</h3></a>

<p class="Paragraph0c">Для библиотеки или конечной конфигурации создать отдельный
общий модуль с именем <span class="Interface">ОбновлениеИнформационнойБазы&lt;Сокращение&gt;</span>,
где сокращение – короткое имя библиотеки или конфигурации. Пример: общий модуль
<span class="Interface">ОбновлениеИнформационнойБазыБСП</span>. </p>

<p class="Paragraph0c">Затем добавить имя созданного модуля в процедуру <span class="Interface">ПриДобавленииПодсистем</span> общего модуля <span class="Interface">ПодсистемыКонфигурацииПереопределяемый</span>.</p>

<p class="Paragraph0c">Из общего модуля <span class="Interface">ОбновлениеИнформационнойБазыБСП</span>
скопировать определения следующих процедур (очистив их содержимое) в созданный
общий модуль:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ПриДобавленииПодсистемы<span class="operator">(</span>Описание<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span>
<span class="keyword">Процедура</span> ПриДобавленииОбработчиковОбновления<span class="operator">(</span>Обработчики<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span>
<span class="keyword">Процедура</span> ПередОбновлениемИнформационнойБазы<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span>
<span class="keyword">Процедура</span> ПослеОбновленияИнформационнойБазы<span class="operator">(</span><span class="keyword">Знач</span> ПредыдущаяВерсия<span class="operator">,</span> <span class="keyword">Знач</span> ТекущаяВерсия<span class="operator">,</span>
        <span class="keyword">Знач</span> ВыполненныеОбработчики<span class="operator">,</span> ВыводитьОписаниеОбновлений<span class="operator">,</span> МонопольныйРежим<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span>
<span class="keyword">Процедура</span> ПриПодготовкеМакетаОписанияОбновлений<span class="operator">(</span><span class="keyword">Знач</span> Макет<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">Для конечных конфигураций также добавить три процедуры:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПриДобавленииОбработчиковПереходаСДругойПрограммы</span>,
</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПриОпределенииРежимаОбновленияДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПриЗавершенииПереходаСДругойПрограммы</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ПриДобавленииОбработчиковПереходаСДругойПрограммы<span class="operator">(</span>Обработчики<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span>
<span class="keyword">Процедура</span> ПриОпределенииРежимаОбновленияДанных<span class="operator">(</span>РежимОбновленияДанных<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span> 
<span class="keyword">Процедура</span> ПриЗавершенииПереходаСДругойПрограммы<span class="operator">(</span><span class="keyword">Знач</span> ПредыдущееИмяКонфигурации<span class="operator">,</span> <span class="keyword">Знач</span> ПредыдущаяВерсияКонфигурации<span class="operator">,</span> Параметры<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">Пример реализации см. в общем модуле <span class="Interface">_ДемоОбновлениеИнформационнойБазыБСП</span> демонстрационной
конфигурации.</p>

<p class="Paragraph0c">Затем в процедуру <span class="Interface">ПриДобавленииПодсистемы</span>
вписать имя и версию библиотеки или конфигурации, а также зависимости от других
библиотек (если предусмотрены). По указанным зависимостям вычисляется порядок
вызова обработчиков обновления данных библиотек. Если зависимости не указаны,
порядок вызова обработчиков библиотек определяется порядком добавления имен
модулей библиотек в общем модуле <span class="Interface">ПодсистемыКонфигурацииПереопределяемый</span>.
При этом библиотека с именем <span class="Interface">СтандартныеПодсистемы</span>
будет вызываться первой, а библиотека у которой имя совпадает со значением
свойства <span class="Interface">Метаданные.Имя</span> всегда будет вызываться
последней.</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="comment">// См. описание этой же процедуры в модуле ОбновлениеИнформационнойБазыБСП.</span>
<span class="keyword">Процедура</span> ПриДобавленииПодсистемы<span class="operator">(</span>Описание<span class="operator">)</span> <span class="keyword">Экспорт</span>
    Описание<span class="operator">.</span>Имя <span class="operator">=</span> <span class="string">&quot;БиблиотекаСтандартныхПодсистемДемо&quot;</span><span class="operator">;</span>
    Описание<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;2.1.3.24&quot;</span><span class="operator">;</span>
    <span class="comment">// Требуется библиотека стандартных подсистем.</span>
    Описание<span class="operator">.</span>ТребуемыеПодсистемы<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;СтандартныеПодсистемы&quot;</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">При этом в коде процедуры <span class="Interface">ПриДобавленииПодсистемы</span>
не следует получать имя и версию напрямую из свойств конфигурации <span class="Interface">Метаданные.Имя</span> и <span class="Interface">Метаданные.Версия</span>.
В противном случае при доработке конфигураций потребуется снимать с поддержки и
вносить изменения в модуль обновления поставщика.</p>

<a name="issogl2_размещение_в_командном_интерфейсе"><h3>Размещение в командном интерфейсе</h3></a>

<p class="Paragraph0c">Если в конфигурации не используется подсистема «Настройки
программы», то в командном интерфейсе администратора необходимо разместить
следующие объекты метаданных:</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ДетализироватьОбновлениеИБВЖурналеРегистрации</span>,</p>

<p class="MsoListBullet">&#9679; 
общая форма <span class="Interface">ОписаниеИзмененийПрограммы</span>,</p>

<p class="MsoListBullet">&#9679; 
обработка <span class="Interface">РезультатыОбновленияПрограммы</span>.</p>

<p class="Paragraph0c">См. пример размещения в демонстрационной конфигурации в
группе <span class="Interface">Обновление версии программы</span> формы <span class="Interface">ПоискИУстановкаОбновлений</span> обработки <span class="Interface">ПанельАдминистрированияБСП</span>.</p>

<a name="issogl2_создать_общий_макет_описаниеизмененийсистемы"><h3>Создать общий макет «ОписаниеИзмененийСистемы»</h3></a>

<p class="Paragraph0c">Описание изменений в новой версии готовится разработчиками
конфигурации к выпуску каждой версии конфигурации в общем табличном макете <span class="Interface">ОписаниеИзмененийСистемы</span>. Табличный макет может включать
в себя столько разделов, сколько версий содержится в истории версий продукта. </p>

<p class="Paragraph0c">Каждый такой раздел состоит из двух областей:</p>

<p class="MsoListBullet">&#9679; 
В область <span class="Interface">ШапкаР_П_В_С</span>
помещается текст заголовка <span class="Interface">Новое в версии Р.П.В.С</span>.</p>

<p class="MsoListBullet">&#9679; 
Область <span class="Interface">ВерсияР_П_В_С</span>
содержит описание изменений данной версии; может состоять из подразделов или содержать
гиперссылки.</p>

<p class="Paragraph0c">Разделы между собой отделяются отступом, который
определяется областью <span class="Interface">Отступ</span>.</p>

<p class="Paragraph0c">Для специальной обработки нажатий на гиперссылки,
содержащихся в тексте макета, предназначена процедура-обработчик <span class="Interface">ПриНажатииНаГиперссылкуВДокументеОписанияОбновлений</span>
общего модуля <span class="Interface">ОбновлениеИнформационнойБазыКлиентПереопределяемый</span>.
</p>

<p class="Paragraph0c">Пример заполнения макета можно посмотреть в
демонстрационной конфигурации.</p>

<p class="Warningword">Важно!</p>

<p class="Notes">При первом внедрении макет <span class="Interface">ОписаниеИзмененийСистемы</span>
следует создать до выполнения первого запуска конфигурации в режиме <span class="Interface">1С:Предприятие</span>. </p>

<a name="issogl2_настройка_прав_доступа_пользователей"><h3>Настройка прав доступа пользователей</h3></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей к данным и
функциям подсистемы «Обновление версии ИБ» следует использовать роли, указанные
ниже.</p>

<p class="Objectname">Таблица 3.63.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">АдминистраторСистемы</span> (из подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Запуск программы
  для обновления версии ИБ</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">БазовыеПрава</span> (из подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Просмотр
  описания изменения системы</p>
  </td>
 </tr>
</table>

<a name="_настройка_обмена_данными"></a><a name="issogl2_настройка_обмена_данными"><h3>Настройка обмена данными</h3></a>

<p class="Paragraph0c">Для настройки обмена данными следует руководствоваться
общими правилами.</p>

<p class="Paragraph0c">В планы обмена распределенной информационной базы (РИБ)
рекомендуется включать все объекты метаданных подсистемы, кроме константы <span class="Interface">РазделыОписанияИзмененийСистемы</span>.</p>

<p class="Paragraph0c">В планах обмена распределенной информационной базы (РИБ)
рекомендуется отключать регистрацию изменений для следующих объектов метаданных
подсистемы (см. также раздел «<A href="3.28. _25EE_25E1_25EC_25E5_25ED _25E4_25E0_25ED_25ED_25FB_25EC_25E8.htm@_=1504708101#_особенности_создания_начального">Особенности создания начального образа
подчиненного узла распределенной ИБ</a>»):</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ДетализироватьОбновлениеИБВЖурналеРегистрации</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">СведенияОбОбновленииИБ</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ВерсииПодсистем</span>.</p>

<p class="Paragraph0c">Из остальных планов обмена (не РИБ) рекомендуется
исключать следующие объекты метаданных:</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ДетализироватьОбновлениеИБВЖурналеРегистрации</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">РазделыОписанияИзмененийСистемы</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">СведенияОбОбновленииИБ</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ВерсииПодсистем</span>.</p>

<a name="_использование_при_разработке_1"></a><a name="issogl1_использование_при_разработке_конфигурации"><h2>Использование при разработке конфигурации</h2></a>

<a name="issogl2_разработка_обработчиков_обновления"><h3>Разработка обработчиков обновления</h3></a>

<p class="Paragraph0c">Для подключения своих обработчиков обновления необходимо в
модуль обновления информационной базы библиотеки или конфигурации, созданный на
предыдущем шаге, добавить описание обработчиков обновления в процедуру <span class="Interface">ПриДобавленииОбработчиковОбновления</span>.</p>

<p class="Paragraph0c">Для каждого обработчика обновления нужно добавить фрагмент
кода по шаблону:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;&lt;номер версии&gt;&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;&lt;полное имя экспортной процедуры&gt;&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>НачальноеЗаполнение <span class="operator">=</span> {Истина|Ложь}<span class="operator">;</span>
Обработчик<span class="operator">.</span>РежимВыполнения <span class="operator">=</span> {<span class="string">&quot;Монопольно&quot;</span>|<span class="string">&quot;Оперативно&quot;</span>|<span class="string">&quot;Отложенно&quot;</span>}<span class="operator">;</span></pre>

<p class="Paragraph0c">Строка таблицы значений <span class="Interface">Обработчик</span>
имеет различный состав полей, который зависит от вида обработчика обновления:
монопольный, оперативный или отложенный. Свойства, общие для всех видов
обработчиков обновления:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Версия</span> (<span class="Interface">Строка</span>) – номер версии конфигурации, при обновлении на
которую должна быть вызвана процедура обновления, указанная в параметре <span class="Interface">Процедура</span>. </p>

<p class="MsoListBullet2">&#9679;  номер
версии конфигурации указывается в формате <span class="Interface">Р.П.В.С</span>
(Р – старший номер редакции; П – младший номер редакции; В – номер версии; С –
номер сборки); </p>

<p class="MsoListBullet2">&#9679;  если
в качестве версии указан символ «<span class="Interface">*</span>», то обработчик
обновления должен выполняться каждый раз при обновлении информационной базы,
независимо от номера версии конфигурации;</p>

<p class="MsoListBullet2">&#9679;  если
свойство <span class="Interface">Версия</span> не задано, то должно быть
установлено в <span class="Interface">Истина</span> свойство <span class="Interface">НачальноеЗаполнение</span> (см. далее).</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Процедура</span> (<span class="Interface">Строка</span>) – имя процедуры обновления. Процедура обновления
должна располагаться в серверном общем модуле и должна быть экспортной.
Например, <span class="Interface">ОбновлениеИБ.ПерейтиНаВерсию_1_2_3_4</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">НачальноеЗаполнение</span>
(<span class="Interface">Булево</span>) – если <span class="Interface">Истина</span>,
то процедура обновления будет вызвана при первом запуске на пустой информационной
базе (версия «0.0.0.0»), созданной из файла поставки конфигурации и не содержащей
данных. Это обработчики первоначального заполнения базы. По умолчанию – <span class="Interface">Ложь</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">РежимВыполнения</span> (<span class="Interface">Строка</span>) – принимает одно из значений: <span class="Interface">Монопольно</span>, <span class="Interface">Оперативно</span> и <span class="Interface">Отложенно</span>. Если свойство не задано, то обработчик –
монопольный. </p>

<p class="Bullet0"> </p>

<p class="Paragraph0c">Например, для выполнения двух экспортных процедур <span class="Interface">ВыполнятьВсегдаПриСменеВерсии</span> и <span class="Interface">ПерейтиНаВерсию_1_0_0_5</span>
общего модуля <span class="Interface">_ДемоОбновлениеИнформационнойБазыБСП</span>
при переходе с версии 1.0.0.1 на версию 1.0.0.5 необходимо разместить следующий
фрагмент кода в процедуре <span class="Interface">ПриДобавленииОбработчиковОбновления</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ПриДобавленииОбработчиковОбновления<span class="operator">(</span>Обработчики<span class="operator">)</span> <span class="keyword">Экспорт</span>
<span class="comment">// Подключаются процедуры – обработчики обновления конфигурации.</span>
Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;1.0.0.0&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;_ДемоОбновлениеИнформационнойБазыБСП.ПерейтиНаВерсию_1_0_0_0&quot;</span><span class="operator">;</span>
Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;1.0.0.5&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;_ДемоОбновлениеИнформационнойБазыБСП.ПерейтиНаВерсию_1_0_0_5&quot;</span><span class="operator">;</span>
Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;*&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;_ДемоОбновлениеИнформационнойБазыБСП.ВыполнятьВсегдаПриСменеВерсии&quot;</span><span class="operator">;</span>
<span class="keyword">КонецПроцедуры</span></pre>

<a name="issogl2_как_выбрать_способ_обработки_данных_монопольный_оперативный_или_отложенный"><h3>Как выбрать способ обработки данных: монопольный, оперативный или отложенный</h3></a>

<p class="Paragraph0c">В зависимости от значения свойства <span class="Interface">РежимВыполнения</span>
можно выбрать наиболее эффективный способ обработки данных.</p>

<p class="Number81">1. 
<span class="Interface">Монопольно</span> – если
обработчик обновления необходимо выполнять монопольно, в условиях отсутствия активных
сеансов работы пользователей, регламентных заданий, внешних соединений и
подключений по веб-сервисам. В противном случае обновление версии программы прерывается.</p>

<p class="Bullet0">Монопольные обработчики предназначены для обновления тех
данных, обработка которых должна быть обязательно завершена к моменту входа
пользователей в программу. Для сокращения времени простоя (ожидания обработки
данных), рекомендуется большие объемы данных обновлять отложено (см. ниже).
Примеры монопольных обработчиков: обработка небольшого объема данных текущего
периода, активных позиций номенклатуры и т. п.</p>

<p class="Bullet0">Если хотя бы один обработчик обновления конфигурации –
монопольный, то все оперативные обработчики (см. далее) выполняются в
монопольном режиме.</p>

<p class="Number81">2. 
<span class="Interface">Оперативно</span> – если
обработчик обновления необходимо выполнять не монопольно: при активных сеансах
работы пользователей, регламентных заданий, внешних соединений и подключений через
веб-сервисы.</p>

<p class="Bullet0">Оперативные обработчики следует применять в редких случаях,
когда важно сократить время ожидания пользователей на обновление информационной
базы – например, для обработки неразделенных данных в модели сервиса,
инициализации настроек пользователей и т. п. Как правило, их следует применять
только при выпуске исправительных релизов.</p>

<p class="Bullet0">Подробнее об оперативном обновлении см. раздел «<a href="#_оперативное_обновление_на">Оперативное
обновление на исправительные релизы конфигураций</a>».</p>

<p class="Number81">3. 
<span class="Interface">Отложенно</span> – если обработчик
обновления необходимо выполнять в фоне после того, как завершено выполнение
монопольных (оперативных) обработчиков, и пользователям уже разрешен вход в
программу.</p>

<p class="Bullet0">Отложенные обработчики предназначены для обработки той части
данных ИБ, которые не препятствуют пользователям начинать свою работу с новой
версией программы, не дожидаясь завершения обработки этих данных. Примеры
отложенных обработчиков: обработка больших архивов данных за закрытые/прошлые
периоды, неактивных позиций номенклатуры, различных данных, отключенных в
данный момент функциональными опциями и т. п.</p>

<p class="Bullet0">Подробнее об отложенной обработке данных см. раздел «<a href="#_отложенное_обновление_больших">Отложенное
обновление больших архивов данных</a>».</p>

<a name="issogl2_общие_рекомендации_по_реализации_обработчиков_обновления"><h3>Общие рекомендации по реализации обработчиков обновления</h3></a>

<p class="MsoListBullet">&#9679; 
Код обработчиков обновления выполняется на
сервере, поэтому они не должны содержать никакой логики по интерактивному взаимодействию
с пользователем. </p>

<p class="MsoListBullet">&#9679; 
В случае критической ошибки при обновлении в
коде обработчика необходимо вызвать исключение, которое приведет к остановке
всей процедуры обновления. Остановка обновления информационной базы приведет к
невозможности запуска до тех пор, пока причины ошибки не будут устранены.</p>

<p class="MsoListBullet">&#9679; 
Код обработчика обновления должен быть рассчитан
на неоднократное выполнение, чтобы его повторное выполнение не приводило,
например, к дублированию данных в информационной базе.</p>

<p class="MsoListBullet">&#9679; 
На одну и ту же версию конфигурации может быть
написано сколь угодно много обработчиков. Например, это могут быть обработчики
от разных подсистем. При этом порядок их вызова для одной версии может быть произвольным.
</p>

<p class="MsoListBullet">&#9679; 
Порядок вызова обработчиков обновления в
пределах одной версии является случайным, т. е. нельзя ставить в зависимость
работоспособность одного обработчика обновления от выполнения другого
обработчика. Если подобные зависимости появляются, то такие обработчики
необходимо объединять в один.</p>

<p class="Paragraph0c">Кроме того, обработчик обновления не должен содержать
лишних, избыточных действий с данными – должен выполняться максимально быстро.
Для этого в большинстве случаев необходимо отключать бизнес-логику при
обработке данных, а также отключать регистрацию изменений на узлах планов
обмена, чтобы избежать отправки всего объема обработанных данных во всех узлы.
Таким образом:</p>

<p class="MsoListBullet">&#9679; 
в распределенной информационной базе (РИБ)
обработка данных должна выполняться независимо в каждом из узлов;</p>

<p class="MsoListBullet">&#9679; 
при обмене между произвольными конфигурациями
(программами) обработка данных не должна приводить к их выгрузке в
базы-получатели.</p>

<p class="Paragraph0c">Исключение составляют случаи создания ссылочных объектов,
которые должны быть перенесены механизмами обмена данными в другие узлы РИБ с
тем же значением реквизита <span class="Interface">Ссылка</span>.</p>

<p class="Paragraph0c">Таким образом, в коде обработчика обновления вместо кода
вида: </p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ДокументОбъект<span class="operator">.</span>Записать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">должно быть:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ДокументОбъект<span class="operator">.</span>ОбменДанными<span class="operator">.</span>Загрузка <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span> <span class="comment">// отключить всю бизнес-логику при записи</span>
ДокументОбъект<span class="operator">.</span>ДополнительныеСвойства<span class="operator">.</span>Вставить<span class="operator">(</span><span class="string">&quot;ОтключитьМеханизмРегистрацииОбъектов&quot;</span><span class="operator">)</span><span class="operator">;</span> 
ДокументОбъект<span class="operator">.</span>ОбменДанными<span class="operator">.</span>Получатели<span class="operator">.</span>АвтоЗаполнение <span class="operator">=</span> <span class="keyword">Ложь</span><span class="operator">;</span>
ДокументОбъект<span class="operator">.</span>Записать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Для сокращения объема кода рекомендуется использовать
процедуру <span class="Interface">ЗаписатьДанные</span> общего модуля <span class="Interface">ОбновлениеИнформационнойБазы</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ОбновлениеИнформационнойБазы<span class="operator">.</span>ЗаписатьДанные<span class="operator">(</span>ДокументОбъект<span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Для удобной отладки монопольных и оперативных обработчиков
обновления можно воспользоваться параметром запуска <span class="Interface">РежимОтладки</span>
(обновление будет выполнено без использования фоновых заданий) или флажком <span class="Interface">Выполнять обновление версии ИБ без установки монопольного
режима и без фонового задания (режим отладки) </span>в обработке <span class="Interface">ИнструментыРазработчикаОбновлениеВерсииИБ</span>.</p>

<a name="_отложенное_обновление_больших"></a><a name="issogl2_отложенное_обновление_больших_архивов_данных"><h3>Отложенное обновление больших архивов данных</h3></a>

<p class="Paragraph0c">В тех случаях, когда исчерпаны все остальные средства по
оптимизации обработчиков обновления и можно выделить некоторые действия по
обработке данных, выполнение которых не требуется обязательно для начала работы
пользователей с программой, рекомендуется перенести эту обработку на более
поздний момент времени и выполнять ее отложенно.</p>

<p class="Paragraph0c">Отложенная обработка данных не блокирует вход
пользователей в программу и позволяет избежать ситуаций, когда обновление
больших баз занимает существенное время (сутки и более), что нарушает график
работы компании (из-за большого времени простоя информационной системы).</p>

<p class="Warningword">Важно!</p>

<p class="Notes">Отложенная обработка данных возможна только в клиент-серверном
варианте работы. В файловом режиме работы отложенные обработчики обновления
выполняются сразу, до начала работы пользователей с новой версией программы.</p>

<p class="Paragraph0c">Рекомендуется реализовать отложенные обработчики
обновления для обработки больших архивов данных за закрытые/прошлые периоды,
неактивных позиций номенклатуры, закрытых договоров, различных данных,
отключенных в данный момент функциональными опциями и т. п. В большинстве
случаев отложенно следует обновлять документы, регистры, бизнес-процессы и
задачи, которые имеют тенденцию накапливаться со временем.</p>

<p class="Paragraph0c">Механизм отложенной обработки данных имеет два режима
выполнения, которые настраиваются отдельно для каждой библиотеки и основной
конфигурации:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Последовательно</span> (по
умолчанию) – отложенные обработчики обновления выполняются последовательно в интервале
от номера версии информационной базы до номера версии конфигурации включительно
(по возрастанию номеров версий, которые указаны в обработчиках). До тех пор
пока один из обработчиков не завершил обработку своей порции данных, следующий
не запускается. Данный режим обновления подходит для конфигураций (и
библиотек), в которых отложенные обработчики для новых версий обрабатывают те
же данные, что обрабатывали обработчики более старых версий. Кроме того, за
счет последовательного выполнения к ним предъявляются минимальные требования по
«устойчивости» к обрабатываемым данным: при обновлении «через» несколько версий
они гарантированно могут рассчитывать на определенное начальное состояние обрабатываемых
данных, которое осталось после выполнения обработчиков предыдущей версии.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Параллельно</span> –
отложенный обработчик после обработки первой порции данных передает управление
следующему обработчику, а после выполнения последнего обработчика цикл
повторяется заново, пока все данные не будут обработаны. Таким образом одновременно
обновляются объекты информационной базы сразу всех типов, в отличие от
последовательного режима, при котором объекты разных типов обрабатываются по
очереди и многократно (при обновлении «через» несколько версий).</p>

<p class="Paragraph0c">Разработка отложенных обработчиков обновления для обоих
режимов существенно различается. Особенности разработки обработчиков для
отложенного режима обновления описаны отдельно.</p>

<p class="Paragraph0c">Для того чтобы указать, что обработчик обновления должен
выполняться отложенно, необходимо свойству <span class="Interface">РежимВыполнения</span>
присвоить значение <span class="Interface">Отложенно</span>, указать уникальный
идентификатор и задать комментарий, который кратко поясняет пользователю, какие
данные и как он обрабатывает.</p>

<p class="MsoListBullet">Свойства, специфичные для обоих
видов отложенных обработчиков обновления:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Комментарий (Строка) </span>–
комментарий заполняется обязательно и не должен совпадать с комментариями к
другим обработчиками обновления. В нем рекомендуется описывать не только суть
выполняемого действия, но и масштаб временно неработоспособного функционала,
например:</p>

<p class="MsoListBullet2">&#9679;  Подготовка
индекса для поиска отчетов, предусмотренных в программе. Поиск отчетов временно
недоступен.</p>

<p class="MsoListBullet2">&#9679;  Реструктуризация
дополнительных реквизитов и сведений. Рекомендуется воздержаться от их
редактирования до завершения обработки.</p>

<p class="MsoListBullet2">&#9679;  Первоначальный
расчет количества нерассмотренных писем по папкам. До завершения обработки всех
писем их количество может выводиться некорректно. </p>

<p class="MsoListBullet2">&#9679;  Заполняются
движения по новому регистру <span class="Interface">Движения
Номенклатура-Контрагент</span> по документам <span class="Interface">Расчет себестоимости
товаров</span>. После выполнения обработки появится возможность формировать
отчеты по товарам. </p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Идентификатор
(УникальныйИдентификатор) </span>– идентификатор отложенного обработчика,
который необходимо заполнять для разрешения конфликтов при переименованиях или
переносе в другой модуль процедуры обновления. В таких случаях по
идентификатору будет определен новый путь к обработчику, и он успешно завершит
обработку данных.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">БлокируемыеОбъекты</span>
(<span class="Interface">Строка</span>) – полные имена объектов через запятую,
которые следует блокировать в пользовательском интерфейсе от редактирования до
завершения процедуры обработки данных. Подробнее см. <a href="#_блокировка_необработанных_данных">Блокировка необработанных данных в
пользовательском интерфейсе</a>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПроцедураПроверки</span> (<span class="Interface">Строка</span>) – имя функции, которая дополнительно для переданного
объекта определяет, завершена ли для него процедура обработки данных. Если
переданный объект обработан, то следует вернуть значение <span class="Interface">Истина</span>.
Вызывается из процедуры <span class="Interface">ПроверитьОбъектОбработан</span>
общего модуля <span class="Interface">ОбновлениеИнформационнойБазы</span>. Подробнее
см. <a href="#_блокировка_еще_необработанных">Блокировка необработанных данных в
пользовательском интерфейсе</a>.</p>

<p class="Paragraph0c">Например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;1.2.3.4&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;Заказы.ЗаполнитьСтатусЗаказовПокупателей&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>РежимВыполнения <span class="operator">=</span> <span class="string">&quot;Отложенно&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Идентификатор <span class="operator">=</span> <span class="keyword">Новый</span> УникальныйИдентификатор<span class="operator">(</span><span class="string">&quot;83d5c5dd-1462-4d72-ab98-f8f5dcc0664d&quot;</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Комментарий <span class="operator">=</span> НСтр<span class="operator">(</span><span class="string">&quot;ru = 'Заполняет значение нового реквизита СтатусЗаказа у документов &quot;</span><span class="string">&quot;Заказ покупателя&quot;</span><span class="string">&quot; прошлых периодов.'&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Синтаксис процедуры-обработчика отложенного обновления:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ЗаполнитьСтатусыЗаказовПокупателей<span class="operator">(</span>Параметры<span class="operator">)</span> <span class="keyword">Экспорт</span></pre>

<p class="Paragraph0c">где <span class="Interface">Параметры – Структура</span> со
свойствами:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ОбработкаЗавершена</span>
(<span class="Interface">Булево</span>) – для того чтобы обработчик был вызван
повторно для обработки следующей порции данных, следует записать в него
значение <span class="Interface">Ложь</span>;</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПрогрессВыполнения</span>
(<span class="Interface">Структура</span>) – необходимо заполнять для отображения
прогресса обработки данных:</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ВсегоОбъектов</span> (<span class="Interface">Число</span>) – общее
количество объектов, которое необходимо обработать;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">ОбработаноОбъектов</span> (<span class="Interface">Число</span>) –
сколько объектов уже обработано. </p>

<p class="Paragraph0c">Кроме того, в структуру <span class="Interface">Параметры</span>
можно добавить произвольное количество свойств произвольных типов, значения
которых будут автоматически запоминаться между вызовами процедуры – обработчика
отложенного обновления. Таким образом можно передавать контекст отложенной
обработки между ее вызовами (например, дату, по которую был обработан архив
документов). При этом не рекомендуется сохранять в свойствах структуры большие
объемы данных, а использовать только примитивные типы (например, <span class="Interface">Дата</span>).</p>

<p class="Paragraph0c">Отложенную обработку данных необходимо выполнять порциями,
чтобы не создавать длительную нагрузку на сервер предприятия и СУБД. По
умолчанию размер порции – 1000 (документов, записей и т. п.). Размер порции
можно увеличить для небольших объектов и уменьшить для документов, в которых
большие табличные части (в среднем).</p>

<p class="Paragraph0c">Также рекомендуется начинать обработку с самых свежих
данных.</p>

<p class="Paragraph0c">Например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    Запрос <span class="operator">=</span> <span class="keyword">Новый</span> Запрос<span class="operator">;</span>
    Запрос<span class="operator">.</span>Текст <span class="operator">=</span> 
    <span class="string">&quot;ВЫБРАТЬ ПЕРВЫЕ 1000</span>
<span class="string">    |    ЗаказПокупателя.Ссылка</span>
<span class="string">    |ИЗ</span>
<span class="string">    |    Документ.ЗаказПокупателя КАК ЗаказПокупателя</span>
<span class="string">    |ГДЕ</span>
<span class="string">    |    ЗаказПокупателя.СтатусЗаказа = &amp;ПустаяСсылка</span>
<span class="string">    |</span>
<span class="string">    |УПОРЯДОЧИТЬ ПО</span>
<span class="string">    |    ЗаказПокупателя.Дата УБЫВ&quot;</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Отложенные обработчики обновления должны самостоятельно
заботиться о целостности обновляемых данных: при чтении данных с последующим
изменением требуется выполнять эти действия в транзакции и устанавливать
исключительную управляемую блокировку. </p>

<p class="Paragraph0c">Например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    НачатьТранзакцию<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Попытка</span>
        Блокировка <span class="operator">=</span> <span class="keyword">Новый</span> БлокировкаДанных<span class="operator">;</span>
        ЭлементБлокировки <span class="operator">=</span> Блокировка<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;Документ._ДемоЗаказПокупателя&quot;</span><span class="operator">)</span><span class="operator">;</span>
        ЭлементБлокировки<span class="operator">.</span>УстановитьЗначение<span class="operator">(</span><span class="string">&quot;Ссылка&quot;</span><span class="operator">,</span> ЗаказПокупателя<span class="operator">.</span>Ссылка<span class="operator">)</span><span class="operator">;</span>
        Блокировка<span class="operator">.</span>Заблокировать<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
        ДокументОбъект <span class="operator">=</span> ЗаказПокупателя<span class="operator">.</span>Ссылка<span class="operator">.</span>ПолучитьОбъект<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
        <span class="comment">// Если объект ранее был удален или обработан другими сеансами, пропускаем его.</span>
        <span class="keyword">Если</span> ДокументОбъект <span class="operator">=</span> <span class="keyword">Неопределено</span> <span class="keyword">Тогда</span>
            ОтменитьТранзакцию<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
            <span class="keyword">Возврат</span><span class="operator">;</span>
        <span class="keyword">КонецЕсли</span><span class="operator">;</span>
        <span class="keyword">Если</span> ДокументОбъект<span class="operator">.</span>СтатусЗаказа <span class="operator">=</span> Перечисления<span class="operator">.</span>_ДемоСтатусыЗаказовПокупателей<span class="operator">.</span>ПустаяСсылка<span class="operator">(</span><span class="operator">)</span> <span class="keyword">Тогда</span>
            ОтменитьТранзакцию<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
            <span class="keyword">Возврат</span><span class="operator">;</span>
        <span class="keyword">КонецЕсли</span><span class="operator">;</span>
        <span class="comment">// Обрабатываем документ</span>
        <span class="comment">// ...</span>
        ОбновлениеИнформационнойБазы<span class="operator">.</span>ЗаписатьДанные<span class="operator">(</span>ДокументОбъект<span class="operator">)</span><span class="operator">;</span>
        ЗафиксироватьТранзакцию<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Исключение</span>
        ОтменитьТранзакцию<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
        <span class="keyword">ВызватьИсключение</span><span class="operator">;</span>
    <span class="keyword">КонецПопытки</span><span class="operator">;</span></pre>

<p class="Paragraph0c">При возникновении исключения в обработчике отложенного
обновления следует всегда пробрасывать его в вызывающий код (см. блок <span class="Interface">Исключение – КонецПопытки</span> в примере выше). В противном
случае может возникнуть ситуация, когда обработчик будет выполняться бесконечно
долго (если параметру <span class="Interface">ОбработкаЗавершена</span> присвоено
значение <span class="Interface">Ложь</span>), а данные ИБ не будут обновлены.</p>

<p class="Paragraph0c">При возникновении исключения в обработчике он помечается
как ошибочный, и через определенный интервал времени выполняются еще две
попытки его запуска. Тем самым обработчик сможет корректно обновить данные,
временно заблокированные другими сеансами. Но если обработчик продолжает и
дальше прерываться с исключением (допущена ошибка в самом обработчике), то он
пропускается и ставится в очередь выполнения только при очередном обновлении
версии программы. Это позволяет обновить данные при переходе на следующий
исправительный релиз, в котором исправлена ошибка в обработчике.</p>

<p class="Paragraph0c">В общем случае при обработке данных конкретной таблицы
(документа, регистра и т. п.) некоторая часть ее данных требуется пользователям
сразу к моменту начала работы в новой версии программы, а все остальное может
быть обработано отложенно. В таких случаях рекомендуется реализовать два
обработчика обновления: монопольный и отложенный. </p>

<p class="Paragraph0c">В редких случаях, когда в новой версии конфигурации
появился монопольный (или оперативный) обработчик обновления, данные которого
обрабатывались в предыдущих версиях отложенно, следует:</p>

<p class="MsoListBullet">&#9679; 
пересмотреть проектное решение и сделать такой
обработчик отложенным,</p>

<p class="MsoListBullet">&#9679; 
либо «старые» отложенные обработчики обновления
сделать монопольными (оперативными).</p>

<p class="Paragraph0c">В противном случае возникнет ситуация, когда данные будут
обработаны в неправильном порядке: сначала выполнится монопольный (оперативный)
обработчик, который рассчитывается на то, что данные были обработаны ранее
отложенно.</p>

<a name="_блокировка_еще_необработанных"></a><a name="_блокировка_необработанных_данных"></a><a name="issogl2_блокировка_необработанных_данных_в_пользовательском_интерфейсе"><h3>Блокировка необработанных данных в пользовательском интерфейсе</h3></a>

<p class="Paragraph0c">Если отложенный обработчик обрабатывает не только архивные
данные, но и данные текущего периода, то для предотвращения некорректной работы
программы рекомендуется блокировать еще не обработанные данные от изменения
пользователями программы, а также отчеты и обработки, которые могут некорректно
работать до завершения отложенного обновления этих данных. </p>

<p class="Paragraph0c">Для этого необходимо:</p>

<p class="MsoListBullet">&#9679; 
в свойстве <span class="Interface">БлокируемыеОбъекты</span>
отложенного обработчика обновления следует указать те объекты метаданных, с
которыми он работает (читает или записывает), а также связанные с ними отчеты и
обработки; </p>

<p class="MsoListBullet">&#9679; 
в свойстве <span class="Interface">ПроцедураПроверки</span>
указать имя экспортной функции, которая дополнительно проверяет, нужно ли блокировать
конкретный объект. Например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">    Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;1.2.3.4&quot;</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span>Идентификатор <span class="operator">=</span> <span class="keyword">Новый</span> УникальныйИдентификатор<span class="operator">(</span><span class="string">&quot;b3be66c5-708d-42c8-a019-818036d09d06&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;Заказы.ЗаполнитьСтатусыЗаказовПокупателей&quot;</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span>Комментарий <span class="operator">=</span> НСтр<span class="operator">(</span><span class="string">&quot;ru = 'Заполнение значения нового реквизита &quot;</span><span class="string">&quot;Статус заказа&quot;</span><span class="string">&quot; у документов &quot;</span><span class="string">&quot;Демо: Заказ покупателя&quot;</span><span class="string">&quot; прошлых периодов.</span>
<span class="string">        |До завершения обработки &quot;</span><span class="string">&quot;Статус заказа&quot;</span><span class="string">&quot; данных документов будет отображаться некорректно.'&quot;</span><span class="operator">)</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span>РежимВыполнения <span class="operator">=</span> <span class="string">&quot;Отложенно&quot;</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span>ПроцедураПроверки <span class="operator">=</span> <span class="string">&quot;Заказы.ЗаказПокупателяОбработан&quot;</span><span class="operator">;</span>
    Обработчик<span class="operator">.</span>БлокируемыеОбъекты <span class="operator">=</span> <span class="string">&quot;Документ.ЗаказПокупателя,Отчет.СтатусыЗаказовПокупателей&quot;</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Затем для всех объектов, указанных в свойстве <span class="Interface">БлокируемыеОбъекты</span>, необходимо добавить вызов процедуры <span class="Interface">ОбновлениеИнформационнойБазы.ПроверитьОбъектОбработан </span>в обработчике
события модуля формы объекта <span class="Interface">ПриСозданииНаСервере</span>
и в обработчике события модуля объекта <span class="Interface">ПередЗаписью</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ПриСозданииНаСервере<span class="operator">(</span>Отказ<span class="operator">,</span> СтандартнаяОбработка<span class="operator">)</span>
    <span class="keyword">Если</span> Параметры<span class="operator">.</span>Свойство<span class="operator">(</span><span class="string">&quot;АвтоТест&quot;</span><span class="operator">)</span> <span class="keyword">Тогда</span> <span class="comment">// Возврат при получении формы для анализа.</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    ОбновлениеИнформационнойБазы<span class="operator">.</span>ПроверитьОбъектОбработан<span class="operator">(</span>Объект<span class="operator">,</span> ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
    …
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c"> </p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Процедура</span> ПередЗаписью<span class="operator">(</span>Отказ<span class="operator">,</span> РежимЗаписи<span class="operator">,</span> РежимПроведения<span class="operator">)</span>
    <span class="keyword">Если</span> ОбменДанными<span class="operator">.</span>Загрузка <span class="keyword">Тогда</span>
        <span class="keyword">Возврат</span><span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    ОбновлениеИнформационнойБазы<span class="operator">.</span>ПроверитьОбъектОбработан<span class="operator">(</span>ЭтотОбъект<span class="operator">)</span><span class="operator">;</span>
    …
<span class="keyword">КонецПроцедуры</span></pre>

<p class="Paragraph0c">Функция проверки, указанная в свойстве <span class="Interface">ПроцедураПроверки</span>, возвращает <span class="Interface">Истина</span>
для объектов, если объект уже обработан и с ним могут работать пользователи,
или <span class="Interface">Ложь</span>, если объект следует заблокировать от
редактирования пользователями. Она принимает на вход параметр типа <span class="Interface">Структура</span>, свойства которого идентифицируют запрашиваемый
объект:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Данные (ЛюбаяСсылка,
НаборЗаписей, Объект, ДанныеФормыСтруктура)</span> – объект, который нужно проверить,
обработан ли он данным отложенным обработчиком обновления или еще нет.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">МетаданныеОбъекта (ОбъектМетаданных)</span>
- объект метаданных, соответствующий параметру <span class="Interface">Данные</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПолноеИмя (Строка)</span> -
полное имя объекта метаданных.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Отбор (ЛюбаяСсылка,
Структура)</span> – если <span class="Interface">Данные</span> – это ссылочный
объект, то значение ссылки; если регистр подчиненный регистратору – значение
отбора по регистратору. Если <span class="Interface">Данные</span> – это
независимый регистр сведений, то в этом параметре предается структура,
соответствующая установленным отборам по измерениям.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ЭтоНовый (Булево)</span> –
если <span class="Interface">Данные</span> – это ссылочный объект, то признак
нового объекта. Для других типов – всегда <span class="Interface">Ложь</span>.</p>

<p class="Paragraph0c">Ее реализация должна быть достаточно простой, чтобы не
сильно замедлять открытие формы, например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"><span class="keyword">Функция</span> ЗаказПокупателяОбработан<span class="operator">(</span>Параметры<span class="operator">)</span> <span class="keyword">Экспорт</span>
    <span class="keyword">Если</span> ТипЗнч<span class="operator">(</span>Параметры<span class="operator">.</span>Данные<span class="operator">)</span> <span class="operator">=</span> Тип<span class="operator">(</span><span class="string">&quot;ДокументСсылка._ДемоЗаказПокупателя&quot;</span><span class="operator">)</span> <span class="keyword">Тогда</span>
        СтатусЗаказа <span class="operator">=</span> ОбщегоНазначения<span class="operator">.</span>ЗначениеРеквизитаОбъекта<span class="operator">(</span>Параметры<span class="operator">.</span>Данные<span class="operator">,</span> <span class="string">&quot;СтатусЗаказа&quot;</span><span class="operator">)</span><span class="operator">;</span>
    <span class="keyword">Иначе</span>
        СтатусЗаказа <span class="operator">=</span> Параметры<span class="operator">.</span>Данные<span class="operator">.</span>СтатусЗаказа<span class="operator">;</span>
    <span class="keyword">КонецЕсли</span><span class="operator">;</span>
    <span class="keyword">Возврат</span> СтатусЗаказа <span class="operator">&lt;</span><span class="operator">&gt;</span> Перечисления<span class="operator">.</span>_ДемоСтатусыЗаказовПокупателей<span class="operator">.</span>ПустаяСсылка<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
<span class="keyword">КонецФункции</span></pre>

<p class="Paragraph0c"><a name="_оперативное_обновление_на"></a>Пример
отложенного обработчика обновления с блокировкой необработанных данных в
пользовательском интерфейсе см. в демонстрационной конфигурации: процедура <span class="Interface">ПриДобавленииОбработчиковОбновления </span>общего модуля <span class="Interface">_ДемоОбновлениеИнформационнойБазыБСП</span>.</p>

<a name="issogl2_особенности_параллельного_режима_отложенного_обновления"><h3>Особенности параллельного режима отложенного обновления</h3></a>

<p class="Paragraph0c">Для установки параллельного режима выполнения отложенных
обработчиков конфигурации (библиотеки) следует в процедуре <span class="Interface">ПриДобавленииПодсистемы</span> общего модуля <span class="Interface">ОбновлениеИнформационнойБазы&lt;Сокращение&gt;</span> указать:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Описание<span class="operator">.</span>РежимВыполненияОтложенныхОбработчиков <span class="operator">=</span> <span class="string">&quot;Параллельно&quot;</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Данный режим обновления можно включить с определенной
версии, чтобы не пересматривать реализацию старых отложенных обработчиков. Для
этого необходимо заполнить свойство <span class="Interface">ПараллельноеОтложенноеОбновлениеСВерсии</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Описание<span class="operator">.</span>ПараллельноеОтложенноеОбновлениеСВерсии <span class="operator">=</span> <span class="string">&quot;2.3.3.20&quot;</span><span class="operator">;</span> </pre>

<p class="Bullet0">Свойства, специфичные только для отложенных обработчиков
обновления с режимом выполнения <span class="Interface">Параллельно</span>:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ОчередьОтложеннойОбработки</span>
(<span class="Interface">Число</span>) – если обработчик обрабатывает данные совершенно
независимо от других, то следует указывать значение очереди – «1». Если же при
обработке данных обработчик опирается на результат выполнения другого
обработчика, то ему следует указывать более высокое значение очереди. Это
необходимо для оптимальной обработки данных, чтобы обработчик не отрабатывал
вхолостую. </p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ПроцедураЗаполненияДанныхОбновления</span>
(<span class="Interface">Строка</span>) – указывается процедура, которая
регистрирует данные, подлежащие обновлению данным обработчиком.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ЗапускатьТолькоВГлавномУзле</span>
(<span class="Interface">Булево</span>) – указать <span class="Interface">Истина</span>,
если обработчик обновления может выполняться только в главном узле РИБ. По
умолчанию <span class="Interface">Ложь</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ЗапускатьИВПодчиненномУзлеРИБСФильтрами</span>
(<span class="Interface">Булево</span>) – указать <span class="Interface">Истина</span>,
если обработчик обновления может выполняться только в подчиненном узле РИБ с
фильтрами. По умолчанию <span class="Interface">Ложь</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ЧитаемыеОбъекты</span> (<span class="Interface">Строка</span>) – список полных имен объектов через запятую,
которые обработчик обновления читает при обработке данных.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ИзменяемыеОбъекты</span> (<span class="Interface">Строка</span>) – список полных имен объектов через запятую,
которые обработчик обновления изменяет при обработке данных.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Приоритеты</span> (<span class="Interface">ТаблицаЗначений</span>) – таблица зависимостей между
обработчиками, изменяющими или читающими одни и теже объекты:</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Порядок</span> (<span class="Interface">Строка</span>) – порядок
выполнения обработчика относительно другого. Может принимать значения <span class="Interface">До</span>, <span class="Interface">После</span> или <span class="Interface">Любой</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Идентификатор</span> (<span class="Interface">УникальныйИдентификатор</span>)
– идентификатор процедуры, с которой указывается взаимосвязь;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Процедура</span> (<span class="Interface">Строка</span>) – полное
имя процедуры, с которой указывается взаимосвязь.<br>
Допускается указывать только одно из свойств – <span class="Interface">Процедура</span>
или <span class="Interface">Идентификатор</span>.</p>

<p class="Bullet0">Например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Обработчик<span class="operator">.</span>ЧитаемыеОбъекты <span class="operator">=</span> <span class="string">&quot;Документ.ЗаказПокупателя&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>ИзменяемыеОбъекты <span class="operator">=</span> <span class="string">&quot;Документ.ЗаказПокупателя&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>ПриоритетыВыполнения <span class="operator">=</span> ОбновлениеИнформационнойБазы<span class="operator">.</span>ПриоритыВыполненияОбработчика<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Приоритет <span class="operator">=</span> Обработчик<span class="operator">.</span>ПриоритетыВыполнения<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Приоритет<span class="operator">.</span>Порядок <span class="operator">=</span> <span class="string">&quot;До&quot;</span><span class="operator">;</span>
Приоритет<span class="operator">.</span>Идентификатор <span class="operator">=</span> <span class="keyword">Новый</span> УникальныйИдентификатор<span class="operator">(</span><span class="string">&quot;b3be66c5-708d-42c8-a019-818036d09d06&quot;</span><span class="operator">)</span><span class="operator">;</span>
Приоритет<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;Документы.ЗаказПокупателя.ОбработатьДанныеДляПереходаНаНовуюВерсию&quot;</span></pre>

<a name="issogl2_оперативное_обновление_на_исправительные_релизы_конфигураций"><h3>Оперативное обновление на исправительные релизы конфигураций</h3></a>

<p class="Paragraph0c">При разработке исправительных релизов конфигураций
рекомендуется сохранять возможность оперативного (динамического) обновления таким
образом, чтобы при обновлении на такие версии не требовалось обязательного
прекращения работы пользователей и других активных сеансов. Для этого исправительный
релиз конфигурации должен удовлетворять следующим условиям:</p>

<p class="MsoListBullet">&#9679; 
в него могут быть внесены только
«незначительные» изменения, которые позволяют динамически обновлять
конфигурацию базы данных (т. е. когда не требуется реструктуризация информационной
базы);</p>

<p class="MsoListBullet">&#9679; 
обработчики обновления версии ИБ не должны
требовать установки монопольного режима для своего выполнения;</p>

<p class="MsoListBullet">&#9679; 
изменения в конфигурации должны ограничиваться
только теми изменениями, которые не потребуют выполнения обязательных
обработчиков обновления, предусмотренных в БСП (свойство <span class="Interface">Версия</span>
= «*»).</p>

<p class="Paragraph0c">Для обязательных обработчиков обновления (свойство <span class="Interface">Версия</span> = «*») дополнительно предусмотрена возможность
программно определять, действительно ли для их выполнения требуется монопольный
режим. Для этого следует установить свойство обработчика <span class="Interface">МонопольныйРежим
</span>в значение<span class="Interface"> Истина</span>. В этом случае:</p>

<p class="MsoListBullet">&#9679; 
Такой обработчик вызывается дважды, в него
передается параметр <span class="Interface">Параметры</span> типа <span class="Interface">Структура</span>, в котором имеется свойство <span class="Interface">МонопольныйРежим</span> (<span class="Interface">Булево</span>).</p>

<p class="MsoListBullet">&#9679; 
При первом вызове в режиме проверки свойство <span class="Interface">МонопольныйРежим</span> содержит значение <span class="Interface">Ложь</span>. При этом код обработчика не должен модифицировать
данные ИБ.</p>

<p class="MsoListBullet">&#9679; 
Если в ходе выполнения обработчика возникает
необходимость внесения изменений в ИБ, обработчик должен установить значение
свойства в значение <span class="Interface">Истина</span> и прекратить свое выполнение.</p>

<p class="MsoListBullet">&#9679; 
При втором вызове в режиме выполнения свойство <span class="Interface">МонопольныйРежим</span> содержит значение <span class="Interface">Истина</span>. В этом случае код обработчика может
модифицировать данные ИБ. Изменение значения свойства в этом случае игнорируется.</p>

<p class="Paragraph0c">Оперативные обработчики обновления должны самостоятельно
заботиться о целостности обновляемых данных: если выполняется более одного
изменения данных, требуется выполнять действия в транзакции, а если
производится чтение данных с последующим изменением, то требуется устанавливать
исключительную управляемую блокировку.</p>

<p class="Paragraph0c">Пример обязательного обработчика обновления с проверкой
необходимости монопольного режима см. в демонстрационной конфигурации:
процедура <span class="Interface">ВыполнятьВсегдаПриСменеВерсии</span> общего
модуля <span class="Interface">_ДемоОбновлениеИнформационнойБазыБСП</span>.</p>

<p class="Paragraph0c">Для гарантированной проверки возможности оперативного
обновления на новую версию конфигурации следует выполнить динамическое
обновление конфигурации базы данных при активном сеансе «1С:Предприятия» и
выполнить запуск нового сеанса администратора. Для этого необходимо:</p>

<p class="Number81">1. 
Установить конфигурацию предыдущего релиза.</p>

<p class="Number81">2. 
Запустить ИБ предыдущего релиза конфигурации под
каким-либо пользователем.</p>

<p class="Number81">3. 
Открыть ИБ предыдущего релиза конфигуратором и
нажать <span class="Interface">F7</span>.</p>

<p class="Number81">4. 
Проверить, что конфигуратор предлагает
обновиться динамически. Если не предлагает, см. ниже «Проблема 1».</p>

<p class="Number81">5. 
Обновить динамически, затем выполнить запуск под
администратором по <span class="Interface">F5</span>.</p>

<p class="Number81">6. 
Проверить, что запуск прошел без ошибок и
выводится окно с описанием изменений в новой версии. Если возникли ошибки, см.
ниже «Проблема 2».</p>

<p class="Paragraph0c"><span class="af1">Проблема 1</span>. Не проходит динамическое
обновление конфигурации.</p>

<p class="Paragraph0c">Для расследования нужно: </p>

<p class="MsoListBullet">&#9679; 
завершить сеанс пользователя (запущенный на шаге
2) и нажать <span class="Interface">F7</span> еще раз;</p>

<p class="MsoListBullet">&#9679; 
будет выведен список объектов конфигурации,
препятствующих динамическому обновлению:</p>

<p class="Picture"><IMG src="_img/bb4930f70ba50b6391a4d4b0238cf1d5/image022.png@_=1504708101" WIDTH="800" ALT HEIGHT="609"></p>

<p class="Paragraph0c">Для дальнейшего расследования причин (разработчиками)
нужно сравнить тестируемую конфигурацию с предыдущей версией и выяснить, какие
именно изменения блокируют динамическое обновление.</p>

<p class="Paragraph0c"><span class="af1">Проблема 2</span>. Ошибки при первом запуске
программы администратором.</p>

<p class="Paragraph0c">Помимо «просто» ошибок в обработчиках обновления, может
выдаваться ошибка вида:</p>

<p class="MsoListBullet">&#9679; 
Невозможно выполнить обновление информационной
базы:</p>

<p class="MsoListBullet2">&#9679;  невозможно
установить монопольный режим,</p>

<p class="MsoListBullet2">&#9679;  версия
конфигурации не предусматривает обновление без установки монопольного режима.</p>

<p class="Paragraph0c">Она означает: </p>

<p class="MsoListBullet">&#9679; 
что один из обработчиков обновления требует
монопольного режима для своего выполнения;</p>

<p class="MsoListBullet">&#9679; 
либо в конфигурацию были внесены изменения,
которые потребовали выполнения обязательных обработчиков обновления, предусмотренных
в БСП (для версии «*»).</p>

<p class="Paragraph0c">Дальнейшее расследование следует выполнять под отладкой
либо если была включена константа <span class="Interface">Детализировать
обновление ИБ в Журнале регистрации</span>, то информацию о проблемном
обработчике можно посмотреть в журнале регистрации.</p>

<a name="issogl2_переход_с_другой_конфигурации"><h3>Переход с другой конфигурации</h3></a>

<p class="Paragraph0c">Кроме переходов между версиями одной конфигурации
подсистема позволяет также выполнять прикладной код при переходе с других
конфигураций в режиме обновления. Например, можно предусмотреть переход с
базовой версии конфигурации на версию ПРОФ, с ПРОФ на КОРП или другие переходы,
при которых меняется не только номер версии, но и имя конфигурации.</p>

<p class="Paragraph0c">При необходимости выполнить прикладной код при таком
переходе в процедуре <span class="Interface">ПриДобавленииОбработчиковПереходаСДругойПрограммы</span>
общего модуля, имя которого задано в процедуре <span class="Interface">ПодсистемыКонфигурацииПереопределяемый.ПриДобавленииПодсистем</span>,
следует определить обработчики перехода в виде:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">  Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
  Обработчик<span class="operator">.</span>ПредыдущееИмяКонфигурации <span class="operator">=</span> <span class="string">&quot;УправлениеТорговлей&quot;</span><span class="operator">;</span>
  Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;ОбновлениеУПП.ЗаполнитьУчетнуюПолитику&quot;</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Для ветвления логики перехода в зависимости от версии
исходной конфигурации внутри обработчика можно воспользоваться функцией <span class="Interface">ВерсияИБ</span> общего модуля <span class="Interface">ОбновлениеИнформационнойБазы</span>.</p>

<p class="Paragraph0c">Пример обработчика перехода см. в общем модуле <span class="Interface">_ДемоОбновлениеИнформационнойБазыБСП</span> демонстрационной
конфигурации.</p>

<a name="issogl2_особенности_функционирования_механизма_при_работе_в_модели_сервиса"><h3>Особенности функционирования механизма при работе в модели сервиса</h3></a>

<p class="Paragraph0c">При работе в модели сервиса переход с других конфигураций
в режиме обновления не поддерживается (при такой попытке будет вызвано
исключение).</p>

<p class="Paragraph0c">Схема выполнения обработчиков обновления версии ИБ в
модели сервиса состоит из двух частей:</p>

<p class="MsoListBullet">&#9679; 
<span class="af1">Выполняется обновление общих (неразделенных) данных.</span>
При необходимости выполняется блокировка всей информационной базы (используется
монопольный режим). Порядок выполнения обработчиков обновления:</p>

<p class="MsoListBullet2">&#9679;  выполняются
обработчики с признаком <span class="Interface">ОбщиеДанные = Истина</span>;</p>

<p class="MsoListBullet2">&#9679;  устанавливаются
блокировки на все области данных;</p>

<p class="MsoListBullet2">&#9679;  в
очередь заданий добавляются задания на выполнение во всех областях данных
обработчиков обновления с признаком <span class="Interface">ОбщиеДанные = Ложь</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="af1">Выполняется обновление разделенных данных (во всех
областях данных)</span>. Выполняется механизмом очереди заданий. При
необходимости используется блокировка области данных. Особенности выполнения:</p>

<p class="MsoListBullet2">&#9679;  при
обновлении существующих областей данных пропускаются обязательные обработчики
обновления (<span class="Interface">Версия</span> = «*»). Чтобы эти обработчики
были выполнены, необходимо их повторно зарегистрировать в обработчике
обновления общих данных, у которого свойство <span class="Interface">УправлениеОбработчиками</span>
равно <span class="Interface">Истина</span>;</p>

<p class="MsoListBullet2">&#9679;  при
подготовке новых областей данных обязательные обработчики обновления
разделенных данных всегда выполняются.</p>

<p class="Paragraph0c">Свойства, специфичные только для обработчиков обновления в
модели сервиса:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">ОбщиеДанные</span> (<span class="Interface">Булево</span>) – если <span class="Interface">Истина</span>, то обработчик
обновления будет выполняться из неразделенного сеанса до выполнения любых обработчиков
обновления разделенных данных с признаком <span class="Interface">ОбщиеДанные = Ложь</span>.
Такой обработчик может обращаться только к неразделенным данным. Допустимо
указывать только для обработчиков с режимом выполнения <span class="Interface">Монопольно</span>
и <span class="Interface">Оперативно</span>. Если указать значение <span class="Interface">Истина</span> для обработчика с режимом выполнения <span class="Interface">Отложенно</span>, будет выдано исключение. По умолчанию <span class="Interface">Ложь</span>.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">УправлениеОбработчиками</span>
(<span class="Interface">Булево</span>) – если <span class="Interface">Истина</span>,
в процедуру обработчика обновления будет передан дополнительный параметр типа <span class="Interface">Структура</span> со свойством <span class="Interface">РазделенныеОбработчики</span>.
Свойство содержит дополнительную таблицу обработчиков, в которую нужно добавить
обработчики разделенных данных, как и в основную таблицу <span class="Interface">Обработчики</span>.
По умолчанию <span class="Interface">Ложь</span>.</p>

<p class="Paragraph0c">Пример обработчика обновления общего (неразделенного)
классификатора банков:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;1.2.3.4&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span><span class="keyword">Процедура</span> <span class="operator">=</span> <span class="string">&quot;КлассификаторБанков.ЗаполнитьИНН&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>ОбщиеДанные <span class="operator">=</span> <span class="keyword">Истина</span><span class="operator">;</span></pre>

<a name="_обновление_конфигурации"></a><a name="issogl2_подключение_обработчиков_обновления_в_доработанных_конфигурациях"><h3>Подключение обработчиков обновления в доработанных конфигурациях</h3></a>

<p class="Paragraph0c">При доработке типовых конфигураций часто возникает
необходимость добавлять свои документы и справочники. В дальнейшем это приводит
также к необходимости создавать свои обработчики обновления. Для этих целей
следует использовать следующий подход. </p>

<p class="Paragraph0c">Считаем, что исходная типовая конфигурация становится
библиотекой со своими собственными номером версии и обработчиками обновления, а
доработанная конфигурация выступает в качестве основной конфигурации с
собственным именем и своей нумерацией версий, разработанной на базе этой
библиотеки.</p>

<p class="Paragraph0c">Например, в типовой конфигурации <span class="Interface">БухгалтерияПредприятияКОРП</span>
в общем модуле <span class="Interface">ПодсистемыКонфигурацииПереопределяемый</span>
в процедуре <span class="Interface">ПриДобавленииПодсистем</span> предусмотрена
ссылка на общий модуль, который содержит описание типовой конфигурации:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">МодулиПодсистем<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ОбновлениеИнформационнойБазыБП&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">В общем модуле <span class="Interface">ОбновлениеИнформационнойБазыБП</span>
в процедуре <span class="Interface">ПриДобавленииПодсистемы</span> указано имя и
версия типовой конфигурации, например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"> Описание<span class="operator">.</span>Имя <span class="operator">=</span> <span class="string">&quot;БухгалтерияПредприятияКОРП&quot;</span><span class="operator">;</span>
  Описание<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;3.0.38.31&quot;</span><span class="operator">;</span></pre>

<p class="Paragraph0c">В этом случае можно смело изменить имя и синоним конфигурации
на свои собственные, например, <span class="Interface">БухгалтерияПредприятияКОРП_СRM</span>,
и ввести свою нумерацию версий конфигурации. Затем создать общий модуль вида <span class="Interface">ОбновлениеИнформационнойБазы&lt;Сокращение&gt;</span>,
например,<span class="Interface"> ОбновлениеИнформационнойБазыCRM</span> и подключить
его в конце процедуры <span class="Interface">ПриДобавленииПодсистем</span>
общего модуля <span class="Interface">ПодсистемыКонфигурацииПереопределяемый</span>:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"> МодулиПодсистем<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;ОбновлениеИнформационнойБазыCRM&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">В общем модуле <span class="Interface">ОбновлениеИнформационнойБазыCRM</span>
в процедуре <span class="Interface">ПриДобавленииПодсистемы</span> указать имя доработанной
конфигурации, версию и зависимость от типовой конфигурации, например:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev"> Описание<span class="operator">.</span>Имя <span class="operator">=</span> <span class="string">&quot;БухгалтерияПредприятияКОРП_СRM&quot;</span><span class="operator">;</span>
 Описание<span class="operator">.</span>Версия <span class="operator">=</span> <span class="string">&quot;1.0.0.1&quot;</span><span class="operator">;</span>
 Описание<span class="operator">.</span>ТребуемыеПодсистемы<span class="operator">.</span>Добавить<span class="operator">(</span><span class="string">&quot;БухгалтерияПредприятияКОРП&quot;</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Обработчики обновления для доработанной конфигурации
следует размещать в этом же модуле и привязывать их к новой системе нумерации версий:
«1.0.0.2» и т. д.</p>

<p class="Paragraph0c">В дальнейшем, при каждом обновлении доработанной
конфигурации на новую версию типовой конфигурации необходимо будет увеличивать номер
версии доработанной конфигурации, для того чтобы сработали все обработчики
обновления. </p>

<p class="Paragraph0c">Подробнее о настройке модулей <span class="Interface">ПодсистемыКонфигурацииПереопределяемый</span>
и <span class="Interface">ОбновлениеИнформационнойБазы&lt;Сокращение&gt;</span> см.
раздел «<a href="#_подготовка_к_использованию">Подготовка к использованию подсистемы</a>».</p>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>