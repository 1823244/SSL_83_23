<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=Windows-1251">
		<title>3.41. &#1056;&#1072;&#1073;&#1086;&#1090;&#1072; &#1074; &#1084;&#1086;&#1076;&#1077;&#1083;&#1080; &#1089;&#1077;&#1088;&#1074;&#1080;&#1089;&#1072;</title>
		<LINK REL="stylesheet" href="style.css@_=1504708101">
		<SCRIPT src="script.js@_=1504708101" TYPE="text/javascript"></script>		<!--[if !IE]>--><SCRIPT src="zeroclipboard.js@_=1504708101" TYPE="text/javascript"></script><!--<![endif]-->
	<meta name="robots" content="noarchive">
<meta name="googlebot" content="noarchive">
<link href="3.41. _25F0_25E0_25E1_25EE_25F2_25E0 _25E2 _25EC_25EE_25E4_25E5_25EB_25E8 _25F1_25E5_25F0_25E2_25E8_25F1_25E0.htm" rel="canonical">
<link href="../../../../static/its.content.css@_=1490872753" type="text/css" rel="stylesheet">
<script type="text/javascript" src="../../../../static/its.content.js@_=1489758009"></script>
<!--[if lt IE 9]><script type="text/javascript" src="../../../../static/html5shiv.js@_=1500896273"></script><![endif]-->

</head>
	<body class="bspdoc">
<h1>3.41. Работа в модели сервиса</h1>

<p class="Paragraph0c">Подсистема «Работа в модели» содержит базовый функционал,
обязательный для всех прикладных решений, рассчитанных на работу в модели
сервиса, а также ряд подсистем, которые расширяют другие подсистемы для работы
в модели сервиса (например, «Валюты в модели сервиса» и пр.). </p>

<p class="Paragraph0c">Перед внедрением данной подсистемы рекомендуется
ознакомиться с методикой разработки «1С:Технология разработки решений 1cFresh»
и разделом «<a href="../../../v8doc" target="_top">Механизм
разделения данных</a>» в книге «Руководство разработчика» из состава
документации к платформе «1С:Предприятие». </p>

<p class="Warningword">Важно!</p>

<p class="Notes">В составе подсистемы поставляются два общих
реквизита-разделителя: <span class="Interface">ОбластьДанныхОсновныеДанные</span>
и <span class="Interface">ОбластьДанныхВспомогательныеДанные</span>. Корректное
функционирование подсистем библиотеки при добавлении других разделителей в
общем случае не поддерживается.</p>

<p class="Warningword">Примечание</p>

<p class="Notes">Непосредственно в саму подсистему «Работа в модели сервиса»
объекты библиотеки не включены, они относятся к дочерним подсистемам в ветке <span class="Interface">Работа в модели сервиса</span>.</p>

<a name="issogl1_настройка"><h2>Настройка</h2></a>

<a name="issogl2_разработка_форм_настройки_системы_для_администратора_информационной_базы_и_для_администратора_области_данных"><h3>Разработка форм настройки системы для администратора информационной базы и для администратора области данных</h3></a>

<p class="Paragraph0c">В отличие от локального режима работы, при работе в модели
сервиса функции администрирования системы разделены на два уровня: </p>

<p class="MsoListBullet">&#9679; 
Администратор информационной базы (роли <span class="Interface">ПолныеПрава</span> и <span class="Interface">АдминистраторСистемы</span>)
выполняет настройку и обслуживание системы в целом, для всех областей данных.
Например, настройку доступа к внешним ресурсам на сервере «1С:Предприятия»
(прокси-сервер, почта, тома хранения файлов и т. п.), каких-либо общих
параметров системы, которые должны распространяться на пользователей всех
областей данных.</p>

<p class="MsoListBullet">&#9679; 
Администратор области данных (роль <span class="Interface">ПолныеПрава</span>) выполняет настройку параметров системы для
конкретной области данных. Например: включение/отключение функциональных опций,
ведение списка пользователей, удаление помеченных объектов и т. п.</p>

<p class="Paragraph0c">Таким образом, при разработке форм настроек следует
учитывать, что настройки информационной базы должны быть видны только
администратору информационной базы (роль <span class="Interface">АдминистраторСистемы</span>),
а настройки области данных – всем администраторам (роль <span class="Interface">ПолныеПрава</span>).</p>

<p class="Paragraph0c">Если используется подсистема «Настройки программы», то
прикладные формы настроек рекомендуется разрабатывать в том же стиле – в виде
панелей настроек, которые «подстраиваются» под права пользователя. Также
необходимо отразить в документации тот факт, что для настройки общих параметров
администратору информационной базы необходимо войти в любую область данных.
Подробнее см. раздел документации «<A href="3.27. _25ED_25E0_25F1_25F2_25F0_25EE_25E9_25EA_25E8 _25EF_25F0_25EE_25E3_25F0_25E0_25EC_25EC_25FB.htm@_=1504708101#_настройки_программы">Настройки программы</a>».</p>

<p class="Paragraph0c">В противном случае требуется разработать отдельные формы
настроек для администратора информационной базы и для администратора области
данных. Формы настроек должны хорошо подходить как для сценариев настройки двумя
разными людьми при работе в модели сервиса, так и для сценария настройки одним
человеком при работе в локальном режиме:</p>

<p class="MsoListBullet">&#9679; 
Формы настроек, предназначенные для
администратора информационной базы, должны быть доступны только роли <span class="Interface">АдминистраторСистемы</span> и скрываться при работе в локальном
режиме. Для этого форму следует включить в состав функциональной опции <span class="Interface">ИспользоватьРазделениеПоОбластямДанных</span>.</p>

<p class="MsoListBullet">&#9679; 
Формы настроек, предназначенные для
администратора области данных, должны содержать все настройки (и настройки информационной
базы и настройки области данных), быть доступны для роли <span class="Interface">ПолныеПрава</span>
и рассчитаны на работу без роли <span class="Interface">АдминистраторСистемы</span>.</p>

<a name="issogl2_настройка_общих_реквизитов-разделителей_и_объектов_метаданных"><h3>Настройка общих реквизитов-разделителей и объектов метаданных</h3></a>

<p class="Paragraph0c">При работе в модели сервиса в конфигурации должен быть
включен механизм разделения данных, который позволяет разделить все хранимые
данные, а также работу прикладного решения на отдельные части. Для разделения
данных в составе библиотеки поставляются два общих реквизита-разделителя:</p>

<p class="MsoListBullet">&#9679; 
общий реквизит <span class="Interface">ОбластьДанныхОсновныеДанные</span>
– тип <span class="Interface">Число(7)</span>, использование разделяемых данных –
<span class="Interface">Независимо</span>. Значение этого разделителя должно быть
установлено для всех пользователей информационной базы (кроме администратора
информационной базы);</p>

<p class="MsoListBullet">&#9679; 
общий реквизит <span class="Interface">ОбластьДанныхВспомогательныеДанные</span>
– тип <span class="Interface">Число(7)</span>, использование разделяемых данных –
<span class="Interface">Независимо и совместно</span>. Данный разделитель не
используется для разделения пользователей и аутентификации.</p>

<p class="Paragraph0c">При внедрении подсистемы «Работа в модели сервиса» в
состав конфигурации важно сохранять исходный порядок сортировки общих
реквизитов-разделителей в дереве метаданных.</p>

<p class="Paragraph0c">При работе в модели сервиса все данные, хранящиеся в
информационной базе (и объекты метаданных, соответствующие этим данным), могут
быть разделены на следующие виды:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Общие (неразделенные)
данные</span> – данные, которые являются общими для всех областей данных и не
разделяются общими реквизитами-разделителями. Из сеансов, в которых не
установлены значения разделителей, общие данные доступны только для чтения.</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">Разделенные данные</span>
– данные, относящиеся к области данных, разделяются общими реквизитами-разделителями,
поставляемыми в составе подсистемы «Работа в модели сервиса»:</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Основные данные</span> – данные области, обладающие прикладным
характером. Объекты метаданных, соответствующие общим данным, разделяются
разделителем <span class="Interface">ОбластьДанныхОсновныеДанные</span>;</p>

<p class="MsoListBullet2">&#9679;  <span class="Interface">Вспомогательные данные</span> – данные, логически являющиеся
частью данных области, но доступные из неразделенных сеансов, разделяются
разделителем <span class="Interface">ОбластьДанныхВспомогательныеДанные</span>.</p>

<p class="Paragraph0c">По умолчанию большинство объектов метаданных должны быть
включены в состав общего реквизита <span class="Interface">ОбластьДанныхОсновныеДанные</span>,
т. е. должны быть разделенными. Поскольку у общего реквизита <span class="Interface">ОбластьДанныхОсновныеДанные</span> свойство <span class="Interface">Автоиспользование</span> установлено в значение <span class="Interface">Использовать</span>, то для вновь создаваемых объектов
конфигурации ничего предпринимать не требуется.</p>

<p class="Paragraph0c">Из состава разделителя <span class="Interface">ОбластьДанныхОсновныеДанные</span>
должны быть удалены следующие объекты:</p>

<p class="MsoListBullet">&#9679; 
Все регламентные задания.</p>

<p class="MsoListBullet">&#9679; 
Объекты метаданных, предназначенные для хранения
настроек информационной базы (общих для всех областей данных). В основном это
константы, например: <span class="Interface">МаксимальноеКоличествоИсполняющихФоновыхЗаданий</span>.</p>

<p class="MsoListBullet">&#9679; 
Различные классификаторы, общие для всех
областей данных, такие как классификатор валют, адресный классификатор и т. п.</p>

<p class="Paragraph0c">В состав разделителя <span class="Interface">ОбластьДанныхВспомогательныеДанные</span>
должны включаться только служебные данные (не имеющие ценности для абонента).
Для общего реквизита свойство <span class="Interface">Автоиспользование</span>
установлено в значение <span class="Interface">Не использовать</span> таким
образом, вновь создаваемые объекты метаданных не будут включаться в состав
данного разделителя.</p>

<p class="Paragraph0c">Все объекты метаданных, относящиеся к общим
(неразделенным) данным, должны быть включены в состав любой из подписок на
события, для которой в качестве обработчика назначена одна из следующих процедур
(в зависимости от типа объекта метаданных):</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">РаботаВМоделиСервиса.КонтрольНеразделенныхОбъектовПриЗаписи</span>,</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">РаботаВМоделиСервиса.КонтрольНеразделенныхНаборовЗаписейПриЗаписи</span>.</p>

<p class="Paragraph0c">Например, это могут быть следующие подписки на события,
поставляемые непосредственно в составе подсистемы <span class="Interface">БазоваяФункциональностьВМоделиСервиса</span>:</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">КонтрольНеразделенныхОбъектовПриЗаписи</span>,</p>

<p class="MsoListBullet">&#9679; 
<span class="Interface">КонтрольНеразделенныхНаборовЗаписейПриЗаписи</span>.</p>

<a name="issogl2_настройка_функциональных_опций_использоватьразделениепообластямданных_и_неиспользоватьразделениепообластямданных"><h3>Настройка функциональных опций «ИспользоватьРазделениеПоОбластямДанных» и «НеИспользоватьРазделениеПоОбластямДанных»</h3></a>

<p class="Paragraph0c">В случае если конфигурация рассчитана на работу в обоих
режимах: в локальном режиме и в модели сервиса, – необходимо принять решение по
поводу состава объектов конфигурации, которые должны быть размещены в
пользовательском интерфейсе:</p>

<p class="MsoListBullet">&#9679; 
только при работе в модели сервиса (и не должны
при работе в локальном режиме);</p>

<p class="MsoListBullet">&#9679; 
только при работе в локальном режиме (и не
должны при работе в модели сервиса);</p>

<p class="MsoListBullet">&#9679; 
в обоих режимах работы.</p>

<p class="Paragraph0c">Объекты первой группы нужно включить в состав
функциональной опции <span class="Interface">ИспользоватьРазделениеПоОбластямДанных</span>,
а второй – в состав функциональной опции <span class="Interface">НеИспользоватьРазделениеПоОбластямДанных</span>.</p>

<a name="issogl1_использование_при_разработке_конфигурации"><h2>Использование при разработке конфигурации</h2></a>

<p class="Paragraph0c">После включения разделения данных (константа <span class="Interface">ИспользоватьРазделениеПоОбластямДанных</span>) не следует
входить и работать в области данных со значением разделителя 0. Кроме того,
обратное выключение разделения не поддерживается в полном объеме (т. е. не
рекомендуется переводить информационную базу из модели сервиса в локальный
режим).</p>

<a name="issogl2_работа_при_условно_выключенном_разделении"><h3>Работа при условно выключенном разделении</h3></a>

<p class="Paragraph0c">Независимо от того, рассчитана ли конфигурация на работу в
локальном режиме, ее код должен быть работоспособен при условно выключенном
разделении (т. е. в «обычном» режиме, как будто никакого разделения нет).
Поэтому если в конфигурации есть какой-то код, специфичный для модели сервиса, по
его выполнение необходимо предварять проверкой того, что разделение включено. </p>

<p class="Paragraph0c">Для проверки того, что разделение данных включено, следует
использовать функцию <span class="Interface">РазделениеВключено</span> общего
модуля <span class="Interface">ОбщегоНазначенияПовтИсп</span>.</p>

<a name="issogl2_установка_монопольного_режима"><h3>Установка монопольного режима</h3></a>

<p class="Paragraph0c">Для установки (снятия) монопольного доступа к
информационной базе (области данных) следует использовать процедуры <span class="Interface">ЗаблокироватьИБ</span> и <span class="Interface">РазблокироватьИБ</span>
общего модуля <span class="Interface">ОбщегоНазначения</span>. При этом в сеансе
с неустановленным использованием разделителя <span class="Interface">ОбластьДанныхОсновныеДанные</span>
эти процедуры устанавливают (снимают) монопольный режим ИБ (в точности так, как
это происходит в локальном режиме работы).</p>

<a name="issogl2_последовательное_выполнение_регламентных_и_фоновых_заданий_с_помощью_очереди_заданий"><h3>Последовательное выполнение регламентных и фоновых заданий с помощью очереди заданий</h3></a>

<p class="Paragraph0c">Для снижения нагрузки на кластер серверов «1С:Предприятия»
при работе прикладных решений в модели сервиса не следует использовать
разделенные регламентные задания. Вместо этого необходимо использовать очередь
заданий:</p>

<p class="MsoListBullet">&#9679; 
исключить регламентные задания из состава
разделителя <span class="Interface">ОбластьДанныхОсновныеДанные</span>;</p>

<p class="MsoListBullet">&#9679; 
добавить регламентные задания в список,
формируемый процедурой <span class="Interface">ЗаполнитьСписокРазделенныхРегламентныхЗаданий</span>
общего модуля <span class="Interface">ОчередьЗаданийПереопределяемый</span>.</p>

<p class="Paragraph0c">Очередь заданий последовательно выполняет задания в указанных
областях данных с помощью исполняющих фоновых заданий. Задания могут быть
помещены в очередь на выполнение через программный интерфейс или созданы
автоматически на основе регламентных заданий. Программный интерфейс очереди
заданий представлен экспортными процедурами и функциями общего модуля <span class="Interface">ОчередьЗаданий</span>.</p>

<p class="Paragraph0c">При необходимости выполнить какую-либо произвольную
процедуру во всех или нескольких областях данных следует также использовать
очередь заданий (чтобы предотвратить одновременный запуск большого количества
фоновых заданий в каждой области данных). Для этого необходимо:</p>

<p class="MsoListBullet">&#9679; 
добавить задание в очередь с помощью процедуры <span class="Interface">ДобавитьЗадание</span> общего модуля <span class="Interface">ОчередьЗаданий</span>;</p>

<p class="MsoListBullet">&#9679; 
добавить имя процедуры (обработчика задания) в
список, формируемый процедурой <span class="Interface">ПолучитьРазрешенныеМетодыОчередиЗаданий</span>
общего модуля <span class="Interface">ОчередьЗаданийПереопределяемый</span>.</p>

<p class="Warningword">Примечание</p>

<p class="Notes">При разработке обработчиков заданий, выполняемых механизмом
очереди заданий, следует учитывать следующую особенность: непосредственный
запуск фоновых заданий из таких процедур невозможен. Для запуска фоновых
заданий следует временно отключить использование разделения сеанса, запустить
фоновое задание и включить разделение обратно:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">ОбщегоНазначения<span class="operator">.</span>УстановитьРазделениеСеанса<span class="operator">(</span><span class="keyword">Ложь</span><span class="operator">)</span><span class="operator">;</span> 
ФоновыеЗадания<span class="operator">.</span><span class="keyword">Выполнить</span><span class="operator">(</span><span class="string">&quot;имя процедуры-обработчика&quot;</span><span class="operator">)</span><span class="operator">;</span>
ОбщегоНазначения<span class="operator">.</span>УстановитьРазделениеСеанса<span class="operator">(</span><span class="keyword">Истина</span><span class="operator">)</span><span class="operator">;</span></pre>

<p class="Paragraph0c">Это требование обусловлено тем, что выполнение заданий
очереди производится в исполняющих фоновых заданиях, которые запускаются в
сеансах без указания разделителей и переключают разделение сеансов для
исполняемых заданий. </p>

<a name="issogl2_роли_разделенных_пользователей"><h3>Роли разделенных пользователей</h3></a>

<p class="Paragraph0c">При разработке ролей, которые предполагается использовать
для работы разделенных пользователей, следует иметь в виду следующее:</p>

<p class="MsoListBullet">&#9679; 
Для всех объектов метаданных, не входящих в
состав разделителей <span class="Interface">ОбластьДанныхОсновныеДанные</span> и <span class="Interface">ОбластьДанныхВспомогательныеДанные</span>, должны быть сняты
права «Добавление», «Изменение», «Удаление». </p>

<p class="MsoListBullet">&#9679; 
А также должны быть сняты права на конфигурацию:</p>

<p class="MsoListBullet2">&#9679;  администрирование,</p>

<p class="MsoListBullet2">&#9679;  обновление
конфигурации базы данных,</p>

<p class="MsoListBullet2">&#9679;  монопольный
режим,</p>

<p class="MsoListBullet2">&#9679;  толстый
клиент,</p>

<p class="MsoListBullet2">&#9679;  внешнее
соединение,</p>

<p class="MsoListBullet2">&#9679;  аutomation,</p>

<p class="MsoListBullet2">&#9679;  интерактивное
открытие внешних обработок,</p>

<p class="MsoListBullet2">&#9679;  интерактивное
открытие внешних отчетов,</p>

<p class="MsoListBullet2">&#9679;  режим
«Все функции».</p>

<p class="Paragraph0c">При работе в разделенном режиме роли, которые не
удовлетворяют вышеприведенным требованиям, будут автоматически удалены из
состава профилей групп доступа и будут недоступны для назначения пользователям.
Кроме того, при попытке входа в систему пользователя с такими ролями будет
выдана ошибка и работа будет завершена.</p>

<a name="issogl2_настройка_прав_доступа_пользователей"><h3>Настройка прав доступа пользователей</h3></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей следует
использовать роли, приведенные ниже.</p>

<p class="Objectname">Таблица 3.89.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">ПолныеПрава</span> (из
  подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Функции администратора области данных: настройка
  параметров системы для конкретной области данных и неограниченный доступ ко
  всем разделенным данным</p>
  </td>
 </tr>
</table>

<p class="Paragraph0c">Примеры настройки прав доступа пользователей приведены
ниже.</p>

<p class="Objectname">Таблица 3.90.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Группа пользователей и ее функции</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Состав ролей</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Администратор области данных</p>
  </td>
  <td valign="top">
  <p class="BulletTab">&#9679; 
  <span class="Interface">ПолныеПрава</span> (из
  подсистемы «Базовая функциональность»)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2. 
   </p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Ответственный за нормативно-справочную информацию (в
  модели сервиса)</p>
  </td>
  <td valign="top">
  <p class="BulletTab">&#9679; 
  <span class="Interface">ЗапускТонкогоКлиента</span>
  (из подсистемы «Базовая функциональность»),</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">БазовыеПрава</span> (из
  подсистемы «Базовая функциональность»),</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ДобавлениеИзменениеДополнительныхРеквизитовИСведений</span>,</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ДобавлениеИзменениеКурсовВалют</span>,</p>
  <p class="BulletTab">&#9679; 
  <span class="Interface">ДобавлениеИзменениеГрафиковРаботы</span>,</p>
  <p class="BulletTab"><span class="Interface">&#9679;  </span><span class="Interface">ДобавлениеИзменениеВидовКонтактнойИнформации</span></p>
  </td>
 </tr>
</table>

<a name="issogl2_настройка_обмена_данными"><h3>Настройка обмена данными</h3></a>

<p class="Paragraph0c">Для настройки обмена данными следует руководствоваться
общими правилами.</p>

<p class="Paragraph0c">В планы обмена распределенной информационной базы (РИБ)
рекомендуется включать все объекты метаданных подсистемы, кроме следующих:</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ВнутреннийАдресМенеджераСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ВыполнитьРезервноеКопированиеОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ДатаПоследнегоСтартаКлиентскогоСеанса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ИспользованиеКаталогаДополнительныхОтчетовИОбработокВМоделиСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">КаталогОбменаФайламиВМоделиСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">КаталогОбменаФайламиВМоделиСервиса
Linux</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">КлючОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">КонечнаяТочкаМенеджераСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">КопироватьОбластиДанныхИзЭталонной</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">МаксимальнаяДлительностьВыполненияИсполняющегоФоновогоЗадания</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">МаксимальноеКоличествоИсполняющихФоновыхЗаданий</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">МинимальныйИнтервалРегламентныхЗаданийДополнительныхОтчетовИОбработокВМоделиСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">НезависимоеИспользованиеДополнительныхОтчетовИОбработокВМоделиСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ПоддержкаРезервногоКопирования</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ПредставлениеОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ПрефиксОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">РазмерБлокаПередачиФайла</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">РазрешитьВыполнениеДополнительныхОтчетовИОбработокРегламентнымиЗаданиямиВМоделиСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">РежимИспользованияИнформационнойБазы</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">СообщениеБлокировкиПриОбновленииКонфигурации</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">УдалитьИмяСлужебногоПользователяМенеджераСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">УдалитьПарольСлужебногоПользователяМенеджераСервиса</span>,</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">ЧасовойПоясОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник <span class="Interface">ОчередьЗаданий</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник <span class="Interface">ОчередьЗаданийОбластейДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник <span class="Interface">ПоставляемыеДанные</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник <span class="Interface">ПоставляемыеДополнительныеОтчетыИОбработки</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник <span class="Interface">СообщенияОбластейДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник <span class="Interface">ШаблоныЗаданийОчереди</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ВерсииПодсистемОбластейДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ИспользованиеПоставляемыхДополнительныхОтчетовИОбработокВОбластяхДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ИспользованиеДополнительныхОтчетовИОбработокСервисаВАвтономномРабочемМесте</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ОбластиТребующиеОбработкиПоставляемыхДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ОчередьИзвлеченияТекста</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ОчередьИнсталляцииПоставляемыхДополнительныхОтчетовИОбработокВОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">ПоставляемыеДанныеТребующиеОбработки</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">РейтингАктивностиОбластейДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">УдалитьОбластиДанных</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">УдалитьОбластиКРезервномуКопированию</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">УдалитьОчередьЗаданий</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">УдалитьОчередьИзвлеченияТекста</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений <span class="Interface">УдалитьРейтингАктивностиОбластейДанных</span>.</p>

<a name="issogl2_получение_списка_пользователей_для_отображения"><h3>Получение списка пользователей для отображения</h3></a>

<p class="Paragraph0c">Для отображения списка пользователей в большинстве случаев
следует использовать формы справочника <span class="Interface">Пользователи</span>.
В тех случаях, когда это невозможно, следует убирать из списка неразделенных
пользователей при включенном разделении данных. В качестве примера реализации
можно использовать форму списка справочника <span class="Interface">Пользователи</span>.</p>

<a name="issogl1_обмен_сообщениями"><h2>Обмен сообщениями</h2></a>

<p class="Paragraph0c">Подсистема «Обмен сообщениями» (в группе подсистем «Работа
в модели сервиса») предназначена для интеграции разнородных информационных
систем на платформе «1С:Предприятие» посредством обмена сообщениями. Подсистему
следует использовать, когда канал передачи данных ненадежный. Подсистема не
является заменой технологии обмена данными, технологии веб-сервисов и внешнего
соединения.</p>

<p class="Picture">
 <table cellpadding="0" cellspacing="0">
  <tr>
   <td></td>
  </tr>
  <tr>
   <td></td>
   <td><IMG src="_img/bb4930f70ba50b6391a4d4b0238cf1d5/image028.gif@_=1504708101" WIDTH="800" ALT HEIGHT="328"></td>
  </tr>
 </table>
 <br>
</p>

<p class="Paragraph0c"><span class="Interface">Отправитель</span> – это приложение,
которое размещает сообщение (пакет данных) в канале, которое затем считывается
другими приложениями (получателями).</p>

<p class="Paragraph0c"><span class="Interface">Получатель</span> – это приложение,
которое считывает сообщение из канала.</p>

<p class="Paragraph0c"><span class="Interface">Отправители</span> и<span class="Interface"> Получатели</span> также называются конечными точками.</p>

<p class="Paragraph0c"><span class="Interface">Канал сообщений</span> – логический
маршрут для транспортировки сообщений. Удобно применять иерархию, например
«УправлениеПроектами\СозданиеПроекта\...».</p>

<p class="Paragraph0c">Сообщение состоит из тела («прикладной» пакет данных) и
заголовка (метаданные, информация, которая используется только самой
подсистемой обмена сообщениями). Приложения должны согласовать канал и формат
сообщения. Взаимодействие осуществляется в асинхронном режиме.</p>

<p class="Paragraph0c">Работа подсистемы осуществляется в несколько этапов:</p>

<p class="Number81">1. 
<span class="Interface">Создание</span>.
Отправитель создает сообщение с полезной (прикладной) информацией.</p>

<p class="Number81">2. 
<span class="Interface">Отправка</span>.
Отправитель помещает сообщение в канал.</p>

<p class="Number81">3. 
<span class="Interface">Доставка</span>.
Подсистема обмена сообщениями доставляет сообщение с машины-отправителя на
машину-получатель.</p>

<p class="Number81">4. 
<span class="Interface">Получение</span>.
Получатель извлекает сообщение из канала.</p>

<p class="Number81">5. 
<span class="Interface">Обработка</span>.
Получатель считывает полезную информацию из сообщения.</p>

<p class="Paragraph0c">Существует два вида каналов сообщений: <em>широковещательные
каналы сообщений</em> (publish-subscribe channel) и <em>адресные каналы
сообщений</em> (point-to-point channel). Широковещательные каналы
характеризуются тем, что отправитель не «знает» получателя. Сообщение доставляется
всем конечным точкам, которые «сообщили» о себе, что они подписаны на
широковещательный канал. Адресные каналы характеризуются тем, что отправитель
явно указывает получателя. Сообщение доставляется всем конечным точкам, которые
на стороне отправителя определены как получатели для текущего канала сообщений.
Либо есть возможность указать получателя явно в коде в момент отправки
сообщения в канал.</p>

<a name="issogl2_настройка"><h3>Настройка</h3></a>

<p class="Paragraph0c">Для использования подсистемы в конфигурации необходимо: </p>

<p class="Number81">1. 
Разместить в интерфейсе администратора команду <span class="Interface">ОбменСообщениями</span>. </p>

<p class="Number81">2. 
Реализовать обработчики каналов сообщений.</p>

<p class="Number81">3. 
Подключить обработчики каналов сообщений к подсистеме.</p>

<p class="Number81">4. 
Определить получателей адресных сообщений при
необходимости.</p>

<p class="Number81">5. 
Опубликовать веб-сервисы <span class="Interface">MessageExchange</span>
конфигураций, для которых настраивается интеграция. </p>

<a name="issogl3_обработчики_каналов_сообщений"><h4>Обработчики каналов сообщений</h4></a>

<p class="Paragraph0c">В качестве обработчиков каналов сообщений могут выступать
общие модули или модули менеджеров объектов конфигурации. В конфигурации
необходимо создать общий модуль (один или несколько), который будет обработчиком
каналов сообщений. В этом модуле следует объявить процедуру <span class="Interface">ОбработатьСообщение</span>. В процедуре необходимо реализовать
логику обработки в зависимости от имени канала сообщений.</p>

<p class="Warningword">Важно!</p>

<p class="Notes">Канал сообщений однозначно идентифицирует тип сообщения. Поэтому
для диспетчеризации сообщений достаточно только имени канала. Использовать
информацию тела сообщений для диспетчеризации сообщений не рекомендуется.</p>

<a name="issogl3_подключение_обработчиков_каналов_сообщений_к_подсистеме"><h4>Подключение обработчиков каналов сообщений к подсистеме</h4></a>

<p class="Paragraph0c">Подключение обработчиков каналов сообщений выполняется в
общем модуле <span class="Interface">ОбменСообщениямиПереопределяемый</span> в
процедуре <span class="Interface">ПолучитьОбработчикиКаналовСообщений</span>. Для
подключения одного обработчика канала сообщений в процедуре необходимо написать
код:</p>

<a class="copy_source" href="#_top" onClick="return false">Копировать в буфер обмена</a>
<pre class="src_dev">Обработчик <span class="operator">=</span> Обработчики<span class="operator">.</span>Добавить<span class="operator">(</span><span class="operator">)</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Канал <span class="operator">=</span> <span class="string">&quot;&lt;Имя канала&gt;&quot;</span><span class="operator">;</span>
Обработчик<span class="operator">.</span>Обработчик <span class="operator">=</span> <span class="operator">&lt;</span>Ссылка на общий модуль<span class="operator">&gt;</span><span class="operator">;</span></pre>

<p class="Paragraph0c">В качестве значения <span class="Interface">&lt;Имя
канала&gt;</span> следует использовать имя канала сообщений, который необходимо
подключить к подсистеме, например <span class="Interface">УправлениеПроектами\СозданиеПроекта</span>.
В качестве обработчика канала сообщений следует указать ссылку на общий модуль,
например, <span class="Interface">СообщенияУправлениеПроектами</span>.</p>

<p class="Paragraph0c">Количество подключаемых каналов не ограничено.</p>

<p class="Paragraph0c">Пример настройки подсистемы можно посмотреть в
демонстрационной конфигурации.</p>

<a name="issogl3_получатели_адресных_сообщений"><h4>Получатели адресных сообщений</h4></a>

<p class="Paragraph0c">При необходимости в подсистеме можно задать программным
образом получателей адресных сообщений. Для этого следует использовать
процедуру <span class="Interface">ПолучателиСообщения</span> переопределяемого
модуля подсистемы.</p>

<a name="issogl2_использование_при_разработке_конфигурации"><h3>Использование при разработке конфигурации</h3></a>

<p class="Paragraph0c">Перед использованием подсистемы необходимо:</p>

<p class="MsoListBullet">&#9679; 
Решить, с какими конфигурациями должна уметь
интегрироваться текущая конфигурация.</p>

<p class="MsoListBullet">&#9679; 
Определить, какие сообщения и по каким каналам
сообщений принимают конфигурации.</p>

<p class="MsoListBullet">&#9679; 
Определить, какие каналы сообщений должна
«прослушивать» текущая конфигурация:</p>

<p class="MsoListBullet2">&#9679;  для
приема ответных сообщений о других конфигураций,</p>

<p class="MsoListBullet2">&#9679;  для
возможности интеграции с текущей конфигурацией «извне».</p>

<p class="MsoListBullet">&#9679; 
Определить топологию обмена сообщениями (ведущие
и ведомые конечные точки).</p>

<a name="issogl3_топология_обмена_сообщениями"><h4>Топология обмена сообщениями</h4></a>

<p class="Paragraph0c">Конечные точки подразделяются на ведущие и ведомые. Такое
разделение сделано для оптимизации нагрузки на серверы и обеспечения синхронной
отправки и доставки сообщений между информационными базами – корреспондентами.
Ведущая конечная точка инициирует процесс отправки и получения сообщений.
Ведомые конечные точки участвуют в процессе отправки и получения сообщений
только по требованию ведущей конечной точки. Подключение конечных точек
необходимо начинать со стороны ведущей конечной точки из соображений
балансировки нагрузки на серверы и топологии обмена сообщениями. Чем больше
конечных точек связано с ведущей, тем эффективнее обмен сообщениями. В любой
момент времени ведомую конечную точку можно сделать ведущей (поменять их
ролями).</p>

<p class="Notes"><IMG src="_img/bb4930f70ba50b6391a4d4b0238cf1d5/image030.gif@_=1504708101" WIDTH="352" ALT HEIGHT="148"><IMG src="_img/bb4930f70ba50b6391a4d4b0238cf1d5/image031.gif@_=1504708101" WIDTH="348" ALT HEIGHT="144"></p>

<p class="Notes">Пример топологии обмена сообщениями</p>

<a name="issogl3_подключение_конечной_точки"><h4>Подключение конечной точки</h4></a>

<p class="Paragraph0c">Выполнить подключение конечной точки к информационной базе
можно интерактивно и программно. </p>

<p class="Paragraph0c">Для интерактивного подключения конечной точки необходимо в
форме настройки подсистемы выполнить команду <span class="Interface">Подключить
конечную точку</span>. В открывшейся форме необходимо задать настройки
подключения текущей информационной базы к конечной точке и настройки
подключения конечной точки к текущей информационной базе. Затем нажать <span class="Interface">Подключить</span>.</p>

<p class="Paragraph0c">Для программного подключения конечной точки необходимо в
прикладном коде конфигурации выполнить вызов процедуры <span class="Interface">ОбменСообщениями.ПодключитьКонечнуюТочку</span>
и передать методу необходимые параметры. При успешном подключении конечной
точки метод вернет в параметр <span class="Interface">КонечнаяТочка</span> ссылку
на подключенную конечную точку. Для программного обновления параметров
подключения конечной точки следует использовать процедуру <span class="Interface">ОбменСообщениями.ОбновитьНастройкиПодключенияКонечнойТочки</span>.</p>

<a name="issogl3_отправка_сообщений"><h4>Отправка сообщений</h4></a>

<p class="Paragraph0c">Подсистема предоставляет возможность отправки обычных
сообщений и быстрых сообщений. Разница между обычными и быстрыми сообщениями
заключается только в скорости доставки. Быстрые сообщения доставляются
максимально быстро до получателя. Обычные сообщения доставляются с заданным
интервалом, обычно один раз в минуту. Для отправки сообщений необходимо
использовать программный интерфейс подсистемы, представленный экспортными
процедурами общего модуля <span class="Interface">ОбменСообщениями</span>.</p>

<p class="Paragraph0c">После отправки быстрых сообщений необходимо вызвать метод <span class="Interface">ДоставитьСообщения</span> для немедленной доставки всех быстрых
сообщений получателю.</p>

<p class="Warningword">Важно!</p>

<p class="Notes">Методы отправки сообщений следует выполнять только в активной
транзакции. Метод доставки быстрых сообщений <span class="Interface">ДоставитьСообщения</span>
нетранзакционный.</p>

<a name="issogl3_обработчики_событий_отправки_и_получения_сообщений"><h4>Обработчики событий отправки и получения сообщений</h4></a>

<p class="Paragraph0c">Подсистема предоставляет обработчики событий отправки и
получения сообщений. Обработчики событий представлены экспортными процедурами <span class="Interface">ПриОтправкеСообщения</span> и <span class="Interface">ПриПолученииСообщения</span>
общего модуля <span class="Interface">ОбменСообщениямиПереопределяемый</span>.</p>

<a name="issogl3_настройка_прав_доступа_пользователей"><h4>Настройка прав доступа пользователей</h4></a>

<p class="Paragraph0c">Для настройки прав доступа пользователей к данным
подсистемы «Обмен сообщениями» следует использовать роли, приведенные ниже.</p>

<p class="Objectname">Таблица 3.91.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Роли и их назначение</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">АдминистраторСистемы</span> (из
  подсистемы «Базовая функциональность»)</p>
  <p class="TextinTable81">Подключение конечных точек. Администрирование и
  монитор сообщений системы</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">УдаленныйДоступОбменСообщениями</span></p>
  <p class="TextinTable81">Удаленный доступ к подсистеме обмена сообщениями через
  Интернет</p>
  </td>
 </tr>
</table>

<p class="Paragraph0c">Примеры настройки прав доступа пользователей приведены
ниже.</p>

<p class="Objectname">Таблица 3.92.</p>

<table class="MsoNormalTable" border="1" cellspacing="0" cellpadding="0">
 <thead>
  <tr>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">№</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Группа пользователей и ее
   функции</span></p>
   </td>
   <td valign="top">
   <p class="TextinTable81"><span class="Interface">Состав ролей</span></p>
   </td>
  </tr>
 </thead>
 <tr>
  <td valign="top">
  <p class="TextinTable81">1.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Администратор</p>
  <p class="TextinTable81">Подключение конечных точек. Администрирование и монитор
  сообщений системы</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">АдминистраторСистемы</span> (из
  подсистемы «Базовая функциональность»)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">2.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Удаленный доступ</p>
  <p class="TextinTable81">Пользователь, от имени которого выполняется подключение
  к конечной точке через Интернет. Обеспечивает функционирование подсистемы
  обмена сообщениями на стороне конечной точки-корреспондента (получение сообщений,
  обработка очереди сообщений)</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">УдаленныйДоступОбменСообщениями</span></p>
  <p class="TextinTable81"><span class="Interface">ВыполнениеОбменовДанными</span>
  (из подсистемы «Обмен данными»)</p>
  </td>
 </tr>
 <tr>
  <td valign="top">
  <p class="TextinTable81">3.</p>
  </td>
  <td valign="top">
  <p class="TextinTable81">Пользователь</p>
  <p class="TextinTable81">Отправка сообщений. В процессе своей работы пользователь
  выполняет действия, которые могут приводить к отправке сообщений</p>
  </td>
  <td valign="top">
  <p class="TextinTable81"><span class="Interface">&lt;Любые роли&gt;</span></p>
  </td>
 </tr>
</table>

<a name="issogl3_настройка_обмена_данными"><h4>Настройка обмена данными</h4></a>

<p class="Paragraph0c">Все объекты метаданных подсистемы, содержащие данные,
рекомендуется включить в планы обмена распределенной ИБ (РИБ).</p>

<p class="Paragraph0c">Исключение из этого правила составляют:</p>

<p class="MsoListBullet">&#9679; 
константа <span class="Interface">БлокировкаОтправкиБыстрыхСообщений</span>,</p>

<p class="MsoListBullet">&#9679; 
справочник<span class="Interface"> СообщенияСистемы</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений<span class="Interface"> НастройкиОтправителя</span>,</p>

<p class="MsoListBullet">&#9679; 
регистр сведений<span class="Interface"> ПодпискиПолучателей</span>.</p>		<script type="text/javascript">listenCopy('zeroclipboard.swf');</script>
	</body>
</html>